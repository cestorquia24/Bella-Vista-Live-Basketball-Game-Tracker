<!DOCTYPE html>
<!-- saved from url=(0187)https://dede3phc22dgx.cloudfront.net/creao2/b38c3718-d077-4a39-bf6c-46459ba7316f/78c1f3b0-40b1-7060-a869-e7ddc038af9a/2bb9a590-6fe6-4c77-9077-d9571d84ca95/basketball-tracker-template.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Violet vs. Yellow</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Light Mode Colors */
            --bg-gradient-start: #667eea;
            --bg-gradient-end: #764ba2;
            --container-bg: white;
            --text-primary: #2d3748;
            --text-secondary: #718096;
            --border-color: #e2e8f0;
            --header-bg-start: #2d3748;
            --header-bg-end: #1a202c;
            --scoreboard-bg-start: #1a202c;
            --scoreboard-bg-end: #2d3748;
            --section-bg: #f7fafc;
            --team-section-bg: white;
            --player-hover-bg: #f7fafc;
            --stat-label-color: #718096;
            --total-stat-bg: #f7fafc;
        }

        body.dark-mode {
            /* Dark Mode Colors */
            --bg-gradient-start: #1a202c;
            --bg-gradient-end: #2d3748;
            --container-bg: #1a202c;
            --text-primary: #e2e8f0;
            --text-secondary: #a0aec0;
            --border-color: #4a5568;
            --header-bg-start: #0f1419;
            --header-bg-end: #1a202c;
            --scoreboard-bg-start: #0f1419;
            --scoreboard-bg-end: #1a202c;
            --section-bg: #2d3748;
            --team-section-bg: #2d3748;
            --player-hover-bg: #374151;
            --stat-label-color: #a0aec0;
            --total-stat-bg: #374151;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            min-height: 100vh;
            padding: 0;
            margin: 0;
            overflow-x: hidden;
            transition: background 0.3s ease;
        }

        .container {
            width: 100vw;
            min-height: 100vh;
            margin: 0;
            background: var(--container-bg);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: background 0.3s ease;
        }

        .header {
            background: linear-gradient(135deg, rgba(45, 55, 72, 0.75) 0%, rgba(26, 32, 44, 0.85) 100%),
                        url('bellaLogo.jpg') center top / cover no-repeat;
            color: white;
            padding: 60px 30px 30px 30px;
            text-align: center;
            flex-shrink: 0;
            position: relative;
            min-height: 200px;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, transparent 0%, rgba(26, 32, 44, 0.6) 100%);
            pointer-events: none;
        }

        .header-logo-display {
            position: absolute;
            top: 15px;
            left: 20px;
            width: 120px;
            height: 120px;
            object-fit: contain;
            filter: drop-shadow(0 4px 12px rgba(0,0,0,0.8));
            z-index: 10;
        }

        .header-content {
            position: relative;
            z-index: 1;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 8px;
        }

        .game-info {
            display: flex;
            justify-content: space-around;
            margin-top: 10px;
            font-size: 1em;
        }

        .live-scoreboard {
            background: linear-gradient(135deg, var(--scoreboard-bg-start) 0%, var(--scoreboard-bg-end) 100%);
            padding: 20px 20px;
            flex-shrink: 0;
            border-bottom: 4px solid #667eea;
            position: relative;
        }

        .scoreboard-top-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 40px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .score-team {
            flex: 1;
            text-align: center;
        }

        .score-team-name {
            font-size: 1.8em;
            font-weight: 700;
            color: white;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .score-value {
            font-size: 5em;
            font-weight: 900;
            color: #48bb78;
            line-height: 1;
            text-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .score-vs {
            font-size: 2.5em;
            color: #cbd5e0;
            font-weight: 700;
            padding: 0 30px;
        }

        .scoreboard-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .quarter-info {
            color: white;
            font-size: 1.1em;
            font-weight: 600;
            text-align: center;
            margin-bottom: 15px;
        }

        .cast-btn, .undo-btn-top {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .cast-btn:hover, .undo-btn-top:hover:not(:disabled) {
            background: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .undo-btn-top:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
        }

        .dark-mode-toggle {
            padding: 10px 20px;
            background: #f59e0b;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .dark-mode-toggle:hover {
            background: #d97706;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
        }

        body.dark-mode .dark-mode-toggle {
            background: #fbbf24;
        }

        body.dark-mode .dark-mode-toggle:hover {
            background: #f59e0b;
        }

        .possession-btn {
            padding: 10px 20px;
            background: #718096;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .possession-btn:hover {
            background: #4a5568;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(113, 128, 150, 0.4);
        }

        .possession-btn.active {
            background: #f97316;
            box-shadow: 0 0 20px rgba(249, 115, 22, 0.5);
        }

        .possession-btn.active:hover {
            background: #ea580c;
        }

        .quarter-info {
            position: absolute;
            top: 15px;
            left: 20px;
            color: white;
            font-size: 1.1em;
            font-weight: 600;
            z-index: 100;
        }

        .timer-section {
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 40px;
            flex-shrink: 0;
            border-bottom: 2px solid #667eea;
        }

        .timer-box {
            text-align: center;
        }

        .timer-label {
            font-size: 0.9em;
            color: #cbd5e0;
            font-weight: 600;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .timer-display {
            font-size: 3.5em;
            font-weight: 900;
            color: #48bb78;
            font-family: 'Courier New', monospace;
            margin-bottom: 10px;
            text-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .timer-display.warning {
            color: #f6ad55;
        }

        .timer-display.danger {
            color: #fc8181;
            animation: pulse-timer 1s infinite;
        }

        @keyframes pulse-timer {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .timer-controls {
            display: flex;
            gap: 8px;
            justify-content: center;
        }

        .timer-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 0.85em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .timer-btn.start {
            background: #48bb78;
            color: white;
        }

        .timer-btn.start:hover {
            background: #38a169;
        }

        .timer-btn.pause {
            background: #f6ad55;
            color: white;
        }

        .timer-btn.pause:hover {
            background: #ed8936;
        }

        .timer-btn.reset {
            background: #fc8181;
            color: white;
        }

        .timer-btn.reset:hover {
            background: #f56565;
        }

        .timer-btn.adjust {
            background: #667eea;
            color: white;
            padding: 8px 12px;
        }

        .timer-btn.adjust:hover {
            background: #5a67d8;
        }

        .timer-btn.fiba {
            background: #9f7aea;
            color: white;
        }

        .timer-btn.fiba:hover {
            background: #805ad5;
        }

        .quarter-selector {
            background: var(--section-bg);
            padding: 15px 20px;
            display: flex;
            justify-content: center;
            gap: 10px;
            border-bottom: 2px solid var(--border-color);
            flex-shrink: 0;
        }

        .quarter-btn {
            padding: 12px 30px;
            border: 2px solid #cbd5e0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
        }

        .quarter-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .quarter-btn-logo {
            width: 24px;
            height: 24px;
            object-fit: contain;
            border-radius: 4px;
        }

        .quarter-btn:hover:not(.active) {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .totals-section {
            background: var(--section-bg);
            padding: 15px 20px;
            border-bottom: 2px solid var(--border-color);
            flex-shrink: 0;
        }

        .totals-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .team-totals {
            background: var(--team-section-bg);
            padding: 12px 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .team-totals h3 {
            margin-bottom: 8px;
            color: var(--text-primary);
            font-size: 1em;
            font-weight: 700;
        }

        .totals-stats {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
        }

        .total-stat {
            text-align: center;
            padding: 8px;
            background: var(--total-stat-bg);
            border-radius: 6px;
        }

        .total-stat-label {
            font-size: 0.75em;
            color: var(--stat-label-color);
            margin-bottom: 4px;
            font-weight: 600;
        }

        .total-stat-value {
            font-size: 1.3em;
            font-weight: 700;
            color: var(--text-primary);
        }

        .teams-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2px;
            background: var(--border-color);
            flex: 1;
            overflow-y: auto;
        }

        .team-section {
            background: var(--team-section-bg);
            padding: 20px;
            overflow-y: auto;
            height: 100%;
            position: relative;
            border-left: 5px solid #667eea;
        }

        .team-section.team2 {
            border-left-color: #f56565;
        }

        .team-section::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            height: 400px;
            background-image: var(--team-logo-bg, none);
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            opacity: 0.05;
            pointer-events: none;
            z-index: 0;
        }

        .team-section > * {
            position: relative;
            z-index: 1;
        }

        .team-floating-logo {
            position: sticky;
            top: 80px;
            right: 20px;
            width: 60px;
            height: 60px;
            object-fit: contain;
            opacity: 0.3;
            transition: opacity 0.3s;
            margin-left: auto;
            display: block;
            pointer-events: none;
            filter: drop-shadow(0 2px 8px rgba(0,0,0,0.2));
            z-index: 5;
        }

        .team-floating-logo:hover {
            opacity: 0.6;
        }

        .team-section h2 {
            color: var(--text-primary);
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 4px solid #667eea;
            font-size: 1.5em;
            position: sticky;
            top: 0;
            background: var(--team-section-bg);
            z-index: 10;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .team-section.team2 h2 {
            border-bottom-color: #f56565;
            box-shadow: 0 2px 8px rgba(245, 101, 101, 0.3);
        }

        .lineup-section {
            margin-bottom: 15px;
        }

        .players-list {
            min-height: 60px;
            border-radius: 6px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .players-list.drag-over {
            background: #edf2f7;
            border: 2px dashed #667eea;
        }

        .lineup-title {
            font-size: 1em;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 8px;
            padding: 8px 10px;
            background: #edf2f7;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
            position: sticky;
            top: 60px;
            z-index: 9;
        }

        .lineup-title.starting {
            background: #c6f6d5;
            color: #22543d;
        }

        .lineup-title.bench {
            background: #feebc8;
            color: #7c2d12;
        }

        .player-row {
            display: grid;
            grid-template-columns: 2fr 0.6fr 1.5fr repeat(6, 1fr);
            gap: 8px;
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
            align-items: center;
            cursor: move;
            transition: all 0.2s;
            min-width: 820px;
        }

        .swap-btn {
            padding: 6px 10px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 6px;
            font-size: 0.85em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .swap-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(102, 126, 234, 0.3);
        }

        .swap-btn:active {
            transform: translateY(0);
        }

        .player-row > div {
            min-width: 0;
        }

        .quick-score-btns {
            display: flex;
            gap: 2px;
            justify-content: center;
            align-items: center;
        }

        .quick-score-btn {
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 36px;
            height: 32px;
            text-align: center;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .quick-score-btn.pt1 {
            background: #bee3f8;
            color: #2c5282;
        }

        .quick-score-btn.pt2 {
            background: #c6f6d5;
            color: #22543d;
        }

        .quick-score-btn.pt3 {
            background: #fbd38d;
            color: #7c2d12;
        }

        .quick-score-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .team-fouls-section {
            background: #fff5f5;
            padding: 12px 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            border: 2px solid #feb2b2;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .team-fouls-label {
            font-weight: 700;
            color: #c53030;
            font-size: 1em;
        }

        .team-fouls-controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .team-fouls-value {
            font-size: 1.5em;
            font-weight: 700;
            color: #c53030;
            min-width: 40px;
            text-align: center;
        }

        /* Timeout Section Styles */
        .timeout-section {
            background: #e6f7ff;
            padding: 12px 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            border: 2px solid #91d5ff;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .timeout-display {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }

        .timeout-label {
            font-weight: 700;
            color: #0050b3;
            font-size: 0.95em;
        }

        .timeout-icons {
            font-size: 1.3em;
            letter-spacing: 3px;
        }

        .timeout-count {
            font-weight: 700;
            color: #0050b3;
            font-size: 1.1em;
        }

        .timeout-buttons {
            display: flex;
            gap: 8px;
        }

        .timeout-btn {
            flex: 1;
            background: linear-gradient(135deg, #1890ff 0%, #0050b3 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .timeout-btn:hover {
            background: linear-gradient(135deg, #40a9ff 0%, #1890ff 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(24, 144, 255, 0.3);
        }

        .timeout-btn:active {
            transform: translateY(0);
        }

        .timeout-btn:disabled {
            background: #d9d9d9;
            color: #8c8c8c;
            cursor: not-allowed;
            transform: none;
        }

        .timeout-btn:disabled:hover {
            background: #d9d9d9;
            transform: none;
            box-shadow: none;
        }

        .timeout-undo-btn {
            background: linear-gradient(135deg, #52c41a 0%, #389e0d 100%);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .timeout-undo-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #73d13d 0%, #52c41a 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(82, 196, 26, 0.3);
        }

        .timeout-undo-btn:active {
            transform: translateY(0);
        }

        .timeout-undo-btn:disabled {
            background: #d9d9d9;
            color: #8c8c8c;
            cursor: not-allowed;
            opacity: 0.5;
        }

        .timeout-undo-btn:disabled:hover {
            transform: none;
            box-shadow: none;
        }

        .player-row:hover {
            background: var(--player-hover-bg);
        }

        .player-row.dragging {
            opacity: 0.5;
            background: #e2e8f0;
        }

        .player-row.drag-over {
            border-top: 3px solid #667eea;
        }

        .players-list {
            min-height: 60px;
            border-radius: 6px;
        }

        .players-list.drag-over {
            background: #edf2f7;
            border: 2px dashed #667eea;
        }

        .player-header {
            font-weight: 700;
            color: var(--text-primary);
            background: var(--section-bg);
            border-bottom: 2px solid var(--border-color);
            cursor: default;
        }

        .player-header > div {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .player-name {
            font-weight: 600;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .stat-control {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .stat-btn {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1.2em;
            font-weight: bold;
            transition: all 0.2s;
        }

        .stat-btn.minus {
            background: #fed7d7;
            color: #c53030;
        }

        .stat-btn.minus:hover {
            background: #fc8181;
        }

        .stat-btn.plus {
            background: #c6f6d5;
            color: #2f855a;
        }

        .stat-btn.plus:hover {
            background: #68d391;
        }

        /* Team 1 stat buttons - Blue theme */
        .team1 .stat-btn.plus {
            background: #bee3f8;
            color: #2c5282;
        }

        .team1 .stat-btn.plus:hover {
            background: #90cdf4;
        }

        .team1 .stat-btn.minus {
            background: #fbd38d;
            color: #7c2d12;
        }

        .team1 .stat-btn.minus:hover {
            background: #f6ad55;
        }

        /* Team 2 stat buttons - Red theme */
        .team2 .stat-btn.plus {
            background: #fbb6ce;
            color: #97266d;
        }

        .team2 .stat-btn.plus:hover {
            background: #f687b3;
        }

        .team2 .stat-btn.minus {
            background: #fed7d7;
            color: #9b2c2c;
        }

        .team2 .stat-btn.minus:hover {
            background: #fc8181;
        }

        .stat-value {
            min-width: 40px;
            text-align: center;
            font-weight: 700;
            font-size: 1.1em;
            color: var(--text-primary);
        }

        .stat-label {
            font-size: 0.9em;
            color: #718096;
            text-align: center;
            white-space: nowrap;
        }

        .mvp-section {
            background: linear-gradient(135deg, #fef5e7 0%, #fdebd0 100%);
            padding: 20px;
            border-bottom: 2px solid #f39c12;
            flex-shrink: 0;
        }

        .mvp-container {
            max-width: 600px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .mvp-label {
            font-size: 1.3em;
            font-weight: 700;
            color: #d68910;
        }

        .mvp-selector {
            padding: 10px 15px;
            font-size: 1em;
            border: 2px solid #f39c12;
            border-radius: 8px;
            background: white;
            color: #2d3748;
            font-weight: 600;
            cursor: pointer;
            min-width: 250px;
            transition: all 0.3s;
        }

        .mvp-selector:hover {
            border-color: #d68910;
            box-shadow: 0 2px 8px rgba(243, 156, 18, 0.3);
        }

        .mvp-selector:focus {
            outline: none;
            border-color: #d68910;
            box-shadow: 0 0 0 3px rgba(243, 156, 18, 0.2);
        }

        .mvp-display {
            font-size: 1.1em;
            font-weight: 600;
            color: #d68910;
            background: white;
            padding: 10px 20px;
            border-radius: 8px;
            border: 2px solid #f39c12;
        }

        .export-section {
            padding: 15px 20px;
            text-align: center;
            background: white;
            flex-shrink: 0;
            position: relative;
        }

        .auto-save-indicator {
            position: absolute;
            top: 15px;
            left: 20px;
            color: #48bb78;
            font-size: 0.9em;
            font-weight: 600;
        }

        .export-btn {
            padding: 15px 40px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .export-btn:hover {
            background: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        @media (max-width: 1024px) {
            .player-row {
                grid-template-columns: 1.8fr 0.6fr repeat(7, 1fr);
                gap: 6px;
                font-size: 0.9em;
                padding: 8px;
                min-width: 820px;
            }

            .swap-btn {
                font-size: 0.75em;
                padding: 5px 8px;
            }

            .stat-btn {
                width: 30px;
                height: 30px;
                font-size: 1.1em;
            }

            .score-team-name {
                font-size: 1.4em;
            }

            .score-value {
                font-size: 3.5em;
            }

            .score-vs {
                font-size: 2em;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 40px 15px 20px 15px;
                min-height: 160px;
            }

            .header-logo-display {
                width: 90px;
                height: 90px;
                top: 10px;
                left: 10px;
            }

            .team-logo-header {
                width: 60px;
                height: 60px;
            }

            .team-logo-scoreboard {
                width: 140px;
                height: 140px;
                padding: 8px;
            }

            .header h1 {
                font-size: 1.2em;
            }

            .game-info {
                font-size: 0.8em;
                flex-direction: column;
                gap: 5px;
            }

            .teams-container {
                grid-template-columns: 1fr;
            }

            .team-logo-scoreboard {
                width: 100px;
                height: 100px;
                padding: 8px;
            }

            .score-value {
                font-size: 2em;
            }

            .score-vs {
                font-size: 1.2em;
                padding: 0 10px;
            }

            .scoreboard-controls {
                position: static;
                justify-content: center;
                margin-top: 15px;
                flex-wrap: wrap;
            }

            .cast-btn, .undo-btn-top {
                padding: 8px 15px;
                font-size: 0.8em;
            }

            .quarter-info {
                position: static;
                text-align: center;
                margin-bottom: 10px;
                font-size: 0.9em;
            }

            .quarter-btn {
                padding: 8px 12px;
                font-size: 0.85em;
            }

            .totals-section {
                padding: 10px 15px;
            }

            .totals-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .team-totals {
                padding: 10px 12px;
            }

            .team-totals h3 {
                font-size: 0.85em;
            }

            .totals-stats {
                grid-template-columns: repeat(3, 1fr);
                gap: 6px;
            }

            .total-stat {
                padding: 6px 4px;
            }

            .total-stat-label {
                font-size: 0.65em;
            }

            .total-stat-value {
                font-size: 1em;
            }

            .player-row {
                grid-template-columns: 1.5fr 0.5fr 1.3fr repeat(6, 0.7fr);
                gap: 4px;
                font-size: 0.75em;
                padding: 8px 5px;
                min-width: 780px;
            }

            .swap-btn {
                font-size: 0.65em;
                padding: 4px 6px;
            }

            .quick-score-btn {
                padding: 3px 5px;
                font-size: 0.7em;
                min-width: 32px;
                height: 26px;
            }

            .stat-btn {
                width: 26px;
                height: 26px;
                font-size: 0.9em;
            }

            .stat-value {
                min-width: 28px;
                font-size: 0.9em;
            }

            .export-btn {
                padding: 10px 20px;
                font-size: 0.9em;
                margin: 5px !important;
            }

            .lineup-title {
                font-size: 0.85em;
                padding: 6px 8px;
            }

            .team-section h2 {
                font-size: 1.1em;
            }

            .team-section {
                padding: 15px 10px;
            }

            .team-fouls-section {
                padding: 10px 12px;
                flex-direction: column;
                gap: 10px;
            }

            .team-fouls-label {
                font-size: 0.9em;
            }

            .team-fouls-value {
                font-size: 1.2em;
            }

            .mvp-section {
                padding: 12px 15px;
            }

            .mvp-container {
                flex-direction: column;
                gap: 10px;
            }

            .mvp-label {
                font-size: 1em;
            }

            .mvp-selector {
                min-width: 200px;
                font-size: 0.9em;
                padding: 8px 12px;
            }

            .mvp-display {
                font-size: 0.9em;
                padding: 8px 15px;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 0.95em;
            }

            .team-logo-scoreboard {
                width: 80px;
                height: 80px;
                padding: 6px;
            }

            .score-value {
                font-size: 1.5em;
            }

            .player-row {
                grid-template-columns: 1.2fr 0.4fr 1.1fr repeat(6, 0.6fr);
                gap: 3px;
                font-size: 0.7em;
                padding: 6px 3px;
                min-width: 680px;
            }

            .swap-btn {
                font-size: 0.6em;
                padding: 3px 5px;
            }

            .quick-score-btn {
                padding: 2px 4px;
                font-size: 0.65em;
                min-width: 28px;
                height: 24px;
            }

            .stat-btn {
                width: 24px;
                height: 24px;
                font-size: 0.85em;
            }

            .stat-value {
                min-width: 24px;
                font-size: 0.85em;
            }

            .totals-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 1920px) {
            .player-row {
                padding: 12px;
                gap: 12px;
            }

            .stat-btn {
                width: 36px;
                height: 36px;
            }

            .team-section h2 {
                font-size: 1.8em;
            }

            .lineup-title {
                font-size: 1.1em;
            }
        }

        /* Setup Screen Styles */
        .setup-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.65) 0%, rgba(118, 75, 162, 0.75) 100%),
                        url('belaLogo1.jpg') center center / cover no-repeat;
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
        }

        .setup-screen::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, transparent 0%, rgba(0,0,0,0.3) 100%);
            pointer-events: none;
        }

        .setup-screen.hidden {
            display: none;
        }

        .setup-form {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            backdrop-filter: blur(10px);
            position: relative;
            z-index: 1;
        }

        .setup-logo-top {
            width: 220px;
            height: auto;
            display: block;
            margin: 0 auto 30px auto;
            filter: drop-shadow(0 8px 32px rgba(0,0,0,0.6)) drop-shadow(0 0 40px rgba(102, 126, 234, 0.5));
            animation: logo-glow 2s ease-in-out infinite alternate;
        }

        @keyframes logo-glow {
            0% {
                filter: drop-shadow(0 8px 32px rgba(0,0,0,0.6)) drop-shadow(0 0 40px rgba(102, 126, 234, 0.5));
            }
            100% {
                filter: drop-shadow(0 8px 32px rgba(0,0,0,0.6)) drop-shadow(0 0 60px rgba(102, 126, 234, 0.8));
            }
        }

        .setup-form h2 {
            color: #2d3748;
            margin-bottom: 30px;
            font-size: 2em;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #2d3748;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 1em;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1em;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .team-selector {
            cursor: pointer;
            background-color: white;
        }

        .team-logo-preview {
            width: 80px;
            height: 80px;
            object-fit: contain;
            margin: 10px auto;
            display: block;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            padding: 5px;
        }

        .team-logo-header {
            width: 80px;
            height: 80px;
            object-fit: contain;
            margin-right: 15px;
            vertical-align: middle;
            border-radius: 8px;
            padding: 3px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .team-logo-scoreboard {
            width: 200px;
            height: 200px;
            object-fit: contain;
            margin: 0 auto 15px auto;
            display: block;
            border-radius: 12px;
            padding: 10px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.3);
            filter: drop-shadow(0 0 20px rgba(102, 126, 234, 0.4));
        }

        .team-selection-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .team-card {
            background: white;
            border: 3px solid #e2e8f0;
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .team-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
            border-color: #667eea;
        }

        .team-card.selected {
            border-color: #48bb78;
            background: #f0fdf4;
            box-shadow: 0 8px 24px rgba(72, 187, 120, 0.4);
        }

        .team-card-logo {
            width: 100px;
            height: 100px;
            object-fit: contain;
            margin: 0 auto 10px auto;
            display: block;
        }

        .team-card-name {
            font-size: 0.9em;
            font-weight: 600;
            color: #2d3748;
            margin-top: 8px;
        }

        .team-card.selected .team-card-name {
            color: #22543d;
        }

        .selection-label {
            font-size: 1.1em;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 10px;
            text-align: center;
        }

        @media (max-width: 768px) {
            .team-selection-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .team-card-logo {
                width: 70px;
                height: 70px;
            }
        }

        .form-group textarea {
            min-height: 150px;
            resize: vertical;
        }

        .form-group small {
            display: block;
            color: #718096;
            margin-top: 4px;
            font-size: 0.9em;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .start-game-btn {
            width: 100%;
            padding: 16px;
            background: #48bb78;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.2em;
            font-weight: 700;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s;
        }

        .start-game-btn:hover {
            background: #38a169;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(72, 187, 120, 0.4);
        }

        @media (max-width: 768px) {
            .setup-form {
                padding: 20px;
            }

            .setup-logo-top {
                width: 180px;
            }

            .setup-form h2 {
                font-size: 1.5em;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Setup Screen -->
    <div class="setup-screen" id="setupScreen">
        <div class="setup-form">
            <img src="belaLogo1.jpg" alt="Bella Vista Basketball League" class="setup-logo-top">
            <h2>üèÄ Setup Basketball Game</h2>
            <form id="gameSetupForm" onsubmit="startGameFromForm(event); return false;">
                <div class="form-group">
                    <div class="selection-label">Select Team 1</div>
                    <div class="team-selection-grid" id="team1SelectionGrid">
                        <div class="team-card" data-team="Orange Inferno" onclick="selectTeam(1, 'Orange Inferno')">
                            <img src="logos/Orange Inferno.jpg" class="team-card-logo" alt="Orange Inferno">
                            <div class="team-card-name">Orange Inferno</div>
                        </div>
                        <div class="team-card" data-team="Gray Wolves" onclick="selectTeam(1, 'Gray Wolves')">
                            <img src="logos/Gray Wolves.jpeg" class="team-card-logo" alt="Gray Wolves">
                            <div class="team-card-name">Gray Wolves</div>
                        </div>
                        <div class="team-card" data-team="Green Bulls" onclick="selectTeam(1, 'Green Bulls')">
                            <img src="logos/Green Bulls.jpg" class="team-card-logo" alt="Green Bulls">
                            <div class="team-card-name">Green Bulls</div>
                        </div>
                        <div class="team-card" data-team="Bella Vista Blue" onclick="selectTeam(1, 'Bella Vista Blue')">
                            <img src="logos/Bella Vista Blue.png" class="team-card-logo" alt="Bella Vista Blue">
                            <div class="team-card-name">Bella Vista Blue</div>
                        </div>
                        <div class="team-card" data-team="Black Hoopers" onclick="selectTeam(1, 'Black Hoopers')">
                            <img src="logos/Black Hoopers.jpg" class="team-card-logo" alt="Black Hoopers">
                            <div class="team-card-name">Black Hoopers</div>
                        </div>
                        <div class="team-card" data-team="Yellow Slashers" onclick="selectTeam(1, 'Yellow Slashers')">
                            <img src="logos/Yellow Slashers.png" class="team-card-logo" alt="Yellow Slashers">
                            <div class="team-card-name">Yellow Slashers</div>
                        </div>
                        <div class="team-card" data-team="Red Blood Cells" onclick="selectTeam(1, 'Red Blood Cells')">
                            <img src="logos/Red Blood Cells.jpg" class="team-card-logo" alt="Red Blood Cells">
                            <div class="team-card-name">Red Blood Cells</div>
                        </div>
                        <div class="team-card" data-team="Porpol Ravens" onclick="selectTeam(1, 'Porpol Ravens')">
                            <img src="logos/Porpol Ravens.jpeg" class="team-card-logo" alt="Porpol Ravens">
                            <div class="team-card-name">Porpol Ravens</div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <div class="selection-label">Select Team 2</div>
                    <div class="team-selection-grid" id="team2SelectionGrid">
                        <div class="team-card" data-team="Orange Inferno" onclick="selectTeam(2, 'Orange Inferno')">
                            <img src="logos/Orange Inferno.jpg" class="team-card-logo" alt="Orange Inferno">
                            <div class="team-card-name">Orange Inferno</div>
                        </div>
                        <div class="team-card" data-team="Gray Wolves" onclick="selectTeam(2, 'Gray Wolves')">
                            <img src="logos/Gray Wolves.jpeg" class="team-card-logo" alt="Gray Wolves">
                            <div class="team-card-name">Gray Wolves</div>
                        </div>
                        <div class="team-card" data-team="Green Bulls" onclick="selectTeam(2, 'Green Bulls')">
                            <img src="logos/Green Bulls.jpg" class="team-card-logo" alt="Green Bulls">
                            <div class="team-card-name">Green Bulls</div>
                        </div>
                        <div class="team-card" data-team="Bella Vista Blue" onclick="selectTeam(2, 'Bella Vista Blue')">
                            <img src="logos/Bella Vista Blue.png" class="team-card-logo" alt="Bella Vista Blue">
                            <div class="team-card-name">Bella Vista Blue</div>
                        </div>
                        <div class="team-card" data-team="Black Hoopers" onclick="selectTeam(2, 'Black Hoopers')">
                            <img src="logos/Black Hoopers.jpg" class="team-card-logo" alt="Black Hoopers">
                            <div class="team-card-name">Black Hoopers</div>
                        </div>
                        <div class="team-card" data-team="Yellow Slashers" onclick="selectTeam(2, 'Yellow Slashers')">
                            <img src="logos/Yellow Slashers.png" class="team-card-logo" alt="Yellow Slashers">
                            <div class="team-card-name">Yellow Slashers</div>
                        </div>
                        <div class="team-card" data-team="Red Blood Cells" onclick="selectTeam(2, 'Red Blood Cells')">
                            <img src="logos/Red Blood Cells.jpg" class="team-card-logo" alt="Red Blood Cells">
                            <div class="team-card-name">Red Blood Cells</div>
                        </div>
                        <div class="team-card" data-team="Porpol Ravens" onclick="selectTeam(2, 'Porpol Ravens')">
                            <img src="logos/Porpol Ravens.jpeg" class="team-card-logo" alt="Porpol Ravens">
                            <div class="team-card-name">Porpol Ravens</div>
                        </div>
                    </div>
                </div>

                <input type="hidden" id="team1Selector" required>
                <input type="hidden" id="team2Selector" required>

                <div class="form-group">
                    <label for="gameNameInput">Game Name</label>
                    <input type="text" id="gameNameInput" value="" placeholder="Will auto-generate from teams" required>
                </div>

                <div class="form-row" style="display: none;">
                    <div class="form-group">
                        <label for="team1PlayersInput">Team 1 Players</label>
                        <textarea id="team1PlayersInput" required></textarea>
                        <small>Auto-populated from team selection</small>
                    </div>
                    <div class="form-group">
                        <label for="team2PlayersInput">Team 2 Players</label>
                        <textarea id="team2PlayersInput" required></textarea>
                        <small>Auto-populated from team selection</small>
                    </div>
                </div>

                <div class="form-group">
                    <label for="quartersInput">Number of Quarters</label>
                    <input type="number" id="quartersInput" value="4" min="1" max="8" required>
                </div>

                <div class="form-group">
                    <label for="minutesPerQuarterInput">Minutes per Quarter</label>
                    <input type="number" id="minutesPerQuarterInput" value="10" min="1" max="12" required>
                    <small>Maximum 12 minutes per quarter</small>
                </div>

                <button type="submit" class="start-game-btn">Start Game</button>
            </form>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <img src="bellaLogo.jpg" alt="Bella Vista Logo" class="header-logo-display">
            <div class="header-content">
                <h1>üèÄ Bella Vista Hoopers Games Season 1 <span style="font-size: 0.5em; color: #48bb78;">(v2.6)</span></h1>
                <div class="game-info">
                    <div><strong>Game:</strong> <span id="gameName">Violet vs. Yellow</span></div>
                    <div><strong>Date:</strong> <span id="gameDate">2026-02-13</span></div>
                </div>
            </div>
        </div>

        <div class="live-scoreboard">
            <div class="quarter-info" id="currentQuarterDisplay">Quarter 1</div>
            <div class="scoreboard-top-row">
                <div class="score-team">
                    <img id="scoreTeam1Logo" class="team-logo-scoreboard" style="display: none;" alt="Team 1 Logo">
                    <div class="score-value" id="scoreTeam1Value">0</div>
                </div>
                <div class="score-vs">VS</div>
                <div class="score-team">
                    <img id="scoreTeam2Logo" class="team-logo-scoreboard" style="display: none;" alt="Team 2 Logo">
                    <div class="score-value" id="scoreTeam2Value">0</div>
                </div>
            </div>
            <div class="scoreboard-controls">
                <button class="possession-btn" id="team1PossessionBtn" onclick="setPossession('team1')">üèÄ Team 1 Ball</button>
                <button class="dark-mode-toggle" id="darkModeToggle" onclick="toggleDarkMode()">üåô Dark Mode</button>
                <button class="cast-btn" id="liveUpdatesBtn" onclick="toggleLiveUpdates()">üì° Live: OFF</button>
                <button class="undo-btn-top" id="undoBtn" onclick="undoLastAction()" disabled>‚Ü∂ Undo</button>
                <button class="cast-btn" onclick="openCastMode()">üì∫ Cast to Display</button>
                <button class="possession-btn" id="team2PossessionBtn" onclick="setPossession('team2')">üèÄ Team 2 Ball</button>
            </div>
        </div>

        <div class="timer-section">
            <div class="timer-box">
                <div class="timer-label">Game Time</div>
                <div class="timer-display" id="gameTimerDisplay">10:00</div>
                <div class="timer-controls">
                    <button class="timer-btn start" id="gameTimerStartBtn" onclick="startGameTimer()">‚ñ∂ Start</button>
                    <button class="timer-btn pause" id="gameTimerPauseBtn" onclick="pauseGameTimer()" style="display: none;">‚è∏ Pause</button>
                    <button class="timer-btn reset" onclick="resetGameTimer()">‚Üª Reset</button>
                </div>
                <div class="timer-controls" style="margin-top: 8px;">
                    <button class="timer-btn adjust" onclick="adjustGameTimer(-60)">-1min</button>
                    <button class="timer-btn adjust" onclick="adjustGameTimer(-1)">-1s</button>
                    <button class="timer-btn adjust" onclick="adjustGameTimer(1)">+1s</button>
                    <button class="timer-btn adjust" onclick="adjustGameTimer(60)">+1min</button>
                </div>
            </div>
            <div class="timer-box">
                <div class="timer-label">Shot Clock</div>
                <div class="timer-display" id="shotClockDisplay">24</div>
                <div class="timer-controls">
                    <button class="timer-btn start" id="shotClockStartBtn" onclick="startShotClock()">‚ñ∂ Start</button>
                    <button class="timer-btn pause" id="shotClockPauseBtn" onclick="pauseShotClock()" style="display: none;">‚è∏ Pause</button>
                    <button class="timer-btn reset" onclick="resetShotClock()">‚Üª 24s</button>
                    <button class="timer-btn fiba" onclick="resetShotClockFIBA()">üèÄ 14s</button>
                </div>
                <div class="timer-controls" style="margin-top: 8px;">
                    <button class="timer-btn adjust" onclick="adjustShotClock(-5)">-5s</button>
                    <button class="timer-btn adjust" onclick="adjustShotClock(-1)">-1s</button>
                    <button class="timer-btn adjust" onclick="adjustShotClock(1)">+1s</button>
                    <button class="timer-btn adjust" onclick="adjustShotClock(5)">+5s</button>
                </div>
            </div>
        </div>

        <div class="timer-section" style="padding: 15px; border-bottom: 2px solid #667eea;">
            <button class="timer-btn reset" onmousedown="startTimeoutBuzzer()" onmouseup="stopTimeoutBuzzer()" onmouseleave="stopTimeoutBuzzer()" ontouchstart="startTimeoutBuzzer()" ontouchend="stopTimeoutBuzzer()" style="font-size: 1.2em; padding: 15px 40px; background: #e53e3e; width: auto; margin: 0 auto; display: block; user-select: none;">
                üì¢ HOLD FOR TIMEOUT BUZZER
            </button>
        </div>

        <div class="quarter-selector" id="quarterSelector"><button class="quarter-btn active">Quarter 1</button><button class="quarter-btn">Quarter 2</button><button class="quarter-btn">Quarter 3</button><button class="quarter-btn">Quarter 4</button><button class="quarter-btn">Total</button></div>

        <div class="totals-section">
            <div class="totals-grid">
                <div class="team-totals">
                    <h3 id="team1TotalName">Team Violet - Quarter 1</h3>
                    <div class="totals-stats" id="team1Totals">
                <div class="total-stat">
                    <div class="total-stat-label">Points</div>
                    <div class="total-stat-value">0</div>
                </div>
                <div class="total-stat">
                    <div class="total-stat-label">Rebounds</div>
                    <div class="total-stat-value">0</div>
                </div>
                <div class="total-stat">
                    <div class="total-stat-label">Assists</div>
                    <div class="total-stat-value">0</div>
                </div>
                <div class="total-stat">
                    <div class="total-stat-label">Steals</div>
                    <div class="total-stat-value">0</div>
                </div>
                <div class="total-stat">
                    <div class="total-stat-label">Blocks</div>
                    <div class="total-stat-value">0</div>
                </div>
            </div>
                </div>
                <div class="team-totals">
                    <h3 id="team2TotalName">Team Yellow - Quarter 1</h3>
                    <div class="totals-stats" id="team2Totals">
                <div class="total-stat">
                    <div class="total-stat-label">Points</div>
                    <div class="total-stat-value">0</div>
                </div>
                <div class="total-stat">
                    <div class="total-stat-label">Rebounds</div>
                    <div class="total-stat-value">0</div>
                </div>
                <div class="total-stat">
                    <div class="total-stat-label">Assists</div>
                    <div class="total-stat-value">0</div>
                </div>
                <div class="total-stat">
                    <div class="total-stat-label">Steals</div>
                    <div class="total-stat-value">0</div>
                </div>
                <div class="total-stat">
                    <div class="total-stat-label">Blocks</div>
                    <div class="total-stat-value">0</div>
                </div>
            </div>
                </div>
            </div>
        </div>

        <div class="mvp-section">
            <div class="mvp-container">
                <div class="mvp-label">üèÜ Best Player of the Game</div>
                <select id="mvpSelector" class="mvp-selector" onchange="setMVP()">
                    <option value="">-- Select Best Player --</option>
                </select>
                <div class="mvp-display" id="mvpDisplay">No player selected</div>
            </div>
        </div>

        <div class="teams-container">
            <div class="team-section team1">
                <h2 id="team1Name">Team Violet</h2>
                <img id="team1FloatingLogo" class="team-floating-logo" style="display: none;" alt="Team 1">

                <div class="team-fouls-section">
                    <div class="team-fouls-label">Team Fouls (Quarter <span id="team1FoulsQuarter">1</span>)</div>
                    <div class="team-fouls-controls">
                        <button class="stat-btn minus" onclick="updateTeamFouls('team1', -1)">-</button>
                        <div class="team-fouls-value" id="team1FoulsValue">0</div>
                        <button class="stat-btn plus" onclick="updateTeamFouls('team1', 1)">+</button>
                    </div>
                </div>

                <div class="timeout-section">
                    <div class="timeout-display">
                        <div class="timeout-label">Timeouts Remaining:</div>
                        <div class="timeout-icons" id="team1TimeoutIcons">‚è∏Ô∏è‚è∏Ô∏è</div>
                        <div class="timeout-count" id="team1TimeoutCount">(2)</div>
                    </div>
                    <div class="timeout-buttons">
                        <button class="timeout-btn" onclick="useTimeout('team1')">Use Timeout</button>
                        <button class="timeout-undo-btn" id="team1TimeoutUndoBtn" onclick="undoTimeout('team1')" disabled>‚Ü∂ Undo</button>
                    </div>
                </div>

                <div class="lineup-section">
                    <div class="lineup-title starting">üèÄ On Court LineUp (5 Players)</div>
                    <div id="team1Starting" class="players-list">
                    </div>
                </div>

                <div class="lineup-section">
                    <div class="lineup-title bench">ü™ë Bench Players</div>
                    <div id="team1Bench" class="players-list">
                    </div>
                </div>
            </div>

            <div class="team-section team2">
                <h2 id="team2Name">Team Yellow</h2>
                <img id="team2FloatingLogo" class="team-floating-logo" style="display: none;" alt="Team 2">

                <div class="team-fouls-section">
                    <div class="team-fouls-label">Team Fouls (Quarter <span id="team2FoulsQuarter">1</span>)</div>
                    <div class="team-fouls-controls">
                        <button class="stat-btn minus" onclick="updateTeamFouls('team2', -1)">-</button>
                        <div class="team-fouls-value" id="team2FoulsValue">0</div>
                        <button class="stat-btn plus" onclick="updateTeamFouls('team2', 1)">+</button>
                    </div>
                </div>

                <div class="timeout-section">
                    <div class="timeout-display">
                        <div class="timeout-label">Timeouts Remaining:</div>
                        <div class="timeout-icons" id="team2TimeoutIcons">‚è∏Ô∏è‚è∏Ô∏è</div>
                        <div class="timeout-count" id="team2TimeoutCount">(2)</div>
                    </div>
                    <div class="timeout-buttons">
                        <button class="timeout-btn" onclick="useTimeout('team2')">Use Timeout</button>
                        <button class="timeout-undo-btn" id="team2TimeoutUndoBtn" onclick="undoTimeout('team2')" disabled>‚Ü∂ Undo</button>
                    </div>
                </div>

                <div class="lineup-section">
                    <div class="lineup-title starting">üèÄ On Court LineUp (5 Players)</div>
                    <div id="team2Starting" class="players-list">
                    </div>
                </div>

                <div class="lineup-section">
                    <div class="lineup-title bench">ü™ë Bench Players</div>
                    <div id="team2Bench" class="players-list">
                    </div>
                </div>
            </div>
        </div>

        <div class="export-section">
            <div class="auto-save-indicator">‚úì Auto-saving</div>
            <button class="export-btn" onclick="finishAndSaveGame()" style="background: #48bb78;">üèÅ Finish & Save Game</button>
            <button class="export-btn" onclick="window.open('history.html', '_blank')" style="margin-left: 10px; background: #667eea;">üìä View History & Standings</button>
            <button class="export-btn" onclick="clearGameData()" style="margin-left: 10px; background: #f56565;">üóëÔ∏è Clear & Start New Game</button>
        </div>
    </div>

    <script>
        console.log('Basketball Tracker v2.6 - Game Timer + Shot Clock');

        // Predefined Teams Database
        const PREDEFINED_TEAMS = {
            'Orange Inferno': [
                'Melgar #28',
                'Francisco #24',
                'Taguiam #1',
                'Arriola #13',
                'Dolorso #12',
                'Inocencio #7',
                'Apodaca #3',
                'Maglangit #31',
                'Rafael #8',
                'Paronda #77',
                'Pe√±aflor #14',
                'Dantes #15'
            ],
            'Gray Wolves': [
                'Lagazo #2',
                'Jade #08',
                'Estuaria #45',
                'Mendoza #06',
                'Geres #11',
                'B. Gozon #7',
                'Delos Reyes #24',
                'Jamolangue #22',
                'Matoci√±os #0',
                'Papruz #18',
                'Vargas #28',
                'Ong #15'
            ],
            'Green Bulls': [
                'Cruz #5',
                'Digo #13',
                'Torralba #18',
                'Tabuan #31',
                'Frogosa #19',
                'Ligan #09',
                'Isidro #12',
                'Tan #1',
                'Balatucan #25',
                'Concepcion #21',
                'Geres #23',
                'Mariano #52'
            ],
            'Bella Vista Blue': [
                'Digo #4',
                'Tonel #92',
                'Valeza #1',
                'Razon #08',
                'Yu #2',
                'Manguba #19',
                'Fario #17',
                'Fahad #25',
                'Jess #16',
                'Aguilar Jr. #11',
                'Barredo #20',
                'Fajardo #15'
            ],
            'Black Hoopers': [
                'Sollodin #24',
                'Sollodin #3',
                'Suyo #23',
                'Tiquia #91',
                'Francisco #28',
                'Talens #7',
                'Panuncia #8',
                'Tan Sanchez #14',
                'Argueza #20',
                'Miclat #21',
                'Amador #321',
                'JM Cruz #26'
            ],
            'Yellow Slashers': [
                'Bacal #5',
                'Germedia #24',
                'Bayeta #9',
                'Espa√±ol #17',
                'Guilalas #8',
                'Salonga #18',
                'Mendoza #6',
                'Concepcion #30',
                'Venezuela #28',
                'Madriaga #10'
            ],
            'Red Blood Cells': [
                'Santillan #29',
                'Agualada #26',
                'Segura #51',
                'Lucero #15',
                'Agapay #11',
                'Calesterio #25',
                'Roberto #31',
                'Geres #18',
                'Jabez #17',
                'Tan Sanchez #1',
                'Regpala #38',
                'Lo #04'
            ],
            'Porpol Ravens': [
                'Estorquia #18',
                'S. Suyo #24',
                'Perez #8',
                'Puno #30',
                'Concepcion #13',
                'Amaro #14',
                'Borja #7',
                'Ramos #25',
                'Campos #28',
                'Prado #12',
                'Mariano #29'
            ]
        };

        // Team Logos Mapping
        const TEAM_LOGOS = {
            'Orange Inferno': 'logos/Orange Inferno.jpg',
            'Gray Wolves': 'logos/Gray Wolves.jpeg',
            'Green Bulls': 'logos/Green Bulls.jpg',
            'Bella Vista Blue': 'logos/Bella Vista Blue.png',
            'Black Hoopers': 'logos/Black Hoopers.jpg',
            'Yellow Slashers': 'logos/Yellow Slashers.png',
            'Red Blood Cells': 'logos/Red Blood Cells.jpg',
            'Porpol Ravens': 'logos/Porpol Ravens.jpeg'
        };

        // Game data structure
        const gameData = {
            gameName: '',
            gameDate: new Date().toISOString().split('T')[0],
            team1: { name: '', logo: '', players: [], teamFouls: {}, timeoutsRemaining: 2, currentHalf: 1 },
            team2: { name: '', logo: '', players: [], teamFouls: {}, timeoutsRemaining: 2, currentHalf: 1 },
            quarters: 4,
            minutesPerQuarter: 10,
            mvp: null,
            possession: null, // null, 'team1', or 'team2'
            gameTimer: {
                totalSeconds: 600,
                currentSeconds: 600,
                isRunning: false
            },
            shotClock: {
                seconds: 24,
                isRunning: false
            }
        };

        // Make gameData globally accessible for cast mode
        window.gameData = gameData;

        let currentQuarter = 1;
        let actionHistory = [];
        const MAX_HISTORY = 50;
        let lastTimeoutAction = { team1: null, team2: null }; // Track last timeout per team

        // Make currentQuarter accessible globally for cast mode
        window.currentQuarter = currentQuarter;

        // Timer intervals
        let gameTimerInterval = null;
        let shotClockInterval = null;

        // Game Timer Functions
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function updateGameTimerDisplay() {
            const display = document.getElementById('gameTimerDisplay');
            display.textContent = formatTime(gameData.gameTimer.currentSeconds);

            // Color warnings
            if (gameData.gameTimer.currentSeconds <= 10) {
                display.className = 'timer-display danger';
            } else if (gameData.gameTimer.currentSeconds <= 60) {
                display.className = 'timer-display warning';
            } else {
                display.className = 'timer-display';
            }
        }

        function startGameTimer() {
            if (gameData.gameTimer.isRunning) return;

            gameData.gameTimer.isRunning = true;
            document.getElementById('gameTimerStartBtn').style.display = 'none';
            document.getElementById('gameTimerPauseBtn').style.display = 'inline-block';

            gameTimerInterval = setInterval(() => {
                if (gameData.gameTimer.currentSeconds > 0) {
                    gameData.gameTimer.currentSeconds--;
                    updateGameTimerDisplay();
                    saveGameData();
                } else {
                    pauseGameTimer();
                    // Play loud horn sound when game timer ends
                    playBuzzerSound('gameEnd');
                }
            }, 1000);
        }

        function pauseGameTimer() {
            gameData.gameTimer.isRunning = false;
            clearInterval(gameTimerInterval);
            document.getElementById('gameTimerStartBtn').style.display = 'inline-block';
            document.getElementById('gameTimerPauseBtn').style.display = 'none';
            saveGameData();
        }

        function resetGameTimer() {
            pauseGameTimer();
            gameData.gameTimer.currentSeconds = gameData.gameTimer.totalSeconds;
            updateGameTimerDisplay();
            saveGameData();
        }

        // Shot Clock Functions
        function updateShotClockDisplay() {
            const display = document.getElementById('shotClockDisplay');
            display.textContent = gameData.shotClock.seconds;

            // Color warnings
            if (gameData.shotClock.seconds <= 5) {
                display.className = 'timer-display danger';
            } else if (gameData.shotClock.seconds <= 10) {
                display.className = 'timer-display warning';
            } else {
                display.className = 'timer-display';
            }
        }

        function startShotClock() {
            if (gameData.shotClock.isRunning) return;

            gameData.shotClock.isRunning = true;
            document.getElementById('shotClockStartBtn').style.display = 'none';
            document.getElementById('shotClockPauseBtn').style.display = 'inline-block';

            shotClockInterval = setInterval(() => {
                if (gameData.shotClock.seconds > 0) {
                    gameData.shotClock.seconds--;
                    updateShotClockDisplay();
                    saveGameData();
                } else {
                    pauseShotClock();
                    // Play loud buzzer sound when shot clock expires
                    playBuzzerSound('shotClock');
                }
            }, 1000);
        }

        function pauseShotClock() {
            gameData.shotClock.isRunning = false;
            clearInterval(shotClockInterval);
            document.getElementById('shotClockStartBtn').style.display = 'inline-block';
            document.getElementById('shotClockPauseBtn').style.display = 'none';
            saveGameData();
        }

        function resetShotClock() {
            pauseShotClock();
            gameData.shotClock.seconds = 24;
            updateShotClockDisplay();
            saveGameData();
            // Auto-start after reset
            startShotClock();
        }

        // Manual timer adjustments
        function adjustGameTimer(seconds) {
            const newValue = gameData.gameTimer.currentSeconds + seconds;
            // Don't go below 0 or above total time
            if (newValue >= 0 && newValue <= gameData.gameTimer.totalSeconds) {
                gameData.gameTimer.currentSeconds = newValue;
                updateGameTimerDisplay();
                saveGameData();
            }
        }

        function adjustShotClock(seconds) {
            const newValue = gameData.shotClock.seconds + seconds;
            // Don't go below 0 or above 99 seconds
            if (newValue >= 0 && newValue <= 99) {
                gameData.shotClock.seconds = newValue;
                updateShotClockDisplay();
                saveGameData();
            }
        }

        // FIBA 14-second shot clock (used after offensive rebound)
        function resetShotClockFIBA() {
            pauseShotClock();
            gameData.shotClock.seconds = 14;
            updateShotClockDisplay();
            saveGameData();
            // Auto-start after reset
            startShotClock();
        }

        // Buzzer sound system - loud and long sounds for different events
        let timeoutBuzzerOscillator = null;
        let timeoutBuzzerGain = null;
        let timeoutBuzzerContext = null;

        function playBuzzerSound(type) {
            if (!window.AudioContext && !window.webkitAudioContext) return;

            const audioContext = new (window.AudioContext || window.webkitAudioContext)();

            if (type === 'shotClock') {
                // Shot clock horn - long loud arena horn (3 seconds)
                const gainNode = audioContext.createGain();
                gainNode.connect(audioContext.destination);

                // Multi-harmonic horn sound (same as arena horn)
                const frequencies = [
                    300,  // Low fundamental
                    400,  // Second tone
                    500,  // Third harmonic
                    600   // Fourth harmonic
                ];

                const oscillators = frequencies.map((freq, index) => {
                    const osc = audioContext.createOscillator();
                    const oscGain = audioContext.createGain();

                    osc.type = 'sawtooth'; // Horn-like sound
                    osc.frequency.value = freq;

                    const volume = 0.35 / (index + 1);
                    oscGain.gain.value = volume;

                    osc.connect(oscGain);
                    oscGain.connect(gainNode);

                    return osc;
                });

                // Overall volume envelope - stay loud for full duration
                gainNode.gain.setValueAtTime(0.9, audioContext.currentTime); // Very loud
                gainNode.gain.setValueAtTime(0.9, audioContext.currentTime + 2.95); // Keep loud
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 3); // Quick fade at end

                // Start all oscillators
                oscillators.forEach(osc => osc.start());

                // Stop all oscillators after 3 seconds
                setTimeout(() => {
                    oscillators.forEach(osc => osc.stop());
                }, 3000);

            } else if (type === 'gameEnd') {
                // Game timer end - long arena horn (3 seconds)
                const gainNode = audioContext.createGain();
                gainNode.connect(audioContext.destination);

                // Multi-harmonic horn sound
                const frequencies = [
                    280,  // Low fundamental (deeper than shot clock)
                    380,  // Second tone
                    480,  // Third harmonic
                    580   // Fourth harmonic
                ];

                const oscillators = frequencies.map((freq, index) => {
                    const osc = audioContext.createOscillator();
                    const oscGain = audioContext.createGain();

                    osc.type = 'sawtooth'; // Horn-like
                    osc.frequency.value = freq;

                    const volume = 0.35 / (index + 1);
                    oscGain.gain.value = volume;

                    osc.connect(oscGain);
                    oscGain.connect(gainNode);

                    return osc;
                });

                // Stay loud for full 3 seconds
                gainNode.gain.setValueAtTime(0.9, audioContext.currentTime); // Very loud
                gainNode.gain.setValueAtTime(0.9, audioContext.currentTime + 2.95); // Keep loud
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 3); // Quick fade at end

                oscillators.forEach(osc => osc.start());

                setTimeout(() => {
                    oscillators.forEach(osc => osc.stop());
                }, 3000); // 3 second horn
            }
        }

        // Start continuous timeout buzzer (hold button) - Arena horn sound
        function startTimeoutBuzzer() {
            if (timeoutBuzzerOscillator) return; // Already playing

            if (!window.AudioContext && !window.webkitAudioContext) return;

            timeoutBuzzerContext = new (window.AudioContext || window.webkitAudioContext)();
            timeoutBuzzerGain = timeoutBuzzerContext.createGain();
            timeoutBuzzerGain.connect(timeoutBuzzerContext.destination);

            // Multi-harmonic horn sound
            const frequencies = [
                330,  // Low fundamental
                440,  // Second tone
                550,  // Third harmonic
                660   // Fourth harmonic
            ];

            const oscillators = frequencies.map((freq, index) => {
                const osc = timeoutBuzzerContext.createOscillator();
                const oscGain = timeoutBuzzerContext.createGain();

                osc.type = 'sawtooth';
                osc.frequency.value = freq;

                const volume = 0.3 / (index + 1);
                oscGain.gain.value = volume;

                osc.connect(oscGain);
                oscGain.connect(timeoutBuzzerGain);

                osc.start();
                return osc;
            });

            timeoutBuzzerGain.gain.setValueAtTime(0.8, timeoutBuzzerContext.currentTime); // Very loud

            // Store all oscillators
            timeoutBuzzerOscillator = oscillators;
        }

        // Stop continuous timeout buzzer (release button)
        function stopTimeoutBuzzer() {
            if (!timeoutBuzzerOscillator) return;

            try {
                // Fade out quickly
                timeoutBuzzerGain.gain.exponentialRampToValueAtTime(0.01, timeoutBuzzerContext.currentTime + 0.1);
                setTimeout(() => {
                    if (timeoutBuzzerOscillator) {
                        timeoutBuzzerOscillator.forEach(osc => osc.stop());
                        timeoutBuzzerOscillator = null;
                        timeoutBuzzerGain = null;
                        timeoutBuzzerContext = null;
                    }
                }, 100);
            } catch(e) {
                console.error('Error stopping buzzer:', e);
            }
        }

        // Dark Mode functionality
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDarkMode = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDarkMode);

            // Update button text
            const btn = document.getElementById('darkModeToggle');
            btn.textContent = isDarkMode ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
        }

        // Possession functionality
        function setPossession(team) {
            // Toggle possession: if same team clicked, clear possession
            if (gameData.possession === team) {
                gameData.possession = null;
            } else {
                gameData.possession = team;
            }

            updatePossessionButtons();
            saveGameData();
        }

        function updatePossessionButtons() {
            const team1Btn = document.getElementById('team1PossessionBtn');
            const team2Btn = document.getElementById('team2PossessionBtn');

            // Update button text with team names
            team1Btn.textContent = `üèÄ ${gameData.team1.name || 'Team 1'} Ball`;
            team2Btn.textContent = `üèÄ ${gameData.team2.name || 'Team 2'} Ball`;

            // Update active states
            team1Btn.classList.toggle('active', gameData.possession === 'team1');
            team2Btn.classList.toggle('active', gameData.possession === 'team2');
        }

        function loadDarkMode() {
            const isDarkMode = localStorage.getItem('darkMode') === 'true';
            if (isDarkMode) {
                document.body.classList.add('dark-mode');
                const btn = document.getElementById('darkModeToggle');
                if (btn) btn.textContent = '‚òÄÔ∏è Light Mode';
            }
        }

        // Load dark mode preference on page load
        loadDarkMode();

        // Auto-save functionality
        function saveGameData() {
            try {
                localStorage.setItem('basketballGameData', JSON.stringify(gameData));
                localStorage.setItem('basketballCurrentQuarter', currentQuarter.toString());
                localStorage.setItem('basketballActionHistory', JSON.stringify(actionHistory));
            } catch (e) {
                console.error('Failed to save game data:', e);
            }
        }

        function loadGameData() {
            try {
                const saved = localStorage.getItem('basketballGameData');
                const savedQuarter = localStorage.getItem('basketballCurrentQuarter');
                const savedHistory = localStorage.getItem('basketballActionHistory');

                if (saved) {
                    Object.assign(gameData, JSON.parse(saved));
                    if (savedQuarter) currentQuarter = parseInt(savedQuarter) || 1;
                    if (savedHistory) actionHistory = JSON.parse(savedHistory);
                    return true;
                }
            } catch (e) {
                console.error('Failed to load game data:', e);
            }
            return false;
        }

        function clearGameData() {
            if (confirm('Clear all game data and start a new game?')) {
                localStorage.removeItem('basketballGameData');
                localStorage.removeItem('basketballCurrentQuarter');
                localStorage.removeItem('basketballActionHistory');
                showSetupScreen();
            }
        }

        // Undo functionality
        function recordAction(action) {
            actionHistory.push(action);
            if (actionHistory.length > MAX_HISTORY) {
                actionHistory.shift();
            }
            document.getElementById('undoBtn').disabled = false;
            saveGameData();
        }

        function undoLastAction() {
            if (actionHistory.length === 0) return;

            const action = actionHistory.pop();

            switch (action.type) {
                case 'stat':
                    const player = gameData[action.team].players.find(p => p.id === action.playerId);
                    if (player) {
                        player.quarterStats[action.quarter][action.statName] = action.oldValue;
                    }
                    break;
                case 'teamFouls':
                    gameData[action.team].teamFouls[action.quarter] = action.oldValue;
                    break;
                case 'timeout':
                    gameData[action.team].timeoutsRemaining = action.oldValue;
                    updateTimeoutDisplay();
                    break;
                case 'starter':
                    const p = gameData[action.team].players.find(p => p.id === action.playerId);
                    if (p) p.isStarter = action.oldValue;
                    break;
            }

            renderPlayers('team1', gameData.team1.players);
            renderPlayers('team2', gameData.team2.players);
            updateTotals();
            updateLiveScoreboard();

            if (actionHistory.length === 0) {
                document.getElementById('undoBtn').disabled = true;
            }

            saveGameData();
        }

        // Initialize game from form data (this would come from the agentapp form)
        function initializeGame(formData) {
            // ALWAYS start fresh - don't load old data
            console.log('Initializing fresh game...');

            gameData.gameName = formData.gameName || 'Basketball Game';
            gameData.team1.name = formData.team1Name || 'Team 1';
            gameData.team2.name = formData.team2Name || 'Team 2';

            // Set team logos
            gameData.team1.logo = TEAM_LOGOS[formData.team1Name] || '';
            gameData.team2.logo = TEAM_LOGOS[formData.team2Name] || '';

            gameData.quarters = parseInt(formData.quarters) || 4;
            gameData.minutesPerQuarter = parseInt(formData.minutesPerQuarter) || 10;

            // Initialize timer based on minutes per quarter
            gameData.gameTimer.totalSeconds = gameData.minutesPerQuarter * 60;
            gameData.gameTimer.currentSeconds = gameData.minutesPerQuarter * 60;
            gameData.gameTimer.isRunning = false;

            // Initialize shot clock
            gameData.shotClock.seconds = 24;
            gameData.shotClock.isRunning = false;

            // Update timer displays
            updateGameTimerDisplay();
            updateShotClockDisplay();

            // Initialize team fouls
            for (let q = 1; q <= gameData.quarters; q++) {
                gameData.team1.teamFouls[q] = 0;
                gameData.team2.teamFouls[q] = 0;
            }

            // Initialize timeouts (1st half = 2 timeouts, 2nd half = 3 timeouts)
            gameData.team1.timeoutsRemaining = 2;
            gameData.team1.currentHalf = 1;
            gameData.team2.timeoutsRemaining = 2;
            gameData.team2.currentHalf = 1;

            // Parse players - first 5 are starters
            const team1PlayersList = formData.team1Players.split('\n').filter(p => p.trim());
            const team2PlayersList = formData.team2Players.split('\n').filter(p => p.trim());

            gameData.team1.players = team1PlayersList.map((name, idx) =>
                createPlayer(name.trim(), idx + 1, gameData.quarters, idx < 5)
            );
            gameData.team2.players = team2PlayersList.map((name, idx) =>
                createPlayer(name.trim(), idx + 1, gameData.quarters, idx < 5)
            );

            saveGameData();
            renderGame();
        }

        function createPlayer(name, id, quarters, isStarter = false) {
            const stats = {};
            for (let q = 1; q <= quarters; q++) {
                stats[q] = {
                    points: 0,
                    rebounds: 0,
                    assists: 0,
                    steals: 0,
                    blocks: 0,
                    fouls: 0
                };
            }
            return { id, name, quarterStats: stats, isStarter };
        }

        function renderGame() {
            window.currentQuarter = currentQuarter; // Make sure it's accessible globally
            document.getElementById('gameName').textContent = gameData.gameName;
            document.getElementById('gameDate').textContent = gameData.gameDate;

            // Update team names with logos
            const team1Header = document.getElementById('team1Name');
            const team2Header = document.getElementById('team2Name');

            if (gameData.team1.logo) {
                team1Header.innerHTML = `<img src="${gameData.team1.logo}" class="team-logo-header" alt="${gameData.team1.name}">${gameData.team1.name}`;
                // Set background watermark for team1 section
                const team1Section = document.querySelector('.team-section.team1');
                if (team1Section) {
                    team1Section.style.setProperty('--team-logo-bg', `url('${gameData.team1.logo}')`);
                }
                // Set floating logo for team1
                const team1FloatingLogo = document.getElementById('team1FloatingLogo');
                if (team1FloatingLogo) {
                    team1FloatingLogo.src = gameData.team1.logo;
                    team1FloatingLogo.style.display = 'block';
                }
            } else {
                team1Header.textContent = gameData.team1.name;
            }

            if (gameData.team2.logo) {
                team2Header.innerHTML = `<img src="${gameData.team2.logo}" class="team-logo-header" alt="${gameData.team2.name}">${gameData.team2.name}`;
                // Set background watermark for team2 section
                const team2Section = document.querySelector('.team-section.team2');
                if (team2Section) {
                    team2Section.style.setProperty('--team-logo-bg', `url('${gameData.team2.logo}')`);
                }
                // Set floating logo for team2
                const team2FloatingLogo = document.getElementById('team2FloatingLogo');
                if (team2FloatingLogo) {
                    team2FloatingLogo.src = gameData.team2.logo;
                    team2FloatingLogo.style.display = 'block';
                }
            } else {
                team2Header.textContent = gameData.team2.name;
            }

            renderQuarterSelector();
            renderPlayers('team1', gameData.team1.players);
            renderPlayers('team2', gameData.team2.players);
            updateTotals();
            updateLiveScoreboard();
            updateTeamFoulsDisplay();
            updateTimeoutDisplay();
            populateMVPSelector();
            updateMVPDisplay();
            updatePossessionButtons();
        }

        function populateMVPSelector() {
            const selector = document.getElementById('mvpSelector');
            selector.innerHTML = '<option value="">-- Select Best Player --</option>';

            // Add Team 1 players
            const team1Group = document.createElement('optgroup');
            team1Group.label = gameData.team1.name;
            gameData.team1.players.forEach(player => {
                const option = document.createElement('option');
                option.value = `team1-${player.id}`;
                option.textContent = player.name;
                team1Group.appendChild(option);
            });
            selector.appendChild(team1Group);

            // Add Team 2 players
            const team2Group = document.createElement('optgroup');
            team2Group.label = gameData.team2.name;
            gameData.team2.players.forEach(player => {
                const option = document.createElement('option');
                option.value = `team2-${player.id}`;
                option.textContent = player.name;
                team2Group.appendChild(option);
            });
            selector.appendChild(team2Group);

            // Set selected value if MVP is already chosen
            if (gameData.mvp && gameData.mvp.teamKey && gameData.mvp.playerId) {
                selector.value = `${gameData.mvp.teamKey}-${gameData.mvp.playerId}`;
            }
        }

        function setMVP() {
            const selector = document.getElementById('mvpSelector');
            const value = selector.value;

            if (!value) {
                gameData.mvp = null;
                updateMVPDisplay();
                saveGameData();
                return;
            }

            const [team, playerId] = value.split('-');
            const player = gameData[team].players.find(p => p.id === parseInt(playerId));

            if (player) {
                gameData.mvp = {
                    teamKey: team, // Store the team key (team1 or team2)
                    playerId: player.id,
                    name: player.name,
                    team: gameData[team].name
                };
                updateMVPDisplay();
                saveGameData();
            }
        }

        function updateMVPDisplay() {
            const display = document.getElementById('mvpDisplay');
            if (gameData.mvp && gameData.mvp.name) {
                display.textContent = `${gameData.mvp.name} (${gameData.mvp.team})`;
            } else {
                display.textContent = 'No player selected';
            }
        }

        function updateLiveScoreboard() {
            const team1Total = calculateTeamTotalPoints('team1');
            const team2Total = calculateTeamTotalPoints('team2');

            // Update team logos
            const team1Logo = document.getElementById('scoreTeam1Logo');
            const team2Logo = document.getElementById('scoreTeam2Logo');

            if (gameData.team1.logo) {
                team1Logo.src = gameData.team1.logo;
                team1Logo.style.display = 'block';
            } else {
                team1Logo.style.display = 'none';
            }

            if (gameData.team2.logo) {
                team2Logo.src = gameData.team2.logo;
                team2Logo.style.display = 'block';
            } else {
                team2Logo.style.display = 'none';
            }

            document.getElementById('scoreTeam1Value').textContent = team1Total;
            document.getElementById('scoreTeam2Value').textContent = team2Total;

            const quarterText = currentQuarter === 'total' ? 'Final' : `Q${currentQuarter}`;
            document.getElementById('currentQuarterDisplay').textContent = quarterText;
        }

        function calculateTeamTotalPoints(team) {
            let total = 0;
            gameData[team].players.forEach(player => {
                Object.values(player.quarterStats).forEach(qStats => {
                    total += qStats.points;
                });
            });
            return total;
        }

        // Make this function globally accessible for cast mode
        window.calculateTeamTotalPoints = calculateTeamTotalPoints;

        function updateTeamFoulsDisplay() {
            const q = currentQuarter === 'total' ? 1 : currentQuarter;
            document.getElementById('team1FoulsQuarter').textContent = q;
            document.getElementById('team2FoulsQuarter').textContent = q;
            document.getElementById('team1FoulsValue').textContent = gameData.team1.teamFouls[q] || 0;
            document.getElementById('team2FoulsValue').textContent = gameData.team2.teamFouls[q] || 0;
        }

        function updateTeamFouls(team, change) {
            const q = currentQuarter === 'total' ? 1 : currentQuarter;
            const oldValue = gameData[team].teamFouls[q] || 0;
            const newValue = Math.max(0, oldValue + change);

            recordAction({
                type: 'teamFouls',
                team: team,
                quarter: q,
                oldValue: oldValue
            });

            gameData[team].teamFouls[q] = newValue;
            updateTeamFoulsDisplay();
            saveGameData();
        }

        // Timeout Management Functions
        function useTimeout(team) {
            if (gameData[team].timeoutsRemaining <= 0) {
                alert('No timeouts remaining for this half!');
                return;
            }

            const oldValue = gameData[team].timeoutsRemaining;

            // Store action for team-specific undo
            lastTimeoutAction[team] = {
                oldValue: oldValue,
                timestamp: Date.now()
            };

            // Also store in main undo stack
            recordAction({
                type: 'timeout',
                team: team,
                oldValue: oldValue
            });

            gameData[team].timeoutsRemaining--;
            updateTimeoutDisplay();
            saveGameData();
        }

        function undoTimeout(team) {
            if (!lastTimeoutAction[team]) {
                return;
            }

            // Restore the timeout
            gameData[team].timeoutsRemaining = lastTimeoutAction[team].oldValue;

            // Clear the last action
            lastTimeoutAction[team] = null;

            updateTimeoutDisplay();
            saveGameData();
        }

        function updateTimeoutDisplay() {
            // Team 1
            const team1Icons = '‚è∏Ô∏è'.repeat(gameData.team1.timeoutsRemaining);
            document.getElementById('team1TimeoutIcons').textContent = team1Icons || '‚Äî';
            document.getElementById('team1TimeoutCount').textContent = `(${gameData.team1.timeoutsRemaining})`;

            const team1Btn = document.querySelector('.team1 .timeout-btn');
            if (team1Btn) {
                team1Btn.disabled = gameData.team1.timeoutsRemaining <= 0;
            }

            const team1UndoBtn = document.getElementById('team1TimeoutUndoBtn');
            if (team1UndoBtn) {
                team1UndoBtn.disabled = !lastTimeoutAction.team1;
            }

            // Team 2
            const team2Icons = '‚è∏Ô∏è'.repeat(gameData.team2.timeoutsRemaining);
            document.getElementById('team2TimeoutIcons').textContent = team2Icons || '‚Äî';
            document.getElementById('team2TimeoutCount').textContent = `(${gameData.team2.timeoutsRemaining})`;

            const team2Btn = document.querySelector('.team2 .timeout-btn');
            if (team2Btn) {
                team2Btn.disabled = gameData.team2.timeoutsRemaining <= 0;
            }

            const team2UndoBtn = document.getElementById('team2TimeoutUndoBtn');
            if (team2UndoBtn) {
                team2UndoBtn.disabled = !lastTimeoutAction.team2;
            }
        }

        function checkHalftimeTimeoutReset() {
            // When entering Q3 (start of 2nd half), reset timeouts to 3
            if (currentQuarter === 3 && gameData.team1.currentHalf === 1) {
                gameData.team1.currentHalf = 2;
                gameData.team1.timeoutsRemaining = 3;
                gameData.team2.currentHalf = 2;
                gameData.team2.timeoutsRemaining = 3;

                // Clear last timeout actions (can't undo across halves)
                lastTimeoutAction.team1 = null;
                lastTimeoutAction.team2 = null;

                updateTimeoutDisplay();
                saveGameData();

                // Show notification
                alert('Halftime! Timeouts reset to 3 for each team.');
            }
        }

        function renderQuarterSelector() {
            const selector = document.getElementById('quarterSelector');
            selector.innerHTML = '';

            for (let q = 1; q <= gameData.quarters; q++) {
                const btn = document.createElement('button');
                btn.className = 'quarter-btn' + (q === currentQuarter ? ' active' : '');

                if (q === currentQuarter) {
                    // Add team logos to active quarter
                    if (gameData.team1.logo) {
                        const logo1 = document.createElement('img');
                        logo1.src = gameData.team1.logo;
                        logo1.className = 'quarter-btn-logo';
                        logo1.alt = gameData.team1.name;
                        btn.appendChild(logo1);
                    }

                    const text = document.createElement('span');
                    text.textContent = `Quarter ${q}`;
                    btn.appendChild(text);

                    if (gameData.team2.logo) {
                        const logo2 = document.createElement('img');
                        logo2.src = gameData.team2.logo;
                        logo2.className = 'quarter-btn-logo';
                        logo2.alt = gameData.team2.name;
                        btn.appendChild(logo2);
                    }
                } else {
                    btn.textContent = `Quarter ${q}`;
                }

                btn.onclick = () => switchQuarter(q);
                selector.appendChild(btn);
            }

            const totalBtn = document.createElement('button');
            totalBtn.className = 'quarter-btn';
            totalBtn.textContent = 'Total';
            totalBtn.onclick = () => switchQuarter('total');
            selector.appendChild(totalBtn);
        }

        function switchQuarter(quarter) {
            currentQuarter = quarter;
            window.currentQuarter = quarter; // Update global for cast mode

            // Check if entering Q3 for halftime timeout reset
            checkHalftimeTimeoutReset();

            renderQuarterSelector();
            renderPlayers('team1', gameData.team1.players);
            renderPlayers('team2', gameData.team2.players);
            updateTotals();
            updateLiveScoreboard();
            updateTeamFoulsDisplay();
            saveGameData();
        }

        function createHeaderRow() {
            const header = document.createElement('div');
            header.className = 'player-row player-header';
            header.innerHTML = `
                <div>Player</div>
                <div></div>
                <div class="stat-label">Quick Score</div>
                <div class="stat-label">PTS</div>
                <div class="stat-label">REB</div>
                <div class="stat-label">AST</div>
                <div class="stat-label">STL</div>
                <div class="stat-label">BLK</div>
                <div class="stat-label">Fouls</div>
            `;
            return header;
        }

        function renderPlayers(team, players) {
            const startingContainer = document.getElementById(`${team}Starting`);
            const benchContainer = document.getElementById(`${team}Bench`);
            startingContainer.innerHTML = '';
            benchContainer.innerHTML = '';

            const starters = players.filter(p => p.isStarter);
            const bench = players.filter(p => !p.isStarter);

            // Add header to starting lineup
            startingContainer.appendChild(createHeaderRow());

            // Render starting lineup
            starters.forEach(player => {
                const row = createPlayerRow(player, team);
                startingContainer.appendChild(row);
            });

            // Add header to bench
            benchContainer.appendChild(createHeaderRow());

            // Render bench players
            bench.forEach(player => {
                const row = createPlayerRow(player, team);
                benchContainer.appendChild(row);
            });

            // Setup drag and drop
            setupDragAndDrop(team);
        }

        function createPlayerRow(player, team) {
            const row = document.createElement('div');
            row.className = 'player-row';
            row.draggable = true;
            row.dataset.playerId = player.id;
            row.dataset.team = team;

            const stats = currentQuarter === 'total'
                ? calculateTotalStats(player)
                : player.quarterStats[currentQuarter];

            const swapButtonText = player.isStarter ? '‚Üì Bench' : '‚Üë Start';

            row.innerHTML = `
                <div class="player-name">${player.name}</div>
                <button class="swap-btn" onclick="quickSwap('${team}', ${player.id})">${swapButtonText}</button>
                ${renderQuickScoreButtons(player.id, team)}
                ${renderStatControl('points', stats.points, player.id, team)}
                ${renderStatControl('rebounds', stats.rebounds, player.id, team)}
                ${renderStatControl('assists', stats.assists, player.id, team)}
                ${renderStatControl('steals', stats.steals, player.id, team)}
                ${renderStatControl('blocks', stats.blocks, player.id, team)}
                ${renderStatControl('fouls', stats.fouls, player.id, team)}
            `;

            return row;
        }

        function renderQuickScoreButtons(playerId, team) {
            if (currentQuarter === 'total') {
                return '<div></div>';
            }

            return `
                <div class="quick-score-btns">
                    <button class="quick-score-btn pt1" onclick="quickScore('${team}', ${playerId}, 1)">+1</button>
                    <button class="quick-score-btn pt2" onclick="quickScore('${team}', ${playerId}, 2)">+2</button>
                    <button class="quick-score-btn pt3" onclick="quickScore('${team}', ${playerId}, 3)">+3</button>
                </div>
            `;
        }

        function quickScore(team, playerId, points) {
            updateStat(team, playerId, 'points', points);
        }

        function quickSwap(team, playerId) {
            const player = gameData[team].players.find(p => p.id === playerId);

            if (player) {
                // Record action for undo
                recordAction({
                    type: 'starter',
                    team: team,
                    playerId: playerId,
                    oldValue: player.isStarter
                });

                // Toggle starter status
                player.isStarter = !player.isStarter;

                // Re-render players for this team
                renderPlayers(team, gameData[team].players);
                updateTotals();
                saveGameData();
            }
        }

        function setupDragAndDrop(team) {
            const startingContainer = document.getElementById(`${team}Starting`);
            const benchContainer = document.getElementById(`${team}Bench`);

            [startingContainer, benchContainer].forEach(container => {
                container.addEventListener('dragover', handleDragOver);
                container.addEventListener('drop', handleDrop);
                container.addEventListener('dragleave', handleDragLeave);

                const playerRows = container.querySelectorAll('.player-row');
                playerRows.forEach(row => {
                    row.addEventListener('dragstart', handleDragStart);
                    row.addEventListener('dragend', handleDragEnd);
                });
            });
        }

        let draggedElement = null;

        function handleDragStart(e) {
            draggedElement = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.innerHTML);
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');
            document.querySelectorAll('.drag-over').forEach(el => {
                el.classList.remove('drag-over');
            });
        }

        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.dataTransfer.dropEffect = 'move';
            this.classList.add('drag-over');
            return false;
        }

        function handleDragLeave(e) {
            this.classList.remove('drag-over');
        }

        function handleDrop(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }
            e.preventDefault();

            this.classList.remove('drag-over');

            if (draggedElement && draggedElement !== this) {
                const playerId = parseInt(draggedElement.dataset.playerId);
                const team = draggedElement.dataset.team;
                const player = gameData[team].players.find(p => p.id === playerId);

                if (player) {
                    // Record action for undo
                    recordAction({
                        type: 'starter',
                        team: team,
                        playerId: playerId,
                        oldValue: player.isStarter
                    });

                    // Toggle starter status based on drop target
                    const isDroppedOnStarting = this.id.includes('Starting');
                    player.isStarter = isDroppedOnStarting;

                    // Re-render players for this team
                    renderPlayers(team, gameData[team].players);
                    updateTotals();
                }
            }

            return false;
        }

        function renderStatControl(statName, value, playerId, team) {
            if (currentQuarter === 'total') {
                return `<div class="stat-value">${value}</div>`;
            }

            return `
                <div class="stat-control">
                    <button class="stat-btn minus" onclick="updateStat('${team}', ${playerId}, '${statName}', -1)">-</button>
                    <div class="stat-value">${value}</div>
                    <button class="stat-btn plus" onclick="updateStat('${team}', ${playerId}, '${statName}', 1)">+</button>
                </div>
            `;
        }

        function updateStat(team, playerId, statName, change) {
            const player = gameData[team].players.find(p => p.id === playerId);
            if (player) {
                const currentValue = player.quarterStats[currentQuarter][statName];
                const newValue = Math.max(0, currentValue + change);

                // Record action for undo
                recordAction({
                    type: 'stat',
                    team: team,
                    playerId: playerId,
                    statName: statName,
                    quarter: currentQuarter,
                    oldValue: currentValue
                });

                player.quarterStats[currentQuarter][statName] = newValue;
                renderPlayers(team, gameData[team].players);
                updateTotals();
                updateLiveScoreboard();
            }
        }

        function calculateTotalStats(player) {
            const total = {
                points: 0,
                rebounds: 0,
                assists: 0,
                steals: 0,
                blocks: 0,
                fouls: 0
            };
            Object.values(player.quarterStats).forEach(qStats => {
                total.points += qStats.points;
                total.rebounds += qStats.rebounds;
                total.assists += qStats.assists;
                total.steals += qStats.steals;
                total.blocks += qStats.blocks;
                total.fouls += qStats.fouls;
            });
            return total;
        }

        // Make this function globally accessible for cast mode
        window.calculateTotalStats = calculateTotalStats;

        function updateTotals() {
            const quarterLabel = currentQuarter === 'total' ? 'Game Total' : `Quarter ${currentQuarter}`;
            document.getElementById('team1TotalName').textContent = `${gameData.team1.name} - ${quarterLabel}`;
            document.getElementById('team2TotalName').textContent = `${gameData.team2.name} - ${quarterLabel}`;

            renderTeamTotals('team1');
            renderTeamTotals('team2');
        }

        function renderTeamTotals(team) {
            const container = document.getElementById(`${team}Totals`);
            const players = gameData[team].players;

            const totals = {
                points: 0,
                rebounds: 0,
                assists: 0,
                steals: 0,
                blocks: 0,
                fouls: 0
            };

            players.forEach(player => {
                const stats = currentQuarter === 'total'
                    ? calculateTotalStats(player)
                    : player.quarterStats[currentQuarter];

                totals.points += stats.points;
                totals.rebounds += stats.rebounds;
                totals.assists += stats.assists;
                totals.steals += stats.steals;
                totals.blocks += stats.blocks;
                totals.fouls += stats.fouls;
            });

            container.innerHTML = `
                <div class="total-stat">
                    <div class="total-stat-label">Points</div>
                    <div class="total-stat-value">${totals.points}</div>
                </div>
                <div class="total-stat">
                    <div class="total-stat-label">Rebounds</div>
                    <div class="total-stat-value">${totals.rebounds}</div>
                </div>
                <div class="total-stat">
                    <div class="total-stat-label">Assists</div>
                    <div class="total-stat-value">${totals.assists}</div>
                </div>
                <div class="total-stat">
                    <div class="total-stat-label">Steals</div>
                    <div class="total-stat-value">${totals.steals}</div>
                </div>
                <div class="total-stat">
                    <div class="total-stat-label">Blocks</div>
                    <div class="total-stat-value">${totals.blocks}</div>
                </div>
            `;
        }

        function exportCSV() {
            const team1Score = calculateTeamTotalPoints('team1');
            const team2Score = calculateTeamTotalPoints('team2');

            // Determine winner
            let winner = '';
            if (team1Score > team2Score) {
                winner = gameData.team1.name;
            } else if (team2Score > team1Score) {
                winner = gameData.team2.name;
            } else {
                winner = 'TIE';
            }

            // Start with game summary
            let csv = `GAME SUMMARY\n`;
            csv += `Game,${gameData.gameName}\n`;
            csv += `Date,${gameData.gameDate}\n`;
            csv += `\n`;
            csv += `FINAL SCORE\n`;
            csv += `${gameData.team1.name},${team1Score}\n`;
            csv += `${gameData.team2.name},${team2Score}\n`;
            csv += `\n`;
            csv += `WINNER,${winner}\n`;

            // Add MVP if selected
            if (gameData.mvp && gameData.mvp.name) {
                csv += `BEST PLAYER,${gameData.mvp.name} (${gameData.mvp.team})\n`;
            }
            csv += `\n`;

            // Team 1 Statistics
            csv += `${gameData.team1.name.toUpperCase()} - PLAYER STATISTICS\n`;
            csv += `Player,Points,Rebounds,Assists,Steals,Blocks,Fouls\n`;
            gameData.team1.players.forEach(player => {
                const total = calculateTotalStats(player);
                csv += `"${player.name}",${total.points},${total.rebounds},${total.assists},${total.steals},${total.blocks},${total.fouls}\n`;
            });

            csv += `\n`;

            // Team 2 Statistics
            csv += `${gameData.team2.name.toUpperCase()} - PLAYER STATISTICS\n`;
            csv += `Player,Points,Rebounds,Assists,Steals,Blocks,Fouls\n`;
            gameData.team2.players.forEach(player => {
                const total = calculateTotalStats(player);
                csv += `"${player.name}",${total.points},${total.rebounds},${total.assists},${total.steals},${total.blocks},${total.fouls}\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `${gameData.gameName.replace(/\s/g, '_')}_Summary_${gameData.gameDate}.csv`;
            link.click();
        }

        // Game History Management Functions
        function finishAndSaveGame() {
            if (!confirm('Finish and save this game? This will:\n- Export game summary to CSV\n- Save to game history')) return;

            // First, export CSV
            exportCSV();

            // Calculate final scores
            const team1Score = calculateTeamTotalPoints('team1');
            const team2Score = calculateTeamTotalPoints('team2');

            // Determine winner
            let winner = '';
            if (team1Score > team2Score) winner = gameData.team1.name;
            else if (team2Score > team1Score) winner = gameData.team2.name;
            else winner = 'TIE';

            // Calculate quarter scores
            const quarterScores = calculateQuarterScores();

            // Create game record
            const gameRecord = {
                id: Date.now(),
                gameName: gameData.gameName,
                gameDate: gameData.gameDate,
                finalScore: { team1: team1Score, team2: team2Score },
                winner: winner,
                team1: JSON.parse(JSON.stringify(gameData.team1)),
                team2: JSON.parse(JSON.stringify(gameData.team2)),
                quarterScores: quarterScores,
                quarters: gameData.quarters,
                mvp: gameData.mvp
            };

            // Save to history
            let history = JSON.parse(localStorage.getItem('basketballGameHistory') || '[]');
            history.unshift(gameRecord);  // Add to beginning

            // Limit to 100 games for performance
            if (history.length > 100) {
                history = history.slice(0, 100);
            }

            localStorage.setItem('basketballGameHistory', JSON.stringify(history));

            // Update season standings
            updateSeasonStandings(gameRecord);

            // Push to Firebase for cross-device sync
            pushHistoryToFirebase(history);

            // Success message - game data stays in tracker
            alert('‚úÖ Game saved successfully!\nüìÑ CSV file downloaded\nüìä History & standings updated\n\nGame data is still in the tracker. Use "Clear & Start New Game" when ready for a new game.');
        }

        function calculateQuarterScores() {
            const team1Scores = [];
            const team2Scores = [];

            for (let q = 1; q <= gameData.quarters; q++) {
                let team1Q = 0, team2Q = 0;

                gameData.team1.players.forEach(player => {
                    team1Q += player.quarterStats[q].points || 0;
                });
                gameData.team2.players.forEach(player => {
                    team2Q += player.quarterStats[q].points || 0;
                });

                team1Scores.push(team1Q);
                team2Scores.push(team2Q);
            }

            return { team1: team1Scores, team2: team2Scores };
        }

        function updateSeasonStandings(gameRecord) {
            let standings = JSON.parse(localStorage.getItem('basketballSeasonStandings') ||
                '{"teams": {}, "players": {}}');

            // Update team records
            const team1Name = gameRecord.team1.name;
            const team2Name = gameRecord.team2.name;

            if (!standings.teams[team1Name]) {
                standings.teams[team1Name] = { wins: 0, losses: 0, pointsFor: 0, pointsAgainst: 0 };
            }
            if (!standings.teams[team2Name]) {
                standings.teams[team2Name] = { wins: 0, losses: 0, pointsFor: 0, pointsAgainst: 0 };
            }

            // Update win/loss
            if (gameRecord.winner === team1Name) {
                standings.teams[team1Name].wins++;
                standings.teams[team2Name].losses++;
            } else if (gameRecord.winner === team2Name) {
                standings.teams[team2Name].wins++;
                standings.teams[team1Name].losses++;
            }
            // If TIE, neither team gets a win or loss

            // Update points
            standings.teams[team1Name].pointsFor += gameRecord.finalScore.team1;
            standings.teams[team1Name].pointsAgainst += gameRecord.finalScore.team2;
            standings.teams[team2Name].pointsFor += gameRecord.finalScore.team2;
            standings.teams[team2Name].pointsAgainst += gameRecord.finalScore.team1;
            standings.teams[team1Name].lastPlayed = gameRecord.gameDate;
            standings.teams[team2Name].lastPlayed = gameRecord.gameDate;

            // Update player stats
            updatePlayerSeasonStats(standings, gameRecord.team1, team1Name);
            updatePlayerSeasonStats(standings, gameRecord.team2, team2Name);

            localStorage.setItem('basketballSeasonStandings', JSON.stringify(standings));

            // Push standings to Firebase for cross-device sync
            pushStandingsToFirebase(standings);
        }

        function updatePlayerSeasonStats(standings, teamData, teamName) {
            teamData.players.forEach(player => {
                // Sanitize key for Firebase - replace invalid characters
                const sanitizedKey = `${teamName}_${player.name}`.replace(/[.#$\/\[\]]/g, '-');
                const totalStats = calculateTotalStats(player);

                if (!standings.players[sanitizedKey]) {
                    standings.players[sanitizedKey] = {
                        teamName: teamName,
                        playerName: player.name,
                        gamesPlayed: 0,
                        totalPoints: 0,
                        totalRebounds: 0,
                        totalAssists: 0,
                        totalSteals: 0,
                        totalBlocks: 0,
                        totalFouls: 0
                    };
                }

                const p = standings.players[sanitizedKey];
                p.gamesPlayed++;
                p.totalPoints += totalStats.points;
                p.totalRebounds += totalStats.rebounds;
                p.totalAssists += totalStats.assists;
                p.totalSteals += totalStats.steals;
                p.totalBlocks += totalStats.blocks;
                p.totalFouls += totalStats.fouls;
                p.avgPoints = parseFloat((p.totalPoints / p.gamesPlayed).toFixed(1));
                p.avgRebounds = parseFloat((p.totalRebounds / p.gamesPlayed).toFixed(1));
                p.avgAssists = parseFloat((p.totalAssists / p.gamesPlayed).toFixed(1));
            });
        }

        // Cast Mode - Open scoreboard in new window
        function openCastMode() {
            const team1Score = calculateTeamTotalPoints('team1');
            const team2Score = calculateTeamTotalPoints('team2');
            const quarterText = currentQuarter === 'total' ? 'FINAL' : 'QUARTER ' + currentQuarter;
            const q = currentQuarter === 'total' ? 1 : currentQuarter;
            const team1Fouls = gameData.team1.teamFouls[q] || 0;
            const team2Fouls = gameData.team2.teamFouls[q] || 0;

            // Get MVP info if available
            const showMVP = currentQuarter === 'total' && gameData.mvp && gameData.mvp.name;
            const mvpDisplay = showMVP ? 'inline-block' : 'none';
            const mvpName = showMVP ? `${gameData.mvp.name} (${gameData.mvp.team})` : '';

            // Get MVP stats - search through both teams
            let mvpStats = { points: 0, rebounds: 0, assists: 0, steals: 0, blocks: 0 };
            if (showMVP && gameData.mvp.teamKey) {
                // Directly access the player from the correct team
                const mvpPlayer = gameData[gameData.mvp.teamKey].players.find(p => p.id === gameData.mvp.playerId);

                if (mvpPlayer) {
                    // Calculate stats directly from quarterStats
                    Object.values(mvpPlayer.quarterStats).forEach(qStats => {
                        mvpStats.points += qStats.points || 0;
                        mvpStats.rebounds += qStats.rebounds || 0;
                        mvpStats.assists += qStats.assists || 0;
                        mvpStats.steals += qStats.steals || 0;
                        mvpStats.blocks += qStats.blocks || 0;
                    });
                }
            }

            const castWindow = window.open('', 'Cast Mode', 'width=1920,height=1080');

            castWindow.document.write(`
<!DOCTYPE html>
<html>
<head>
    <title>Live Scoreboard - ` + gameData.gameName + `</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: linear-gradient(135deg, rgba(26, 32, 44, 0.75) 0%, rgba(45, 55, 72, 0.85) 100%),
                        url('bellaLogo.jpg') center center / cover no-repeat fixed;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            position: relative;
        }
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, transparent 30%, rgba(0,0,0,0.4) 100%);
            pointer-events: none;
        }
        .cast-logo-display {
            width: 150px;
            height: 150px;
            object-fit: contain;
            margin-bottom: 30px;
            filter: drop-shadow(0 8px 24px rgba(0,0,0,0.8));
            position: relative;
            z-index: 10;
        }
        .scoreboard {
            text-align: center;
            padding: 60px;
            width: 100%;
        }
        .game-title {
            font-size: 3em;
            font-weight: 700;
            margin-bottom: 40px;
            color: #cbd5e0;
        }
        .quarter-display {
            font-size: 2.5em;
            font-weight: 600;
            margin-bottom: 30px;
            color: #a0aec0;
        }
        .timer-row {
            display: flex;
            justify-content: center;
            gap: 120px;
            margin-bottom: 60px;
        }
        .timer-box-cast {
            text-align: center;
            background: rgba(45, 55, 72, 0.6);
            padding: 30px 50px;
            border-radius: 20px;
            border: 3px solid rgba(72, 187, 120, 0.3);
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
        }
        .timer-label-cast {
            font-size: 2.5em;
            color: #cbd5e0;
            margin-bottom: 20px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        .timer-value-cast {
            font-size: 8em;
            font-weight: 900;
            color: #48bb78;
            font-family: 'Courier New', monospace;
            text-shadow: 0 6px 20px rgba(0,0,0,0.6), 0 0 40px rgba(72, 187, 120, 0.4);
            line-height: 1;
        }
        .score-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 100px;
        }
        .team-box {
            text-align: center;
            position: relative;
        }
        .team-logo-cast {
            width: 250px;
            height: 250px;
            object-fit: contain;
            margin: 0 auto 30px auto;
            display: block;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
        }
        .possession-indicator {
            font-size: 5em;
            margin: 20px 0;
            animation: bounce-possession 1.5s ease-in-out infinite;
            filter: drop-shadow(0 4px 16px rgba(249, 115, 22, 0.8));
            display: block;
            min-height: 100px;
        }
        .possession-indicator.hidden {
            opacity: 0;
            animation: none;
        }
        @keyframes bounce-possession {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-20px);
            }
        }
        .team-name {
            font-size: 4em;
            font-weight: 700;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 3px;
        }
        .team-score {
            font-size: 12em;
            font-weight: 900;
            color: #48bb78;
            text-shadow: 0 8px 16px rgba(0,0,0,0.5);
            margin-top: 10px;
        }
        .team-fouls {
            font-size: 1.8em;
            font-weight: 600;
            margin-top: 20px;
            color: #fc8181;
        }
        .vs-text {
            font-size: 4em;
            font-weight: 700;
            color: #718096;
        }
        .mvp-banner {
            margin-top: 60px;
            padding: 25px 40px;
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            border-radius: 15px;
            display: inline-block;
            box-shadow: 0 8px 20px rgba(243, 156, 18, 0.4);
        }
        .mvp-label {
            font-size: 1.8em;
            font-weight: 600;
            color: #fef5e7;
            margin-bottom: 10px;
        }
        .mvp-name {
            font-size: 3em;
            font-weight: 900;
            color: white;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 20px;
        }
        .mvp-stats {
            display: flex;
            gap: 25px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .mvp-stat-item {
            text-align: center;
        }
        .mvp-stat-label {
            font-size: 1em;
            color: #fef5e7;
            font-weight: 600;
            margin-bottom: 5px;
        }
        .mvp-stat-value {
            font-size: 2.5em;
            color: white;
            font-weight: 900;
        }
        .refresh-note {
            position: absolute;
            bottom: 30px;
            font-size: 1.5em;
            color: #718096;
        }
    <\/style>
    <script>
        setInterval(() => {
            if (window.opener && !window.opener.closed) {
                try {
                    const openerGameData = window.opener.gameData;
                    const openerCurrentQuarter = window.opener.currentQuarter;

                    if (openerGameData && window.opener.calculateTeamTotalPoints) {
                        const team1Score = window.opener.calculateTeamTotalPoints('team1');
                        const team2Score = window.opener.calculateTeamTotalPoints('team2');

                        document.getElementById('team1Score').textContent = team1Score;
                        document.getElementById('team2Score').textContent = team2Score;

                        const quarterText = openerCurrentQuarter === 'total' ? 'FINAL' : 'QUARTER ' + openerCurrentQuarter;
                        document.getElementById('quarterDisplay').textContent = quarterText;

                        // Update timers
                        const formatTime = (seconds) => {
                            const mins = Math.floor(seconds / 60);
                            const secs = seconds % 60;
                            return mins + ':' + (secs < 10 ? '0' : '') + secs;
                        };
                        document.getElementById('gameTimerCast').textContent = formatTime(openerGameData.gameTimer.currentSeconds);
                        document.getElementById('shotClockCast').textContent = openerGameData.shotClock.seconds;

                        const q = openerCurrentQuarter === 'total' ? 1 : openerCurrentQuarter;
                        const team1Fouls = openerGameData.team1.teamFouls[q] || 0;
                        const team2Fouls = openerGameData.team2.teamFouls[q] || 0;
                        document.getElementById('team1Fouls').textContent = 'Team Fouls: ' + team1Fouls;
                        document.getElementById('team2Fouls').textContent = 'Team Fouls: ' + team2Fouls;

                        // Update possession indicators
                        const team1Indicator = document.querySelector('.score-container .team-box:first-child .possession-indicator');
                        const team2Indicator = document.querySelector('.score-container .team-box:last-child .possession-indicator');

                        // Toggle hidden class based on possession
                        if (team1Indicator) {
                            if (openerGameData.possession === 'team1') {
                                team1Indicator.classList.remove('hidden');
                            } else {
                                team1Indicator.classList.add('hidden');
                            }
                        }

                        if (team2Indicator) {
                            if (openerGameData.possession === 'team2') {
                                team2Indicator.classList.remove('hidden');
                            } else {
                                team2Indicator.classList.add('hidden');
                            }
                        }

                        // Update MVP display
                        const mvpBanner = document.getElementById('mvpBanner');
                        if (openerCurrentQuarter === 'total' && openerGameData.mvp && openerGameData.mvp.name) {
                            mvpBanner.style.display = 'inline-block';
                            document.getElementById('mvpName').textContent = openerGameData.mvp.name + ' (' + openerGameData.mvp.team + ')';

                            // Update MVP stats - use teamKey to get the correct player
                            if (openerGameData.mvp.teamKey) {
                                const mvpPlayer = openerGameData[openerGameData.mvp.teamKey].players.find(p => p.id === openerGameData.mvp.playerId);

                                if (mvpPlayer) {
                                    // Calculate total stats directly from the player data
                                    let totalStats = { points: 0, rebounds: 0, assists: 0, steals: 0, blocks: 0 };
                                    Object.values(mvpPlayer.quarterStats).forEach(qStats => {
                                        totalStats.points += qStats.points || 0;
                                        totalStats.rebounds += qStats.rebounds || 0;
                                        totalStats.assists += qStats.assists || 0;
                                        totalStats.steals += qStats.steals || 0;
                                        totalStats.blocks += qStats.blocks || 0;
                                    });

                                    document.getElementById('mvpPoints').textContent = totalStats.points;
                                    document.getElementById('mvpRebounds').textContent = totalStats.rebounds;
                                    document.getElementById('mvpAssists').textContent = totalStats.assists;
                                    document.getElementById('mvpSteals').textContent = totalStats.steals;
                                    document.getElementById('mvpBlocks').textContent = totalStats.blocks;
                                }
                            }
                        } else {
                            mvpBanner.style.display = 'none';
                        }
                    }
                } catch(e) {
                    console.error('Error updating scoreboard:', e);
                }
            }
        }, 1000); // Update every 1 second for smooth timer sync
    <\/script>
<\/head>
<body>
    <img src="bellaLogo.jpg" alt="Bella Vista Logo" class="cast-logo-display">
    <div class="scoreboard">
        <div class="game-title">` + gameData.gameName + `</div>
        <div class="quarter-display" id="quarterDisplay">` + quarterText + `</div>
        <div class="timer-row">
            <div class="timer-box-cast">
                <div class="timer-label-cast">Game Time</div>
                <div class="timer-value-cast" id="gameTimerCast">` + formatTime(gameData.gameTimer.currentSeconds) + `</div>
            </div>
            <div class="timer-box-cast">
                <div class="timer-label-cast">Shot Clock</div>
                <div class="timer-value-cast" id="shotClockCast">` + gameData.shotClock.seconds + `</div>
            </div>
        </div>
        <div class="score-container">
            <div class="team-box">
                ` + (gameData.team1.logo ? `<img src="${gameData.team1.logo}" class="team-logo-cast" alt="${gameData.team1.name}">` : '') + `
                <div class="possession-indicator` + (gameData.possession !== 'team1' ? ' hidden' : '') + `">üèÄ</div>
                <div class="team-score" id="team1Score">` + team1Score + `</div>
                <div class="team-fouls" id="team1Fouls">Team Fouls: ` + team1Fouls + `</div>
            </div>
            <div class="vs-text">VS</div>
            <div class="team-box">
                ` + (gameData.team2.logo ? `<img src="${gameData.team2.logo}" class="team-logo-cast" alt="${gameData.team2.name}">` : '') + `
                <div class="possession-indicator` + (gameData.possession !== 'team2' ? ' hidden' : '') + `">üèÄ</div>
                <div class="team-score" id="team2Score">` + team2Score + `</div>
                <div class="team-fouls" id="team2Fouls">Team Fouls: ` + team2Fouls + `</div>
            </div>
        </div>
        <div class="mvp-banner" id="mvpBanner" style="display: ` + mvpDisplay + `;">
            <div class="mvp-label">üèÜ Best Player of the Game</div>
            <div class="mvp-name" id="mvpName">` + mvpName + `</div>
            <div class="mvp-stats">
                <div class="mvp-stat-item">
                    <div class="mvp-stat-label">PTS</div>
                    <div class="mvp-stat-value" id="mvpPoints">` + mvpStats.points + `</div>
                </div>
                <div class="mvp-stat-item">
                    <div class="mvp-stat-label">REB</div>
                    <div class="mvp-stat-value" id="mvpRebounds">` + mvpStats.rebounds + `</div>
                </div>
                <div class="mvp-stat-item">
                    <div class="mvp-stat-label">AST</div>
                    <div class="mvp-stat-value" id="mvpAssists">` + mvpStats.assists + `</div>
                </div>
                <div class="mvp-stat-item">
                    <div class="mvp-stat-label">STL</div>
                    <div class="mvp-stat-value" id="mvpSteals">` + mvpStats.steals + `</div>
                </div>
                <div class="mvp-stat-item">
                    <div class="mvp-stat-label">BLK</div>
                    <div class="mvp-stat-value" id="mvpBlocks">` + mvpStats.blocks + `</div>
                </div>
            </div>
        </div>
        <div class="refresh-note">üîÑ Auto-updating live</div>
    </div>
<\/body>
<\/html>
            `);

            castWindow.document.close();
        }

        // Setup screen functions
        function selectTeam(teamNumber, teamName) {
            // Get the grid container for this team
            const gridId = `team${teamNumber}SelectionGrid`;
            const grid = document.getElementById(gridId);

            // Remove 'selected' class from all cards in this grid
            const allCards = grid.querySelectorAll('.team-card');
            allCards.forEach(card => card.classList.remove('selected'));

            // Add 'selected' class to the clicked card
            const selectedCard = grid.querySelector(`[data-team="${teamName}"]`);
            if (selectedCard) {
                selectedCard.classList.add('selected');
            }

            // Update the hidden input value
            const selectorId = `team${teamNumber}Selector`;
            document.getElementById(selectorId).value = teamName;

            // Load players for this team
            loadTeamPlayers(teamNumber);

            // Auto-generate game name immediately
            updateGameName();
        }

        function loadTeamPlayers(teamNumber) {
            const selectorId = `team${teamNumber}Selector`;
            const playersInputId = `team${teamNumber}PlayersInput`;

            const teamName = document.getElementById(selectorId).value;
            const playersTextarea = document.getElementById(playersInputId);

            if (teamName && PREDEFINED_TEAMS[teamName]) {
                // Load players for selected team
                playersTextarea.value = PREDEFINED_TEAMS[teamName].join('\n');
            } else {
                playersTextarea.value = '';
            }

            // Auto-generate game name when both teams are selected
            updateGameName();
        }

        function updateGameName() {
            const team1 = document.getElementById('team1Selector').value;
            const team2 = document.getElementById('team2Selector').value;
            const gameNameInput = document.getElementById('gameNameInput');

            if (team1 && team2) {
                gameNameInput.value = `${team1} vs ${team2}`;
            }
        }

        function showSetupScreen() {
            document.getElementById('setupScreen').classList.remove('hidden');
        }

        function hideSetupScreen() {
            document.getElementById('setupScreen').classList.add('hidden');
        }

        function startGameFromForm(event) {
            event.preventDefault();

            const formData = {
                gameName: document.getElementById('gameNameInput').value,
                team1Name: document.getElementById('team1Selector').value,
                team2Name: document.getElementById('team2Selector').value,
                team1Players: document.getElementById('team1PlayersInput').value,
                team2Players: document.getElementById('team2PlayersInput').value,
                quarters: parseInt(document.getElementById('quartersInput').value),
                minutesPerQuarter: parseInt(document.getElementById('minutesPerQuarterInput').value)
            };

            hideSetupScreen();
            initializeGame(formData);
            return false;
        }

        // Check if we have saved data on page load
        window.addEventListener('DOMContentLoaded', function() {
            const saved = localStorage.getItem('basketballGameData');
            if (saved) {
                // Load existing game
                hideSetupScreen();
                loadGameData();
                renderGame();
            } else {
                // Show setup screen for new game
                showSetupScreen();
            }
        });
    </script>

    <!-- Firebase SDK for Live Updates -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
        // Firebase configuration for live updates
        const firebaseConfig = {
            apiKey: "AIzaSyCRjX0GdMHSNeykGuxclCgSc3XpY04-oEE",
            authDomain: "bella-vista-league-live-score.firebaseapp.com",
            databaseURL: "https://bella-vista-league-live-score-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "bella-vista-league-live-score",
            storageBucket: "bella-vista-league-live-score.firebasestorage.app",
            messagingSenderId: "563016772281",
            appId: "1:563016772281:web:e2c3b5d3a08c2bc9308968"
        };

        // Initialize Firebase
        let firebaseInitialized = false;
        let database = null;
        let liveUpdatesEnabled = false;

        function initializeFirebase() {
            try {
                if (!firebaseInitialized) {
                    firebase.initializeApp(firebaseConfig);
                    database = firebase.database();
                    firebaseInitialized = true;
                    console.log('Firebase initialized successfully');
                }
            } catch (error) {
                console.error('Firebase initialization failed:', error);
                // Continue without live updates
            }
        }

        // Push live updates to Firebase
        function pushLiveUpdate() {
            if (!database) return;

            try {
                const liveData = {
                    gameName: gameData.gameName,
                    gameDate: gameData.gameDate,
                    currentQuarter: currentQuarter,
                    team1: gameData.team1,
                    team2: gameData.team2,
                    mvp: gameData.mvp,
                    gameTimer: gameData.gameTimer,
                    shotClock: gameData.shotClock,
                    isLive: liveUpdatesEnabled,
                    lastUpdated: Date.now()
                };

                database.ref('liveGame').set(liveData);
            } catch (error) {
                console.error('Failed to push live update:', error);
            }
        }

        // Toggle live updates on/off
        function toggleLiveUpdates() {
            if (!firebaseInitialized) {
                initializeFirebase();
            }

            liveUpdatesEnabled = !liveUpdatesEnabled;

            const btn = document.getElementById('liveUpdatesBtn');
            if (btn) {
                if (liveUpdatesEnabled) {
                    btn.textContent = 'üì° Live: ON';
                    btn.style.background = '#48bb78';
                    pushLiveUpdate(); // Push initial update
                } else {
                    btn.textContent = 'üì° Live: OFF';
                    btn.style.background = '#718096';
                    pushLiveUpdate(); // Push final update with isLive = false
                }
            }

            localStorage.setItem('liveUpdatesEnabled', liveUpdatesEnabled);
        }

        // Load live updates preference
        function loadLiveUpdatesPreference() {
            const saved = localStorage.getItem('liveUpdatesEnabled');
            if (saved === 'true') {
                initializeFirebase();
                liveUpdatesEnabled = true;
                const btn = document.getElementById('liveUpdatesBtn');
                if (btn) {
                    btn.textContent = 'üì° Live: ON';
                    btn.style.background = '#48bb78';
                }
            }
        }

        // Override saveGameData to also push live updates
        const originalSaveGameData = saveGameData;
        saveGameData = function() {
            originalSaveGameData();
            if (liveUpdatesEnabled) {
                pushLiveUpdate();
            }
        };

        // Push game history to Firebase for cross-device sync
        function pushHistoryToFirebase(history) {
            if (!database) {
                console.log('Firebase not initialized, skipping history sync');
                return;
            }

            try {
                database.ref('gameHistory').set(history);
                console.log('‚úÖ Game history synced to Firebase');
            } catch (error) {
                console.error('Failed to push history to Firebase:', error);
            }
        }

        // Push season standings to Firebase for cross-device sync
        function pushStandingsToFirebase(standings) {
            if (!database) {
                console.log('Firebase not initialized, skipping standings sync');
                return;
            }

            try {
                database.ref('seasonStandings').set(standings);
                console.log('‚úÖ Season standings synced to Firebase');
            } catch (error) {
                console.error('Failed to push standings to Firebase:', error);
            }
        }

        // Load live updates preference on page load
        setTimeout(loadLiveUpdatesPreference, 1000);
    </script>


</body></html>
