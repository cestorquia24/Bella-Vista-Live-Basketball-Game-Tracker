<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game History & Standings</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, rgba(26, 32, 44, 0.75) 0%, rgba(45, 55, 72, 0.85) 100%),
                        url('bellaLogo.jpg') center center / cover no-repeat fixed;
            min-height: 100vh;
            padding: 20px;
            color: white;
            position: relative;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at top, transparent 20%, rgba(0,0,0,0.4) 100%);
            pointer-events: none;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .header-logo-display {
            width: 100px;
            height: 100px;
            object-fit: contain;
            display: block;
            margin: 0 auto 20px auto;
            filter: drop-shadow(0 6px 20px rgba(0,0,0,0.8));
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 15px;
            color: #48bb78;
        }

        .header-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .back-button {
            padding: 12px 30px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .back-button:hover {
            background: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .spectator-button {
            padding: 12px 30px;
            background: #48bb78;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .spectator-button:hover {
            background: #38a169;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(72, 187, 120, 0.4);
        }

        .admin-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #718096;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 100;
        }

        .admin-toggle:hover {
            background: #4a5568;
            transform: translateY(-2px);
        }

        .admin-toggle.active {
            background: #f56565;
            box-shadow: 0 4px 16px rgba(245, 101, 101, 0.5);
        }

        .admin-toggle.active:hover {
            background: #e53e3e;
        }

        /* Hide delete buttons by default, show only in admin mode */
        .delete-btn {
            display: none;
        }

        body.admin-mode .delete-btn {
            display: block;
        }

        /* Password Modal Styles */
        .password-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            align-items: center;
            justify-content: center;
        }

        .password-modal.active {
            display: flex;
        }

        .password-modal-content {
            background: #2d3748;
            border-radius: 12px;
            padding: 30px 40px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .password-modal h3 {
            color: #48bb78;
            margin-bottom: 20px;
            font-size: 1.5em;
            text-align: center;
        }

        .password-input-group {
            margin-bottom: 20px;
        }

        .password-input-group label {
            display: block;
            color: #cbd5e0;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .password-input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #4a5568;
            border-radius: 8px;
            background: #1a202c;
            color: white;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .password-input-group input:focus {
            outline: none;
            border-color: #48bb78;
        }

        .password-modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .password-modal-btn {
            padding: 10px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .password-modal-btn.submit {
            background: #48bb78;
            color: white;
        }

        .password-modal-btn.submit:hover {
            background: #38a169;
        }

        .password-modal-btn.cancel {
            background: #718096;
            color: white;
        }

        .password-modal-btn.cancel:hover {
            background: #4a5568;
        }

        .password-error {
            color: #fc8181;
            font-size: 0.9em;
            margin-top: 8px;
            display: none;
        }

        .password-error.show {
            display: block;
        }

        .tabs {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 15px 40px;
            background: rgba(45, 55, 72, 0.6);
            color: white;
            border: 2px solid rgba(102, 126, 234, 0.5);
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab-btn:hover {
            background: rgba(102, 126, 234, 0.3);
            border-color: #667eea;
        }

        .tab-btn.active {
            background: #667eea;
            border-color: #667eea;
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.5);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Game History Styles */
        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .game-card {
            background: rgba(45, 55, 72, 0.9);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.3);
            transition: all 0.3s;
        }

        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.5);
        }

        .game-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            gap: 15px;
        }

        .game-date {
            font-size: 0.9em;
            color: #cbd5e0;
        }

        .winner-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 700;
            background: #48bb78;
            color: white;
        }

        .winner-badge.tie {
            background: #718096;
        }

        .game-matchup {
            text-align: center;
            margin: 20px 0;
        }

        .team-logos-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 15px;
        }

        .team-logo-small {
            width: 60px;
            height: 60px;
            object-fit: contain;
            border-radius: 8px;
            padding: 5px;
        }

        .vs-small {
            font-size: 1.2em;
            font-weight: 700;
            color: #cbd5e0;
        }

        .game-score {
            font-size: 2em;
            font-weight: 900;
            color: #48bb78;
            margin-bottom: 10px;
        }

        .game-name {
            font-size: 0.9em;
            color: #a0aec0;
        }

        .game-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .game-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 6px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .view-btn {
            background: #667eea;
            color: white;
        }

        .view-btn:hover {
            background: #5a67d8;
        }

        .delete-btn {
            background: #f56565;
            color: white;
        }

        .delete-btn:hover {
            background: #e53e3e;
        }

        /* Table Styles */
        .table-container {
            background: rgba(45, 55, 72, 0.9);
            border-radius: 12px;
            padding: 20px;
            overflow-x: auto;
            box-shadow: 0 4px 16px rgba(0,0,0,0.3);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        th {
            background: rgba(102, 126, 234, 0.2);
            padding: 15px;
            text-align: left;
            font-weight: 700;
            color: #48bb78;
            border-bottom: 2px solid rgba(102, 126, 234, 0.5);
            cursor: pointer;
            user-select: none;
        }

        th:hover {
            background: rgba(102, 126, 234, 0.3);
        }

        td {
            padding: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            color: #e2e8f0;
        }

        tr:hover td {
            background: rgba(102, 126, 234, 0.1);
        }

        .rank-cell {
            font-weight: 900;
            font-size: 1.2em;
            color: #48bb78;
        }

        .team-cell {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .team-logo-table {
            width: 40px;
            height: 40px;
            object-fit: contain;
            border-radius: 6px;
            padding: 3px;
        }

        .stat-highlight {
            font-weight: 700;
            color: #48bb78;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: #2d3748;
            border-radius: 16px;
            padding: 40px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 2em;
            color: #cbd5e0;
            cursor: pointer;
            background: none;
            border: none;
            line-height: 1;
        }

        .modal-close:hover {
            color: white;
        }

        .modal-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .modal-header h2 {
            font-size: 2em;
            color: #48bb78;
            margin-bottom: 10px;
        }

        .modal-teams {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }

        .modal-team {
            background: rgba(45, 55, 72, 0.6);
            padding: 20px;
            border-radius: 12px;
        }

        .modal-team h3 {
            font-size: 1.5em;
            margin-bottom: 15px;
            color: #667eea;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .modal-player {
            padding: 10px;
            margin: 5px 0;
            background: rgba(255,255,255,0.05);
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .player-name-modal {
            font-weight: 600;
            color: white;
        }

        .player-stats-modal {
            display: flex;
            gap: 10px;
            font-size: 0.9em;
            color: #cbd5e0;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #a0aec0;
        }

        .empty-state-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .empty-state-text {
            font-size: 1.3em;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .games-grid {
                grid-template-columns: 1fr;
            }

            .modal-teams {
                grid-template-columns: 1fr;
            }

            .tabs {
                flex-direction: column;
            }

            .tab-btn {
                width: 100%;
            }

            table {
                font-size: 0.9em;
            }

            th, td {
                padding: 10px 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <img src="bellaLogo.jpg" alt="Bella Vista Logo" class="header-logo-display">

        <div class="header">
            <h1>üìä Game History & Standings</h1>
            <div class="header-buttons">
                <a href="spectator.html" class="spectator-button">üì∫ View Live Game</a>
            </div>
        </div>

        <button class="admin-toggle" id="adminToggle" onclick="toggleAdminMode()">üîì Admin Mode</button>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('history')">üèÄ Game History</button>
            <button class="tab-btn" onclick="switchTab('teams')">üèÜ Team Standings</button>
            <button class="tab-btn" onclick="switchTab('players')">‚≠ê Player Stats</button>
        </div>

        <!-- Game History Tab -->
        <div id="historyTab" class="tab-content active">
            <div id="gamesGrid" class="games-grid"></div>
            <div id="emptyHistory" class="empty-state" style="display: none;">
                <div class="empty-state-icon">üèÄ</div>
                <div class="empty-state-text">No games saved yet</div>
                <p style="color: #718096;">Finish and save a game from the tracker to see it here.</p>
            </div>
        </div>

        <!-- Team Standings Tab -->
        <div id="teamsTab" class="tab-content">
            <div class="table-container">
                <table id="teamsTable">
                    <thead>
                        <tr>
                            <th onclick="sortTeams('rank')">Rank</th>
                            <th onclick="sortTeams('team')">Team</th>
                            <th onclick="sortTeams('record')">Record</th>
                            <th onclick="sortTeams('winPct')">Win %</th>
                            <th onclick="sortTeams('pointsFor')">PF</th>
                            <th onclick="sortTeams('pointsAgainst')">PA</th>
                            <th onclick="sortTeams('pointDiff')">+/-</th>
                            <th onclick="sortTeams('lastPlayed')">Last Game</th>
                        </tr>
                    </thead>
                    <tbody id="teamsTableBody"></tbody>
                </table>
            </div>
            <div id="emptyTeams" class="empty-state" style="display: none;">
                <div class="empty-state-icon">üèÜ</div>
                <div class="empty-state-text">No team records yet</div>
                <p style="color: #718096;">Team standings will appear after saving your first game.</p>
            </div>
        </div>

        <!-- Player Stats Tab -->
        <div id="playersTab" class="tab-content">
            <div class="table-container">
                <table id="playersTable">
                    <thead>
                        <tr>
                            <th onclick="sortPlayers('name')">Player</th>
                            <th onclick="sortPlayers('team')">Team</th>
                            <th onclick="sortPlayers('games')">GP</th>
                            <th onclick="sortPlayers('ppg')">PPG</th>
                            <th onclick="sortPlayers('rpg')">RPG</th>
                            <th onclick="sortPlayers('apg')">APG</th>
                            <th onclick="sortPlayers('spg')">SPG</th>
                            <th onclick="sortPlayers('bpg')">BPG</th>
                            <th onclick="sortPlayers('points')">Total PTS</th>
                        </tr>
                    </thead>
                    <tbody id="playersTableBody"></tbody>
                </table>
            </div>
            <div id="emptyPlayers" class="empty-state" style="display: none;">
                <div class="empty-state-icon">‚≠ê</div>
                <div class="empty-state-text">No player stats yet</div>
                <p style="color: #718096;">Player statistics will appear after saving your first game.</p>
            </div>
        </div>
    </div>

    <!-- Game Details Modal -->
    <div id="gameModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">&times;</button>
            <div id="modalBody"></div>
        </div>
    </div>

    <!-- Password Modal -->
    <div id="passwordModal" class="password-modal">
        <div class="password-modal-content">
            <h3>üîê Admin Authentication</h3>
            <div class="password-input-group">
                <label for="adminPasswordInput">Enter Admin Password:</label>
                <input type="password" id="adminPasswordInput" placeholder="Password" autocomplete="off">
                <div class="password-error" id="passwordError">Incorrect password!</div>
            </div>
            <div class="password-modal-buttons">
                <button class="password-modal-btn cancel" onclick="closePasswordModal()">Cancel</button>
                <button class="password-modal-btn submit" onclick="submitPassword()">Submit</button>
            </div>
        </div>
    </div>

    <script>
        let currentTab = 'history';
        let gameHistory = [];
        let seasonStandings = { teams: {}, players: {} };
        let currentSort = { column: null, order: 'asc' };
        let isAdminMode = false;

        // Admin Mode Functions
        function toggleAdminMode() {
            if (isAdminMode) {
                // Exit admin mode
                isAdminMode = false;
                sessionStorage.removeItem('adminMode');
                document.body.classList.remove('admin-mode');
                document.getElementById('adminToggle').textContent = 'üîì Admin Mode';
                document.getElementById('adminToggle').classList.remove('active');
            } else {
                // Enter admin mode - show password modal
                showPasswordModal();
            }
        }

        function showPasswordModal() {
            const modal = document.getElementById('passwordModal');
            const input = document.getElementById('adminPasswordInput');
            const error = document.getElementById('passwordError');

            // Reset modal state
            input.value = '';
            error.classList.remove('show');

            // Show modal and focus input
            modal.classList.add('active');
            setTimeout(() => input.focus(), 100);
        }

        function closePasswordModal() {
            const modal = document.getElementById('passwordModal');
            const input = document.getElementById('adminPasswordInput');
            const error = document.getElementById('passwordError');

            input.value = '';
            error.classList.remove('show');
            modal.classList.remove('active');
        }

        function submitPassword() {
            const input = document.getElementById('adminPasswordInput');
            const error = document.getElementById('passwordError');
            const password = input.value;

            if (password === 'Hoopers') {
                // Correct password - enable admin mode
                isAdminMode = true;
                sessionStorage.setItem('adminMode', 'true');
                document.body.classList.add('admin-mode');
                document.getElementById('adminToggle').textContent = 'üîí Exit Admin';
                document.getElementById('adminToggle').classList.add('active');
                closePasswordModal();
            } else {
                // Incorrect password - show error
                error.classList.add('show');
                input.value = '';
                input.focus();
            }
        }

        // Handle Enter key in password input
        document.addEventListener('DOMContentLoaded', function() {
            const passwordInput = document.getElementById('adminPasswordInput');
            if (passwordInput) {
                passwordInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        submitPassword();
                    }
                });
            }
        });

        // Close modal when clicking outside
        document.addEventListener('click', function(e) {
            const modal = document.getElementById('passwordModal');
            if (e.target === modal) {
                closePasswordModal();
            }
        });

        // Load data on page load
        window.addEventListener('DOMContentLoaded', function() {
            // Check if admin mode was previously enabled
            if (sessionStorage.getItem('adminMode') === 'true') {
                isAdminMode = true;
                document.body.classList.add('admin-mode');
                document.getElementById('adminToggle').textContent = 'üîí Exit Admin';
                document.getElementById('adminToggle').classList.add('active');
            }

            loadData();
            renderCurrentTab();

            // Auto-refresh every 2 seconds to pick up new games from other tabs
            setInterval(function() {
                loadData();
                renderCurrentTab();
            }, 2000);
        });

        // Also refresh when tab becomes visible
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                loadData();
                renderCurrentTab();
            }
        });

        function loadData() {
            try {
                gameHistory = JSON.parse(localStorage.getItem('basketballGameHistory') || '[]');
                seasonStandings = JSON.parse(localStorage.getItem('basketballSeasonStandings') ||
                    '{"teams": {}, "players": {}}');
            } catch (e) {
                console.error('Error loading data:', e);
                gameHistory = [];
                seasonStandings = { teams: {}, players: {} };
            }
        }

        function switchTab(tab) {
            currentTab = tab;

            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            if (tab === 'history') {
                document.getElementById('historyTab').classList.add('active');
            } else if (tab === 'teams') {
                document.getElementById('teamsTab').classList.add('active');
            } else if (tab === 'players') {
                document.getElementById('playersTab').classList.add('active');
            }

            renderCurrentTab();
        }

        function renderCurrentTab() {
            if (currentTab === 'history') {
                renderGameHistory();
            } else if (currentTab === 'teams') {
                renderTeamStandings();
            } else if (currentTab === 'players') {
                renderPlayerStats();
            }
        }

        function renderGameHistory() {
            const grid = document.getElementById('gamesGrid');
            const empty = document.getElementById('emptyHistory');

            if (gameHistory.length === 0) {
                grid.innerHTML = '';
                empty.style.display = 'block';
                return;
            }

            empty.style.display = 'none';
            grid.innerHTML = '';

            gameHistory.forEach(game => {
                const card = document.createElement('div');
                card.className = 'game-card';

                const winnerBadgeClass = game.winner === 'TIE' ? 'winner-badge tie' : 'winner-badge';
                const winnerText = game.winner === 'TIE' ? 'TIE GAME' : `üèÜ ${game.winner}`;

                card.innerHTML = `
                    <div class="game-card-header">
                        <div class="game-date">${game.gameDate}</div>
                        <div class="${winnerBadgeClass}">${winnerText}</div>
                    </div>
                    <div class="game-matchup">
                        <div class="team-logos-row">
                            ${game.team1.logo ? `<img src="${game.team1.logo}" class="team-logo-small" alt="${game.team1.name}">` : ''}
                            <div class="vs-small">VS</div>
                            ${game.team2.logo ? `<img src="${game.team2.logo}" class="team-logo-small" alt="${game.team2.name}">` : ''}
                        </div>
                        <div class="game-score">${game.finalScore.team1} - ${game.finalScore.team2}</div>
                        <div class="game-name">${game.gameName}</div>
                    </div>
                    <div class="game-actions">
                        <button class="game-btn view-btn" onclick="viewGameDetails(${game.id})">üëÅÔ∏è View Details</button>
                        <button class="game-btn delete-btn" onclick="deleteGame(${game.id})">üóëÔ∏è Delete</button>
                    </div>
                `;

                grid.appendChild(card);
            });
        }

        function renderTeamStandings() {
            const tbody = document.getElementById('teamsTableBody');
            const empty = document.getElementById('emptyTeams');
            const teams = Object.keys(seasonStandings.teams);

            if (teams.length === 0) {
                tbody.innerHTML = '';
                empty.style.display = 'block';
                return;
            }

            empty.style.display = 'none';

            // Convert to array and sort by wins
            const teamsArray = teams.map(name => ({
                name: name,
                ...seasonStandings.teams[name],
                winPct: calculateWinPercentage(seasonStandings.teams[name]),
                pointDiff: seasonStandings.teams[name].pointsFor - seasonStandings.teams[name].pointsAgainst
            }));

            teamsArray.sort((a, b) => b.wins - a.wins || b.pointDiff - a.pointDiff);

            tbody.innerHTML = '';
            teamsArray.forEach((team, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="rank-cell">#${index + 1}</td>
                    <td>
                        <div class="team-cell">
                            <div>${team.name}</div>
                        </div>
                    </td>
                    <td class="stat-highlight">${team.wins}-${team.losses}</td>
                    <td>${team.winPct}</td>
                    <td>${team.pointsFor}</td>
                    <td>${team.pointsAgainst}</td>
                    <td class="stat-highlight">${team.pointDiff > 0 ? '+' : ''}${team.pointDiff}</td>
                    <td>${team.lastPlayed || '-'}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function renderPlayerStats() {
            const tbody = document.getElementById('playersTableBody');
            const empty = document.getElementById('emptyPlayers');
            const players = Object.values(seasonStandings.players);

            if (players.length === 0) {
                tbody.innerHTML = '';
                empty.style.display = 'block';
                return;
            }

            empty.style.display = 'none';

            // Sort by PPG by default
            players.sort((a, b) => b.avgPoints - a.avgPoints);

            tbody.innerHTML = '';
            players.forEach(player => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="stat-highlight">${player.playerName}</td>
                    <td>${player.teamName}</td>
                    <td>${player.gamesPlayed}</td>
                    <td class="stat-highlight">${player.avgPoints}</td>
                    <td>${player.avgRebounds}</td>
                    <td>${player.avgAssists}</td>
                    <td>${(player.totalSteals / player.gamesPlayed).toFixed(1)}</td>
                    <td>${(player.totalBlocks / player.gamesPlayed).toFixed(1)}</td>
                    <td>${player.totalPoints}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function calculateWinPercentage(team) {
            const total = team.wins + team.losses;
            if (total === 0) return '0.000';
            return ((team.wins / total) * 100).toFixed(1) + '%';
        }

        function viewGameDetails(gameId) {
            const game = gameHistory.find(g => g.id === gameId);
            if (!game) return;

            const modalBody = document.getElementById('modalBody');

            let modalHTML = `
                <div class="modal-header">
                    <h2>${game.gameName}</h2>
                    <div style="color: #cbd5e0; font-size: 1.1em;">${game.gameDate}</div>
                    <div style="font-size: 3em; font-weight: 900; color: #48bb78; margin: 20px 0;">
                        ${game.finalScore.team1} - ${game.finalScore.team2}
                    </div>
                    ${game.winner !== 'TIE' ? `<div style="font-size: 1.3em; color: #48bb78;">üèÜ Winner: ${game.winner}</div>` : '<div style="font-size: 1.3em; color: #718096;">TIE GAME</div>'}
                    ${game.mvp ? `<div style="margin-top: 15px; font-size: 1.1em; color: #f39c12;">‚≠ê MVP: ${game.mvp.name}</div>` : ''}
                </div>
                <div class="modal-teams">
            `;

            // Team 1 Players
            modalHTML += `
                <div class="modal-team">
                    <h3>${game.team1.name}</h3>
            `;

            game.team1.players.forEach(player => {
                let totalPoints = 0, totalRebounds = 0, totalAssists = 0, totalSteals = 0, totalBlocks = 0;
                Object.values(player.quarterStats).forEach(qStats => {
                    totalPoints += qStats.points || 0;
                    totalRebounds += qStats.rebounds || 0;
                    totalAssists += qStats.assists || 0;
                    totalSteals += qStats.steals || 0;
                    totalBlocks += qStats.blocks || 0;
                });

                if (totalPoints > 0 || totalRebounds > 0 || totalAssists > 0) {
                    modalHTML += `
                        <div class="modal-player">
                            <div class="player-name-modal">${player.name}</div>
                            <div class="player-stats-modal">
                                <span><strong>${totalPoints}</strong> PTS</span>
                                <span><strong>${totalRebounds}</strong> REB</span>
                                <span><strong>${totalAssists}</strong> AST</span>
                            </div>
                        </div>
                    `;
                }
            });

            modalHTML += `</div>`;

            // Team 2 Players
            modalHTML += `
                <div class="modal-team">
                    <h3>${game.team2.name}</h3>
            `;

            game.team2.players.forEach(player => {
                let totalPoints = 0, totalRebounds = 0, totalAssists = 0;
                Object.values(player.quarterStats).forEach(qStats => {
                    totalPoints += qStats.points || 0;
                    totalRebounds += qStats.rebounds || 0;
                    totalAssists += qStats.assists || 0;
                });

                if (totalPoints > 0 || totalRebounds > 0 || totalAssists > 0) {
                    modalHTML += `
                        <div class="modal-player">
                            <div class="player-name-modal">${player.name}</div>
                            <div class="player-stats-modal">
                                <span><strong>${totalPoints}</strong> PTS</span>
                                <span><strong>${totalRebounds}</strong> REB</span>
                                <span><strong>${totalAssists}</strong> AST</span>
                            </div>
                        </div>
                    `;
                }
            });

            modalHTML += `</div></div>`;

            modalBody.innerHTML = modalHTML;
            document.getElementById('gameModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('gameModal').classList.remove('active');
        }

        function deleteGame(gameId) {
            if (!confirm('Delete this game from history? This will also recalculate season standings.')) {
                return;
            }

            // Remove game from history
            gameHistory = gameHistory.filter(g => g.id !== gameId);
            localStorage.setItem('basketballGameHistory', JSON.stringify(gameHistory));

            // Recalculate standings from scratch
            recalculateStandings();

            // Re-render
            renderCurrentTab();
            alert('Game deleted successfully!');
        }

        function recalculateStandings() {
            // Reset standings
            seasonStandings = { teams: {}, players: {} };

            // Recalculate from all games
            gameHistory.forEach(game => {
                updateSeasonStandingsFromGame(game);
            });

            localStorage.setItem('basketballSeasonStandings', JSON.stringify(seasonStandings));
        }

        function updateSeasonStandingsFromGame(gameRecord) {
            const team1Name = gameRecord.team1.name;
            const team2Name = gameRecord.team2.name;

            // Initialize teams if needed
            if (!seasonStandings.teams[team1Name]) {
                seasonStandings.teams[team1Name] = { wins: 0, losses: 0, pointsFor: 0, pointsAgainst: 0 };
            }
            if (!seasonStandings.teams[team2Name]) {
                seasonStandings.teams[team2Name] = { wins: 0, losses: 0, pointsFor: 0, pointsAgainst: 0 };
            }

            // Update win/loss
            if (gameRecord.winner === team1Name) {
                seasonStandings.teams[team1Name].wins++;
                seasonStandings.teams[team2Name].losses++;
            } else if (gameRecord.winner === team2Name) {
                seasonStandings.teams[team2Name].wins++;
                seasonStandings.teams[team1Name].losses++;
            }

            // Update points
            seasonStandings.teams[team1Name].pointsFor += gameRecord.finalScore.team1;
            seasonStandings.teams[team1Name].pointsAgainst += gameRecord.finalScore.team2;
            seasonStandings.teams[team2Name].pointsFor += gameRecord.finalScore.team2;
            seasonStandings.teams[team2Name].pointsAgainst += gameRecord.finalScore.team1;
            seasonStandings.teams[team1Name].lastPlayed = gameRecord.gameDate;
            seasonStandings.teams[team2Name].lastPlayed = gameRecord.gameDate;

            // Update player stats
            updatePlayerStatsFromGame(gameRecord.team1, team1Name);
            updatePlayerStatsFromGame(gameRecord.team2, team2Name);
        }

        function updatePlayerStatsFromGame(teamData, teamName) {
            teamData.players.forEach(player => {
                const key = `${teamName}_${player.name}`;

                // Calculate totals for this game
                let totalPoints = 0, totalRebounds = 0, totalAssists = 0, totalSteals = 0, totalBlocks = 0, totalFouls = 0;
                Object.values(player.quarterStats).forEach(qStats => {
                    totalPoints += qStats.points || 0;
                    totalRebounds += qStats.rebounds || 0;
                    totalAssists += qStats.assists || 0;
                    totalSteals += qStats.steals || 0;
                    totalBlocks += qStats.blocks || 0;
                    totalFouls += qStats.fouls || 0;
                });

                if (!seasonStandings.players[key]) {
                    seasonStandings.players[key] = {
                        teamName: teamName,
                        playerName: player.name,
                        gamesPlayed: 0,
                        totalPoints: 0,
                        totalRebounds: 0,
                        totalAssists: 0,
                        totalSteals: 0,
                        totalBlocks: 0,
                        totalFouls: 0
                    };
                }

                const p = seasonStandings.players[key];
                p.gamesPlayed++;
                p.totalPoints += totalPoints;
                p.totalRebounds += totalRebounds;
                p.totalAssists += totalAssists;
                p.totalSteals += totalSteals;
                p.totalBlocks += totalBlocks;
                p.totalFouls += totalFouls;
                p.avgPoints = parseFloat((p.totalPoints / p.gamesPlayed).toFixed(1));
                p.avgRebounds = parseFloat((p.totalRebounds / p.gamesPlayed).toFixed(1));
                p.avgAssists = parseFloat((p.totalAssists / p.gamesPlayed).toFixed(1));
            });
        }

        function sortTeams(column) {
            // Sorting logic can be added here if needed
        }

        function sortPlayers(column) {
            // Sorting logic can be added here if needed
        }

        // Close modal when clicking outside
        document.getElementById('gameModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
    </script>
</body>
</html>
