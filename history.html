<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game History & Standings</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, rgba(26, 32, 44, 0.75) 0%, rgba(45, 55, 72, 0.85) 100%),
                        url('bellaLogo.jpg') center center / cover no-repeat fixed;
            min-height: 100vh;
            padding: 20px;
            color: white;
            position: relative;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at top, transparent 20%, rgba(0,0,0,0.4) 100%);
            pointer-events: none;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .header-logo-display {
            width: 100px;
            height: 100px;
            object-fit: contain;
            display: block;
            margin: 0 auto 20px auto;
            filter: drop-shadow(0 6px 20px rgba(0,0,0,0.8));
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 15px;
            color: #48bb78;
        }

        .header-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .back-button {
            padding: 12px 30px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .back-button:hover {
            background: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .spectator-button {
            padding: 12px 30px;
            background: #48bb78;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .spectator-button:hover {
            background: #38a169;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(72, 187, 120, 0.4);
        }

        .admin-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #718096;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 100;
        }

        .admin-toggle:hover {
            background: #4a5568;
            transform: translateY(-2px);
        }

        .admin-toggle.active {
            background: #f56565;
            box-shadow: 0 4px 16px rgba(245, 101, 101, 0.5);
        }

        .admin-toggle.active:hover {
            background: #e53e3e;
        }

        /* Hide delete buttons by default, show only in admin mode */
        .delete-btn {
            display: none;
        }

        body.admin-mode .delete-btn {
            display: block;
        }

        /* Hide edit MVP buttons by default, show only in admin mode */
        .edit-mvp-btn {
            display: none;
        }

        body.admin-mode .edit-mvp-btn {
            display: inline-block;
        }

        /* Password Modal Styles */
        .password-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            align-items: center;
            justify-content: center;
        }

        .password-modal.active {
            display: flex;
        }

        .password-modal-content {
            background: #2d3748;
            border-radius: 12px;
            padding: 30px 40px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .password-modal h3 {
            color: #48bb78;
            margin-bottom: 20px;
            font-size: 1.5em;
            text-align: center;
        }

        .password-input-group {
            margin-bottom: 20px;
        }

        .password-input-group label {
            display: block;
            color: #cbd5e0;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .password-input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #4a5568;
            border-radius: 8px;
            background: #1a202c;
            color: white;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .password-input-group input:focus {
            outline: none;
            border-color: #48bb78;
        }

        .password-modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .password-modal-btn {
            padding: 10px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .password-modal-btn.submit {
            background: #48bb78;
            color: white;
        }

        .password-modal-btn.submit:hover {
            background: #38a169;
        }

        .password-modal-btn.cancel {
            background: #718096;
            color: white;
        }

        .password-modal-btn.cancel:hover {
            background: #4a5568;
        }

        .password-error {
            color: #fc8181;
            font-size: 0.9em;
            margin-top: 8px;
            display: none;
        }

        .password-error.show {
            display: block;
        }

        .tabs {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 15px 40px;
            background: rgba(45, 55, 72, 0.6);
            color: white;
            border: 2px solid rgba(102, 126, 234, 0.5);
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab-btn:hover {
            background: rgba(102, 126, 234, 0.3);
            border-color: #667eea;
        }

        .tab-btn.active {
            background: #667eea;
            border-color: #667eea;
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.5);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Game History Styles */
        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .game-card {
            background: rgba(45, 55, 72, 0.9);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.3);
            transition: all 0.3s;
        }

        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.5);
        }

        .game-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            gap: 15px;
        }

        .game-date {
            font-size: 0.9em;
            color: #cbd5e0;
        }

        .winner-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 700;
            background: #48bb78;
            color: white;
        }

        .winner-badge.tie {
            background: #718096;
        }

        .game-matchup {
            text-align: center;
            margin: 20px 0;
        }

        .team-logos-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 15px;
        }

        .team-logo-small {
            width: 60px;
            height: 60px;
            object-fit: contain;
            border-radius: 8px;
            padding: 5px;
        }

        .vs-small {
            font-size: 1.2em;
            font-weight: 700;
            color: #cbd5e0;
        }

        .game-score {
            font-size: 2em;
            font-weight: 900;
            color: #48bb78;
            margin-bottom: 10px;
        }

        .game-name {
            font-size: 0.9em;
            color: #a0aec0;
        }

        .game-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .game-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 6px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .view-btn {
            background: #667eea;
            color: white;
        }

        .view-btn:hover {
            background: #5a67d8;
        }

        .delete-btn {
            background: #f56565;
            color: white;
        }

        .delete-btn:hover {
            background: #e53e3e;
        }

        .reorder-btn {
            background: #9f7aea;
            color: white;
        }

        .reorder-btn:hover {
            background: #805ad5;
        }

        .reorder-btn:disabled {
            background: #cbd5e0;
            color: #a0aec0;
            cursor: not-allowed;
            opacity: 0.5;
        }

        /* Table Styles */
        .table-container {
            background: rgba(45, 55, 72, 0.9);
            border-radius: 12px;
            padding: 20px;
            overflow-x: auto;
            box-shadow: 0 4px 16px rgba(0,0,0,0.3);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        th {
            background: rgba(102, 126, 234, 0.2);
            padding: 15px;
            text-align: left;
            font-weight: 700;
            color: #48bb78;
            border-bottom: 2px solid rgba(102, 126, 234, 0.5);
            cursor: pointer;
            user-select: none;
        }

        th:hover {
            background: rgba(102, 126, 234, 0.3);
        }

        td {
            padding: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            color: #e2e8f0;
        }

        tr:hover td {
            background: rgba(102, 126, 234, 0.1);
        }

        .rank-cell {
            font-weight: 900;
            font-size: 1.2em;
            color: #48bb78;
        }

        .team-cell {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .team-logo-table {
            width: 40px;
            height: 40px;
            object-fit: contain;
            border-radius: 6px;
            padding: 3px;
        }

        .stat-highlight {
            font-weight: 700;
            color: #48bb78;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: #2d3748;
            border-radius: 16px;
            padding: 40px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 2em;
            color: #cbd5e0;
            cursor: pointer;
            background: none;
            border: none;
            line-height: 1;
        }

        .modal-close:hover {
            color: white;
        }

        .modal-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .modal-header h2 {
            font-size: 2em;
            color: #48bb78;
            margin-bottom: 10px;
        }

        .modal-teams {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }

        .modal-team {
            background: rgba(45, 55, 72, 0.6);
            padding: 20px;
            border-radius: 12px;
        }

        .modal-team h3 {
            font-size: 1.5em;
            margin-bottom: 15px;
            color: #667eea;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .modal-player {
            padding: 10px;
            margin: 5px 0;
            background: rgba(255,255,255,0.05);
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .player-name-modal {
            font-weight: 600;
            color: white;
        }

        .player-stats-modal {
            display: flex;
            gap: 10px;
            font-size: 0.9em;
            color: #cbd5e0;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #a0aec0;
        }

        .empty-state-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .empty-state-text {
            font-size: 1.3em;
            margin-bottom: 30px;
        }

        .filter-bar {
            background: rgba(45, 55, 72, 0.9);
            padding: 15px 20px;
            border-radius: 12px 12px 0 0;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.3);
        }

        .filter-label {
            font-weight: 600;
            color: #cbd5e0;
            font-size: 1em;
        }

        .team-filter-select {
            padding: 10px 15px;
            border: 2px solid #4a5568;
            border-radius: 8px;
            background: #1a202c;
            color: white;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 200px;
        }

        .team-filter-select:hover {
            border-color: #667eea;
        }

        .team-filter-select:focus {
            outline: none;
            border-color: #48bb78;
            box-shadow: 0 0 0 3px rgba(72, 187, 120, 0.2);
        }

        /* League Leaders Styles */
        .leaders-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .leader-category {
            background: rgba(45, 55, 72, 0.9);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.3);
        }

        .leader-category-title {
            font-size: 1.3em;
            font-weight: 700;
            color: #48bb78;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(72, 187, 120, 0.3);
            text-align: center;
        }

        .leader-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .leader-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            transition: all 0.2s;
        }

        .leader-item:hover {
            background: rgba(102, 126, 234, 0.2);
            transform: translateX(5px);
        }

        .leader-item.rank-1 {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2) 0%, rgba(255, 215, 0, 0.1) 100%);
            border-left: 4px solid #ffd700;
        }

        .leader-item.rank-2 {
            background: linear-gradient(135deg, rgba(192, 192, 192, 0.2) 0%, rgba(192, 192, 192, 0.1) 100%);
            border-left: 4px solid #c0c0c0;
        }

        .leader-item.rank-3 {
            background: linear-gradient(135deg, rgba(205, 127, 50, 0.2) 0%, rgba(205, 127, 50, 0.1) 100%);
            border-left: 4px solid #cd7f32;
        }

        .leader-rank {
            font-size: 1.2em;
            font-weight: 900;
            color: #48bb78;
            min-width: 30px;
            text-align: center;
        }

        .leader-item.rank-1 .leader-rank {
            color: #ffd700;
        }

        .leader-item.rank-2 .leader-rank {
            color: #c0c0c0;
        }

        .leader-item.rank-3 .leader-rank {
            color: #cd7f32;
        }

        .leader-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .leader-name {
            font-weight: 600;
            color: #e2e8f0;
            font-size: 0.95em;
        }

        .leader-team {
            font-size: 0.8em;
            color: #a0aec0;
        }

        .leader-stat {
            font-size: 1.3em;
            font-weight: 900;
            color: #48bb78;
            min-width: 50px;
            text-align: right;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .games-grid {
                grid-template-columns: 1fr;
            }

            .modal-teams {
                grid-template-columns: 1fr;
            }

            .tabs {
                flex-direction: column;
            }

            .tab-btn {
                width: 100%;
            }

            table {
                font-size: 0.9em;
            }

            th, td {
                padding: 10px 8px;
            }

            .filter-bar {
                flex-direction: column;
                align-items: flex-start;
                padding: 12px 15px;
            }

            .team-filter-select {
                width: 100%;
                min-width: unset;
            }

            .leaders-container {
                grid-template-columns: 1fr;
                padding: 10px;
            }

            .leader-category {
                padding: 15px;
            }

            .leader-category-title {
                font-size: 1.1em;
            }

            .leader-item {
                padding: 10px;
            }

            .leader-rank {
                font-size: 1em;
                min-width: 25px;
            }

            .leader-stat {
                font-size: 1.1em;
            }
        }

        /* Player Game Log Styles */
        .player-name-clickable {
            cursor: pointer;
            color: #667eea;
            font-weight: 600;
            transition: all 0.2s;
        }

        .player-name-clickable:hover {
            color: #5a67d8;
            text-decoration: underline;
        }

        .player-log-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .player-log-header h2 {
            font-size: 2em;
            color: #48bb78;
            margin-bottom: 5px;
        }

        .player-log-header .player-team {
            font-size: 1.2em;
            color: #a0aec0;
        }

        .player-stats-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(72, 187, 120, 0.1);
            border-radius: 12px;
        }

        .summary-stat {
            text-align: center;
        }

        .summary-stat-label {
            font-size: 0.9em;
            color: #a0aec0;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .summary-stat-value {
            font-size: 1.8em;
            color: #48bb78;
            font-weight: 900;
        }

        .game-log-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .game-log-table th {
            background: rgba(102, 126, 234, 0.2);
            padding: 12px 8px;
            text-align: center;
            font-weight: 700;
            color: #48bb78;
            border-bottom: 2px solid rgba(102, 126, 234, 0.5);
            font-size: 0.9em;
        }

        .game-log-table td {
            padding: 12px 8px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            color: #e2e8f0;
            text-align: center;
            font-size: 0.9em;
        }

        .game-log-table tr:hover td {
            background: rgba(102, 126, 234, 0.1);
        }

        .game-log-table .stat-highlight {
            font-weight: 700;
            color: #48bb78;
        }

        .game-log-table .career-high {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2) 0%, rgba(255, 215, 0, 0.1) 100%);
            font-weight: 900;
            color: #ffd700;
        }

        .game-result-win {
            color: #48bb78;
            font-weight: 600;
        }

        .game-result-loss {
            color: #fc8181;
            font-weight: 600;
        }

        .mvp-badge {
            display: inline-block;
            margin-left: 5px;
            color: #f39c12;
            font-size: 1.1em;
        }

        .no-games-message {
            text-align: center;
            padding: 40px;
            color: #a0aec0;
            font-size: 1.1em;
        }
    </style>
</head>
<body>
    <div class="container">
        <img src="bellaLogo.jpg" alt="Bella Vista Logo" class="header-logo-display">

        <div class="header">
            <h1>üìä Game History & Standings</h1>
            <div class="header-buttons">
                <a href="spectator.html" class="spectator-button">üì∫ View Live Game</a>
            </div>
        </div>

        <button class="admin-toggle" id="adminToggle" onclick="toggleAdminMode()">üîì Admin Mode</button>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('history')">üèÄ Game History</button>
            <button class="tab-btn" onclick="switchTab('teams')">üèÜ Team Standings</button>
            <button class="tab-btn" onclick="switchTab('players')">‚≠ê Player Stats</button>
            <button class="tab-btn" onclick="switchTab('leaders')">üëë League Leaders</button>
        </div>

        <!-- Game History Tab -->
        <div id="historyTab" class="tab-content active">
            <div id="gamesGrid" class="games-grid"></div>
            <div id="emptyHistory" class="empty-state" style="display: none;">
                <div class="empty-state-icon">üèÄ</div>
                <div class="empty-state-text">No games saved yet</div>
                <p style="color: #718096;">Finish and save a game from the tracker to see it here.</p>
            </div>
        </div>

        <!-- Team Standings Tab -->
        <div id="teamsTab" class="tab-content">
            <div class="table-container">
                <table id="teamsTable">
                    <thead>
                        <tr>
                            <th onclick="sortTeams('rank')">Rank</th>
                            <th onclick="sortTeams('team')">Team</th>
                            <th onclick="sortTeams('record')">Record</th>
                            <th onclick="sortTeams('winPct')">Win %</th>
                            <th onclick="sortTeams('pointsFor')">PF</th>
                            <th onclick="sortTeams('pointsAgainst')">PA</th>
                            <th onclick="sortTeams('pointDiff')">+/-</th>
                            <th onclick="sortTeams('lastPlayed')">Last Game</th>
                        </tr>
                    </thead>
                    <tbody id="teamsTableBody"></tbody>
                </table>
            </div>
            <div id="emptyTeams" class="empty-state" style="display: none;">
                <div class="empty-state-icon">üèÜ</div>
                <div class="empty-state-text">No team records yet</div>
                <p style="color: #718096;">Team standings will appear after saving your first game.</p>
            </div>
        </div>

        <!-- Player Stats Tab -->
        <div id="playersTab" class="tab-content">
            <div class="filter-bar">
                <label for="teamFilter" class="filter-label">Filter by Team:</label>
                <select id="teamFilter" class="team-filter-select" onchange="filterPlayersByTeam()">
                    <option value="">All Teams</option>
                </select>
            </div>
            <div class="table-container">
                <table id="playersTable">
                    <thead>
                        <tr>
                            <th onclick="sortPlayers('name')">Player</th>
                            <th onclick="sortPlayers('team')">Team</th>
                            <th onclick="sortPlayers('games')">GP</th>
                            <th onclick="sortPlayers('ppg')">PPG</th>
                            <th onclick="sortPlayers('rpg')">RPG</th>
                            <th onclick="sortPlayers('apg')">APG</th>
                            <th onclick="sortPlayers('spg')">SPG</th>
                            <th onclick="sortPlayers('bpg')">BPG</th>
                            <th onclick="sortPlayers('points')">Total PTS</th>
                        </tr>
                    </thead>
                    <tbody id="playersTableBody"></tbody>
                </table>
            </div>
            <div id="emptyPlayers" class="empty-state" style="display: none;">
                <div class="empty-state-icon">‚≠ê</div>
                <div class="empty-state-text">No player stats yet</div>
                <p style="color: #718096;">Player statistics will appear after saving your first game.</p>
            </div>
        </div>

        <!-- League Leaders Tab -->
        <div id="leadersTab" class="tab-content">
            <div class="leaders-container">
                <div class="leader-category">
                    <h3 class="leader-category-title">üëë Points</h3>
                    <div class="leader-list" id="pointsLeaders"></div>
                </div>

                <div class="leader-category">
                    <h3 class="leader-category-title">üèÄ Rebounds</h3>
                    <div class="leader-list" id="reboundsLeaders"></div>
                </div>

                <div class="leader-category">
                    <h3 class="leader-category-title">üéØ Assists</h3>
                    <div class="leader-list" id="assistsLeaders"></div>
                </div>

                <div class="leader-category">
                    <h3 class="leader-category-title">‚úã Steals</h3>
                    <div class="leader-list" id="stealsLeaders"></div>
                </div>

                <div class="leader-category">
                    <h3 class="leader-category-title">üö´ Blocks</h3>
                    <div class="leader-list" id="blocksLeaders"></div>
                </div>
            </div>
            <div id="emptyLeaders" class="empty-state" style="display: none;">
                <div class="empty-state-icon">üëë</div>
                <div class="empty-state-text">No league leaders yet</div>
                <p style="color: #718096;">League leaders will appear after saving your first game.</p>
            </div>
        </div>
    </div>

    <!-- Game Details Modal -->
    <div id="gameModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">&times;</button>
            <div id="modalBody"></div>
        </div>
    </div>

    <!-- Password Modal -->
    <div id="passwordModal" class="password-modal">
        <div class="password-modal-content">
            <h3>üîê Admin Authentication</h3>
            <div class="password-input-group">
                <label for="adminPasswordInput">Enter Admin Password:</label>
                <input type="password" id="adminPasswordInput" placeholder="Password" autocomplete="off">
                <div class="password-error" id="passwordError">Incorrect password!</div>
            </div>
            <div class="password-modal-buttons">
                <button class="password-modal-btn cancel" onclick="closePasswordModal()">Cancel</button>
                <button class="password-modal-btn submit" onclick="submitPassword()">Submit</button>
            </div>
        </div>
    </div>

    <!-- Player Game Log Modal -->
    <div id="playerGameLogModal" class="modal">
        <div class="modal-content" style="max-width: 1100px;">
            <button class="modal-close" onclick="closePlayerGameLog()">&times;</button>
            <div id="playerGameLogBody"></div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
        // Team Logos Mapping
        const TEAM_LOGOS = {
            'Orange Inferno': 'logos/Orange Inferno.jpg',
            'Gray Wolves': 'logos/Gray Wolves.jpeg',
            'Green Bulls': 'logos/Green Bulls.jpg',
            'Bella Vista Blue': 'logos/Bella Vista Blue.png',
            'Black Hoopers': 'logos/Black Hoopers.jpg',
            'Yellow Slashers': 'logos/Yellow Slashers.png',
            'Red Blood Cells': 'logos/Red Blood Cells.jpg',
            'Porpol Ravens': 'logos/Porpol Ravens.jpeg'
        };

        let currentTab = 'history';
        let gameHistory = [];
        let seasonStandings = { teams: {}, players: {} };
        let currentSort = { column: null, order: 'asc' };
        let isAdminMode = false;
        let firebaseInitialized = false;
        let database = null;

        // Admin Mode Functions
        function toggleAdminMode() {
            if (isAdminMode) {
                // Exit admin mode
                isAdminMode = false;
                sessionStorage.removeItem('adminMode');
                document.body.classList.remove('admin-mode');
                document.getElementById('adminToggle').textContent = 'üîì Admin Mode';
                document.getElementById('adminToggle').classList.remove('active');
            } else {
                // Enter admin mode - show password modal
                showPasswordModal();
            }
        }

        function showPasswordModal() {
            const modal = document.getElementById('passwordModal');
            const input = document.getElementById('adminPasswordInput');
            const error = document.getElementById('passwordError');

            // Reset modal state
            input.value = '';
            error.classList.remove('show');

            // Show modal and focus input
            modal.classList.add('active');
            setTimeout(() => input.focus(), 100);
        }

        function closePasswordModal() {
            const modal = document.getElementById('passwordModal');
            const input = document.getElementById('adminPasswordInput');
            const error = document.getElementById('passwordError');

            input.value = '';
            error.classList.remove('show');
            modal.classList.remove('active');
        }

        function submitPassword() {
            const input = document.getElementById('adminPasswordInput');
            const error = document.getElementById('passwordError');
            const password = input.value;

            if (password === 'Hoopers') {
                // Correct password - enable admin mode
                isAdminMode = true;
                sessionStorage.setItem('adminMode', 'true');
                document.body.classList.add('admin-mode');
                document.getElementById('adminToggle').textContent = 'üîí Exit Admin';
                document.getElementById('adminToggle').classList.add('active');
                closePasswordModal();
            } else {
                // Incorrect password - show error
                error.classList.add('show');
                input.value = '';
                input.focus();
            }
        }

        // Handle Enter key in password input
        document.addEventListener('DOMContentLoaded', function() {
            const passwordInput = document.getElementById('adminPasswordInput');
            if (passwordInput) {
                passwordInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        submitPassword();
                    }
                });
            }
        });

        // Close modal when clicking outside
        document.addEventListener('click', function(e) {
            const modal = document.getElementById('passwordModal');
            if (e.target === modal) {
                closePasswordModal();
            }
        });

        // Load data on page load
        window.addEventListener('DOMContentLoaded', function() {
            // Check if admin mode was previously enabled
            if (sessionStorage.getItem('adminMode') === 'true') {
                isAdminMode = true;
                document.body.classList.add('admin-mode');
                document.getElementById('adminToggle').textContent = 'üîí Exit Admin';
                document.getElementById('adminToggle').classList.add('active');
            }

            // Initialize Firebase and load data
            initializeFirebase();
            loadData(); // This will call renderCurrentTab() when data is ready

            // Auto-refresh every 2 seconds to pick up new games from Firebase
            setInterval(function() {
                loadData();
            }, 2000);
        });

        // Also refresh when tab becomes visible
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                loadData(); // This will call renderCurrentTab() when data is ready
            }
        });

        // Initialize Firebase
        function initializeFirebase() {
            try {
                if (!firebaseInitialized) {
                    const firebaseConfig = {
                        apiKey: "AIzaSyCRjX0GdMHSNeykGuxclCgSc3XpY04-oEE",
                        authDomain: "bella-vista-league-live-score.firebaseapp.com",
                        databaseURL: "https://bella-vista-league-live-score-default-rtdb.asia-southeast1.firebasedatabase.app",
                        projectId: "bella-vista-league-live-score",
                        storageBucket: "bella-vista-league-live-score.firebasestorage.app",
                        messagingSenderId: "563016772281",
                        appId: "1:563016772281:web:e2c3b5d3a08c2bc9308968"
                    };
                    firebase.initializeApp(firebaseConfig);
                    database = firebase.database();
                    firebaseInitialized = true;
                    console.log('Firebase initialized for history sync');
                }
            } catch (error) {
                console.error('Firebase initialization failed:', error);
                // Continue without Firebase, use localStorage only
            }
        }

        function loadData() {
            if (database) {
                // Load from Firebase (synced across all devices)
                loadFromFirebase();
            } else {
                // Fallback to localStorage only
                loadFromLocalStorage();
                renderCurrentTab();
            }
        }

        function loadFromFirebase() {
            // Load both game history and season standings, then render
            Promise.all([
                // Load game history from Firebase
                database.ref('gameHistory').once('value').then((snapshot) => {
                    const firebaseHistory = snapshot.val();
                    if (firebaseHistory && Array.isArray(firebaseHistory)) {
                        gameHistory = firebaseHistory;
                        // Also save to localStorage as cache
                        localStorage.setItem('basketballGameHistory', JSON.stringify(gameHistory));
                    } else {
                        // If Firebase is empty, try localStorage
                        const saved = localStorage.getItem('basketballGameHistory');
                        if (saved) {
                            gameHistory = JSON.parse(saved);
                        }
                    }
                }).catch((error) => {
                    console.error('Error loading history from Firebase:', error);
                    const saved = localStorage.getItem('basketballGameHistory');
                    if (saved) {
                        gameHistory = JSON.parse(saved);
                    }
                }),

                // Load season standings from Firebase
                database.ref('seasonStandings').once('value').then((snapshot) => {
                    const firebaseStandings = snapshot.val();
                    if (firebaseStandings) {
                        seasonStandings = firebaseStandings;
                        // Also save to localStorage as cache
                        localStorage.setItem('basketballSeasonStandings', JSON.stringify(seasonStandings));
                    } else {
                        // If Firebase is empty, try localStorage
                        const saved = localStorage.getItem('basketballSeasonStandings');
                        if (saved) {
                            seasonStandings = JSON.parse(saved);
                        }
                    }
                }).catch((error) => {
                    console.error('Error loading standings from Firebase:', error);
                    const saved = localStorage.getItem('basketballSeasonStandings');
                    if (saved) {
                        seasonStandings = JSON.parse(saved);
                    }
                })
            ]).then(() => {
                // Both data loaded - now render
                renderCurrentTab();
            });
        }

        function loadFromLocalStorage() {
            try {
                gameHistory = JSON.parse(localStorage.getItem('basketballGameHistory') || '[]');
                seasonStandings = JSON.parse(localStorage.getItem('basketballSeasonStandings') ||
                    '{"teams": {}, "players": {}}');
            } catch (e) {
                console.error('Error loading data:', e);
                gameHistory = [];
                seasonStandings = { teams: {}, players: {} };
            }
        }

        function switchTab(tab) {
            currentTab = tab;

            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            if (tab === 'history') {
                document.getElementById('historyTab').classList.add('active');
            } else if (tab === 'teams') {
                document.getElementById('teamsTab').classList.add('active');
            } else if (tab === 'players') {
                document.getElementById('playersTab').classList.add('active');
            } else if (tab === 'leaders') {
                document.getElementById('leadersTab').classList.add('active');
            }

            renderCurrentTab();
        }

        function renderCurrentTab() {
            if (currentTab === 'history') {
                renderGameHistory();
            } else if (currentTab === 'teams') {
                renderTeamStandings();
            } else if (currentTab === 'players') {
                populateTeamFilter();
                renderPlayerStats();
            } else if (currentTab === 'leaders') {
                renderLeagueLeaders();
            }
        }

        function renderGameHistory() {
            const grid = document.getElementById('gamesGrid');
            const empty = document.getElementById('emptyHistory');

            if (gameHistory.length === 0) {
                grid.innerHTML = '';
                empty.style.display = 'block';
                return;
            }

            empty.style.display = 'none';
            grid.innerHTML = '';

            gameHistory.forEach((game, index) => {
                const card = document.createElement('div');
                card.className = 'game-card';

                const winnerBadgeClass = game.winner === 'TIE' ? 'winner-badge tie' : 'winner-badge';
                const winnerText = game.winner === 'TIE' ? 'TIE GAME' : `üèÜ ${game.winner}`;

                // Check if can move up or down
                const canMoveUp = index > 0;
                const canMoveDown = index < gameHistory.length - 1;

                card.innerHTML = `
                    <div class="game-card-header">
                        <div class="game-date" onclick="editGameDate(${game.id})" style="cursor: pointer; text-decoration: underline;" title="Click to edit date">
                            üìÖ ${game.gameDate}
                        </div>
                        <div class="${winnerBadgeClass}">${winnerText}</div>
                    </div>
                    <div class="game-matchup">
                        <div class="team-logos-row">
                            ${game.team1.logo ? `<img src="${game.team1.logo}" class="team-logo-small" alt="${game.team1.name}">` : ''}
                            <div class="vs-small">VS</div>
                            ${game.team2.logo ? `<img src="${game.team2.logo}" class="team-logo-small" alt="${game.team2.name}">` : ''}
                        </div>
                        <div class="game-score">${game.finalScore.team1} - ${game.finalScore.team2}</div>
                        <div class="game-name">${game.gameName}</div>
                    </div>
                    <div class="game-actions">
                        <button class="game-btn reorder-btn" onclick="moveGameUp(${game.id})" ${!canMoveUp ? 'disabled' : ''} title="Move game up in list">‚¨ÜÔ∏è Up</button>
                        <button class="game-btn reorder-btn" onclick="moveGameDown(${game.id})" ${!canMoveDown ? 'disabled' : ''} title="Move game down in list">‚¨áÔ∏è Down</button>
                        <button class="game-btn view-btn" onclick="viewGameDetails(${game.id})">üëÅÔ∏è View Details</button>
                        <button class="game-btn delete-btn" onclick="deleteGame(${game.id})">üóëÔ∏è Delete</button>
                    </div>
                `;

                grid.appendChild(card);
            });
        }

        function renderTeamStandings() {
            const tbody = document.getElementById('teamsTableBody');
            const empty = document.getElementById('emptyTeams');
            const teams = Object.keys(seasonStandings.teams);

            if (teams.length === 0) {
                tbody.innerHTML = '';
                empty.style.display = 'block';
                return;
            }

            empty.style.display = 'none';

            // Convert to array and sort by wins
            const teamsArray = teams.map(name => ({
                name: name,
                ...seasonStandings.teams[name],
                winPct: calculateWinPercentage(seasonStandings.teams[name]),
                pointDiff: seasonStandings.teams[name].pointsFor - seasonStandings.teams[name].pointsAgainst
            }));

            teamsArray.sort((a, b) => b.wins - a.wins || b.pointDiff - a.pointDiff);

            tbody.innerHTML = '';
            teamsArray.forEach((team, index) => {
                const row = document.createElement('tr');
                const teamLogo = TEAM_LOGOS[team.name] || '';
                const logoHTML = teamLogo ? `<img src="${teamLogo}" class="team-logo-table" alt="${team.name}">` : '';

                row.innerHTML = `
                    <td class="rank-cell">#${index + 1}</td>
                    <td>
                        <div class="team-cell">
                            ${logoHTML}
                            <div>${team.name}</div>
                        </div>
                    </td>
                    <td class="stat-highlight">${team.wins}-${team.losses}</td>
                    <td>${team.winPct}</td>
                    <td>${team.pointsFor}</td>
                    <td>${team.pointsAgainst}</td>
                    <td class="stat-highlight">${team.pointDiff > 0 ? '+' : ''}${team.pointDiff}</td>
                    <td>${team.lastPlayed || '-'}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function renderPlayerStats() {
            const tbody = document.getElementById('playersTableBody');
            const empty = document.getElementById('emptyPlayers');
            const teamFilter = document.getElementById('teamFilter').value;
            const allPlayers = Object.values(seasonStandings.players);

            let players;

            if (teamFilter) {
                // Specific team selected - show ALL players from that team (even with zero stats)
                players = allPlayers.filter(player => player.teamName === teamFilter);
            } else {
                // "All Teams" selected - filter out players with no stats
                players = allPlayers.filter(player =>
                    player.totalPoints > 0 ||
                    player.totalRebounds > 0 ||
                    player.totalAssists > 0 ||
                    player.totalSteals > 0 ||
                    player.totalBlocks > 0
                );
            }

            if (players.length === 0) {
                tbody.innerHTML = '';
                empty.style.display = 'block';
                return;
            }

            empty.style.display = 'none';

            // Sort by PPG by default
            players.sort((a, b) => b.avgPoints - a.avgPoints);

            tbody.innerHTML = '';
            players.forEach(player => {
                const row = document.createElement('tr');
                const teamLogo = TEAM_LOGOS[player.teamName] || '';
                const logoHTML = teamLogo ? `<img src="${teamLogo}" class="team-logo-table" alt="${player.teamName}">` : '';

                row.innerHTML = `
                    <td>
                        <div class="team-cell">
                            ${logoHTML}
                            <span class="player-name-clickable" onclick="openPlayerGameLog('${player.playerName}', '${player.teamName}')">${player.playerName}</span>
                        </div>
                    </td>
                    <td>${player.teamName}</td>
                    <td>${player.gamesPlayed}</td>
                    <td class="stat-highlight">${player.avgPoints}</td>
                    <td>${player.avgRebounds}</td>
                    <td>${player.avgAssists}</td>
                    <td>${(player.totalSteals / player.gamesPlayed).toFixed(1)}</td>
                    <td>${(player.totalBlocks / player.gamesPlayed).toFixed(1)}</td>
                    <td>${player.totalPoints}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function populateTeamFilter() {
            const teamFilter = document.getElementById('teamFilter');
            const teams = Object.keys(seasonStandings.teams).sort();

            // Preserve the currently selected value
            const currentSelection = teamFilter.value;

            // Clear existing options except "All Teams"
            teamFilter.innerHTML = '<option value="">All Teams</option>';

            // Add team options
            teams.forEach(teamName => {
                const option = document.createElement('option');
                option.value = teamName;
                option.textContent = teamName;
                teamFilter.appendChild(option);
            });

            // Restore the previously selected value if it still exists
            if (currentSelection && teams.includes(currentSelection)) {
                teamFilter.value = currentSelection;
            }
        }

        function filterPlayersByTeam() {
            renderPlayerStats();
        }

        function renderLeagueLeaders() {
            const allPlayers = Object.values(seasonStandings.players);
            const empty = document.getElementById('emptyLeaders');

            // Filter out players with no stats
            const activePlayers = allPlayers.filter(player =>
                player.totalPoints > 0 ||
                player.totalRebounds > 0 ||
                player.totalAssists > 0 ||
                player.totalSteals > 0 ||
                player.totalBlocks > 0
            );

            if (activePlayers.length === 0) {
                empty.style.display = 'block';
                document.querySelector('.leaders-container').style.display = 'none';
                return;
            }

            empty.style.display = 'none';
            document.querySelector('.leaders-container').style.display = 'grid';

            // Points Leaders
            renderLeaderCategory(activePlayers, 'points', 'avgPoints', 'pointsLeaders', 'PPG');

            // Rebounds Leaders
            renderLeaderCategory(activePlayers, 'rebounds', 'avgRebounds', 'reboundsLeaders', 'RPG');

            // Assists Leaders
            renderLeaderCategory(activePlayers, 'assists', 'avgAssists', 'assistsLeaders', 'APG');

            // Steals Leaders
            renderLeaderCategory(activePlayers, 'steals', 'totalSteals', 'stealsLeaders', 'SPG', true);

            // Blocks Leaders
            renderLeaderCategory(activePlayers, 'blocks', 'totalBlocks', 'blocksLeaders', 'BPG', true);
        }

        function renderLeaderCategory(players, statName, sortKey, elementId, label, useAverage = false) {
            const container = document.getElementById(elementId);

            // Sort players by the stat and take top 10
            const topPlayers = [...players]
                .filter(p => p[sortKey] > 0)
                .sort((a, b) => b[sortKey] - a[sortKey])
                .slice(0, 10);

            if (topPlayers.length === 0) {
                container.innerHTML = '<div style="color: #718096; text-align: center; padding: 20px;">No data yet</div>';
                return;
            }

            container.innerHTML = '';

            topPlayers.forEach((player, index) => {
                const rank = index + 1;
                const rankClass = rank <= 3 ? `rank-${rank}` : '';
                const teamLogo = TEAM_LOGOS[player.teamName] || '';
                const logoHTML = teamLogo ? `<img src="${teamLogo}" class="team-logo-table" alt="${player.teamName}">` : '';

                // Calculate stat value
                let statValue;
                if (useAverage) {
                    statValue = (player[sortKey] / player.gamesPlayed).toFixed(1);
                } else {
                    statValue = player[sortKey].toFixed(1);
                }

                const item = document.createElement('div');
                item.className = `leader-item ${rankClass}`;
                item.innerHTML = `
                    <div class="leader-rank">${rank}</div>
                    ${logoHTML}
                    <div class="leader-info">
                        <div class="leader-name"><span class="player-name-clickable" onclick="openPlayerGameLog('${player.playerName}', '${player.teamName}')">${player.playerName}</span></div>
                        <div class="leader-team">${player.teamName}</div>
                    </div>
                    <div class="leader-stat">${statValue}</div>
                `;
                container.appendChild(item);
            });
        }

        function calculateWinPercentage(team) {
            const total = team.wins + team.losses;
            if (total === 0) return '0.000';
            return ((team.wins / total) * 100).toFixed(1) + '%';
        }

        function viewGameDetails(gameId) {
            const game = gameHistory.find(g => g.id === gameId);
            if (!game) return;

            const modalBody = document.getElementById('modalBody');

            let modalHTML = `
                <div class="modal-header">
                    <h2>${game.gameName}</h2>
                    <div style="color: #cbd5e0; font-size: 1.1em;">${game.gameDate}</div>
                    <div style="font-size: 3em; font-weight: 900; color: #48bb78; margin: 20px 0;">
                        ${game.finalScore.team1} - ${game.finalScore.team2}
                    </div>
                    ${game.winner !== 'TIE' ? `<div style="font-size: 1.3em; color: #48bb78;">üèÜ Winner: ${game.winner}</div>` : '<div style="font-size: 1.3em; color: #718096;">TIE GAME</div>'}
                    ${game.mvp ? `<div style="margin-top: 15px; font-size: 1.1em; color: #f39c12;">
                        ‚≠ê MVP: ${game.mvp.name}
                        <button class="edit-mvp-btn" onclick="editGameMVP(${game.id})" style="margin-left: 10px; padding: 5px 12px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9em; font-weight: 600;">‚úèÔ∏è Edit MVP</button>
                    </div>` : `<div style="margin-top: 15px; font-size: 1.1em; color: #a0aec0;">
                        No MVP selected
                        <button class="edit-mvp-btn" onclick="editGameMVP(${game.id})" style="margin-left: 10px; padding: 5px 12px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9em; font-weight: 600;">‚úèÔ∏è Select MVP</button>
                    </div>`}
                </div>
                <div class="modal-teams">
            `;

            // Team 1 Players
            modalHTML += `
                <div class="modal-team">
                    <h3>${game.team1.name}</h3>
            `;

            game.team1.players.forEach(player => {
                let totalPoints = 0, totalRebounds = 0, totalAssists = 0, totalSteals = 0, totalBlocks = 0;
                Object.values(player.quarterStats).forEach(qStats => {
                    totalPoints += qStats.points || 0;
                    totalRebounds += qStats.rebounds || 0;
                    totalAssists += qStats.assists || 0;
                    totalSteals += qStats.steals || 0;
                    totalBlocks += qStats.blocks || 0;
                });

                if (totalPoints > 0 || totalRebounds > 0 || totalAssists > 0 || totalSteals > 0 || totalBlocks > 0) {
                    let statsHTML = '';
                    if (totalPoints > 0) statsHTML += `<span><strong>${totalPoints}</strong> PTS</span>`;
                    if (totalRebounds > 0) statsHTML += `<span><strong>${totalRebounds}</strong> REB</span>`;
                    if (totalAssists > 0) statsHTML += `<span><strong>${totalAssists}</strong> AST</span>`;
                    if (totalSteals > 0) statsHTML += `<span><strong>${totalSteals}</strong> STL</span>`;
                    if (totalBlocks > 0) statsHTML += `<span><strong>${totalBlocks}</strong> BLK</span>`;

                    modalHTML += `
                        <div class="modal-player">
                            <div class="player-name-modal">${player.name}</div>
                            <div class="player-stats-modal">
                                ${statsHTML}
                            </div>
                        </div>
                    `;
                }
            });

            modalHTML += `</div>`;

            // Team 2 Players
            modalHTML += `
                <div class="modal-team">
                    <h3>${game.team2.name}</h3>
            `;

            game.team2.players.forEach(player => {
                let totalPoints = 0, totalRebounds = 0, totalAssists = 0, totalSteals = 0, totalBlocks = 0;
                Object.values(player.quarterStats).forEach(qStats => {
                    totalPoints += qStats.points || 0;
                    totalRebounds += qStats.rebounds || 0;
                    totalAssists += qStats.assists || 0;
                    totalSteals += qStats.steals || 0;
                    totalBlocks += qStats.blocks || 0;
                });

                if (totalPoints > 0 || totalRebounds > 0 || totalAssists > 0 || totalSteals > 0 || totalBlocks > 0) {
                    let statsHTML = '';
                    if (totalPoints > 0) statsHTML += `<span><strong>${totalPoints}</strong> PTS</span>`;
                    if (totalRebounds > 0) statsHTML += `<span><strong>${totalRebounds}</strong> REB</span>`;
                    if (totalAssists > 0) statsHTML += `<span><strong>${totalAssists}</strong> AST</span>`;
                    if (totalSteals > 0) statsHTML += `<span><strong>${totalSteals}</strong> STL</span>`;
                    if (totalBlocks > 0) statsHTML += `<span><strong>${totalBlocks}</strong> BLK</span>`;

                    modalHTML += `
                        <div class="modal-player">
                            <div class="player-name-modal">${player.name}</div>
                            <div class="player-stats-modal">
                                ${statsHTML}
                            </div>
                        </div>
                    `;
                }
            });

            modalHTML += `</div></div>`;

            modalBody.innerHTML = modalHTML;
            document.getElementById('gameModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('gameModal').classList.remove('active');
        }

        function deleteGame(gameId) {
            if (!confirm('Delete this game from history? This will also recalculate season standings.')) {
                return;
            }

            // Remove game from history
            gameHistory = gameHistory.filter(g => g.id !== gameId);
            localStorage.setItem('basketballGameHistory', JSON.stringify(gameHistory));

            // Recalculate standings from scratch
            recalculateStandings();

            // Sync to Firebase
            if (database) {
                database.ref('gameHistory').set(gameHistory);
                console.log('‚úÖ Deleted game synced to Firebase');
            }

            // Re-render
            renderCurrentTab();
            alert('Game deleted successfully!');
        }

        function moveGameUp(gameId) {
            // Find the index of the game
            const index = gameHistory.findIndex(g => g.id === gameId);

            if (index <= 0) {
                return; // Already at top or not found
            }

            // Swap with the previous game
            [gameHistory[index - 1], gameHistory[index]] = [gameHistory[index], gameHistory[index - 1]];

            // Save to localStorage
            localStorage.setItem('basketballGameHistory', JSON.stringify(gameHistory));

            // Sync to Firebase
            if (database) {
                database.ref('gameHistory').set(gameHistory);
                console.log('‚úÖ Game order synced to Firebase');
            }

            // Re-render
            renderCurrentTab();
        }

        function moveGameDown(gameId) {
            // Find the index of the game
            const index = gameHistory.findIndex(g => g.id === gameId);

            if (index === -1 || index >= gameHistory.length - 1) {
                return; // Already at bottom or not found
            }

            // Swap with the next game
            [gameHistory[index], gameHistory[index + 1]] = [gameHistory[index + 1], gameHistory[index]];

            // Save to localStorage
            localStorage.setItem('basketballGameHistory', JSON.stringify(gameHistory));

            // Sync to Firebase
            if (database) {
                database.ref('gameHistory').set(gameHistory);
                console.log('‚úÖ Game order synced to Firebase');
            }

            // Re-render
            renderCurrentTab();
        }

        function editGameDate(gameId) {
            // Find the game
            const game = gameHistory.find(g => g.id === gameId);
            if (!game) {
                return;
            }

            // Prompt for new date
            const currentDate = game.gameDate;
            const newDate = prompt('Edit game date (YYYY-MM-DD format):', currentDate);

            // Validate and update
            if (newDate === null || newDate.trim() === '') {
                return; // User cancelled or empty
            }

            // Basic date validation
            const datePattern = /^\d{4}-\d{2}-\d{2}$/;
            if (!datePattern.test(newDate)) {
                alert('Invalid date format. Please use YYYY-MM-DD format (e.g., 2026-02-20)');
                return;
            }

            // Update the date
            game.gameDate = newDate;

            // Update lastPlayed for both teams in standings
            if (seasonStandings.teams[game.team1.name]) {
                seasonStandings.teams[game.team1.name].lastPlayed = newDate;
            }
            if (seasonStandings.teams[game.team2.name]) {
                seasonStandings.teams[game.team2.name].lastPlayed = newDate;
            }

            // Save to localStorage
            localStorage.setItem('basketballGameHistory', JSON.stringify(gameHistory));
            localStorage.setItem('basketballSeasonStandings', JSON.stringify(seasonStandings));

            // Sync to Firebase
            if (database) {
                database.ref('gameHistory').set(gameHistory);
                database.ref('seasonStandings').set(seasonStandings);
                console.log('‚úÖ Game date updated and synced to Firebase');
            }

            // Re-render
            renderCurrentTab();
            alert('Game date updated successfully!');
        }

        function editGameMVP(gameId) {
            // Find the game
            const game = gameHistory.find(g => g.id === gameId);
            if (!game) {
                return;
            }

            // Build player list from both teams
            const playerOptions = [];

            // Add Team 1 players
            game.team1.players.forEach(player => {
                playerOptions.push({
                    name: player.name,
                    team: game.team1.name,
                    teamKey: 'team1',
                    playerId: player.id
                });
            });

            // Add Team 2 players
            game.team2.players.forEach(player => {
                playerOptions.push({
                    name: player.name,
                    team: game.team2.name,
                    teamKey: 'team2',
                    playerId: player.id
                });
            });

            // Build prompt message with numbered list
            let promptMessage = 'Select the Best Player of the Game:\n\n';
            playerOptions.forEach((player, index) => {
                promptMessage += `${index + 1}. ${player.name} (${player.team})\n`;
            });
            promptMessage += '\nEnter the number (or 0 to remove MVP):';

            // Show prompt
            const selection = prompt(promptMessage, game.mvp ? '' : '');

            // Validate and update
            if (selection === null || selection.trim() === '') {
                return; // User cancelled
            }

            const selectedIndex = parseInt(selection) - 1;

            // Handle "0" to remove MVP
            if (selection === '0') {
                game.mvp = null;
                alert('MVP removed from game.');
            }
            // Validate selection is within range
            else if (selectedIndex >= 0 && selectedIndex < playerOptions.length) {
                const selectedPlayer = playerOptions[selectedIndex];
                game.mvp = {
                    name: selectedPlayer.name,
                    team: selectedPlayer.team,
                    teamKey: selectedPlayer.teamKey,
                    playerId: selectedPlayer.playerId
                };
                alert(`MVP updated to: ${selectedPlayer.name} (${selectedPlayer.team})`);
            } else {
                alert('Invalid selection. Please enter a valid number.');
                return;
            }

            // Save to localStorage
            localStorage.setItem('basketballGameHistory', JSON.stringify(gameHistory));

            // Sync to Firebase
            if (database) {
                database.ref('gameHistory').set(gameHistory);
                console.log('‚úÖ Game MVP updated and synced to Firebase');
            }

            // Close and re-open modal to refresh display
            closeModal();
            setTimeout(() => viewGameDetails(gameId), 100);
        }

        function recalculateStandings() {
            // Reset standings
            seasonStandings = { teams: {}, players: {} };

            // Recalculate from all games
            gameHistory.forEach(game => {
                updateSeasonStandingsFromGame(game);
            });

            localStorage.setItem('basketballSeasonStandings', JSON.stringify(seasonStandings));

            // Sync to Firebase
            if (database) {
                database.ref('seasonStandings').set(seasonStandings);
                console.log('‚úÖ Recalculated standings synced to Firebase');
            }
        }

        function updateSeasonStandingsFromGame(gameRecord) {
            const team1Name = gameRecord.team1.name;
            const team2Name = gameRecord.team2.name;

            // Initialize teams if needed
            if (!seasonStandings.teams[team1Name]) {
                seasonStandings.teams[team1Name] = { wins: 0, losses: 0, pointsFor: 0, pointsAgainst: 0 };
            }
            if (!seasonStandings.teams[team2Name]) {
                seasonStandings.teams[team2Name] = { wins: 0, losses: 0, pointsFor: 0, pointsAgainst: 0 };
            }

            // Update win/loss
            if (gameRecord.winner === team1Name) {
                seasonStandings.teams[team1Name].wins++;
                seasonStandings.teams[team2Name].losses++;
            } else if (gameRecord.winner === team2Name) {
                seasonStandings.teams[team2Name].wins++;
                seasonStandings.teams[team1Name].losses++;
            }

            // Update points
            seasonStandings.teams[team1Name].pointsFor += gameRecord.finalScore.team1;
            seasonStandings.teams[team1Name].pointsAgainst += gameRecord.finalScore.team2;
            seasonStandings.teams[team2Name].pointsFor += gameRecord.finalScore.team2;
            seasonStandings.teams[team2Name].pointsAgainst += gameRecord.finalScore.team1;
            seasonStandings.teams[team1Name].lastPlayed = gameRecord.gameDate;
            seasonStandings.teams[team2Name].lastPlayed = gameRecord.gameDate;

            // Update player stats
            updatePlayerStatsFromGame(gameRecord.team1, team1Name);
            updatePlayerStatsFromGame(gameRecord.team2, team2Name);
        }

        function updatePlayerStatsFromGame(teamData, teamName) {
            teamData.players.forEach(player => {
                // Sanitize key for Firebase - replace invalid characters
                const key = `${teamName}_${player.name}`.replace(/[.#$\/\[\]]/g, '-');

                // Calculate totals for this game
                let totalPoints = 0, totalRebounds = 0, totalAssists = 0, totalSteals = 0, totalBlocks = 0, totalFouls = 0;
                Object.values(player.quarterStats).forEach(qStats => {
                    totalPoints += qStats.points || 0;
                    totalRebounds += qStats.rebounds || 0;
                    totalAssists += qStats.assists || 0;
                    totalSteals += qStats.steals || 0;
                    totalBlocks += qStats.blocks || 0;
                    totalFouls += qStats.fouls || 0;
                });

                if (!seasonStandings.players[key]) {
                    seasonStandings.players[key] = {
                        teamName: teamName,
                        playerName: player.name,
                        gamesPlayed: 0,
                        totalPoints: 0,
                        totalRebounds: 0,
                        totalAssists: 0,
                        totalSteals: 0,
                        totalBlocks: 0,
                        totalFouls: 0
                    };
                }

                const p = seasonStandings.players[key];
                p.gamesPlayed++;
                p.totalPoints += totalPoints;
                p.totalRebounds += totalRebounds;
                p.totalAssists += totalAssists;
                p.totalSteals += totalSteals;
                p.totalBlocks += totalBlocks;
                p.totalFouls += totalFouls;
                p.avgPoints = parseFloat((p.totalPoints / p.gamesPlayed).toFixed(1));
                p.avgRebounds = parseFloat((p.totalRebounds / p.gamesPlayed).toFixed(1));
                p.avgAssists = parseFloat((p.totalAssists / p.gamesPlayed).toFixed(1));
            });
        }

        function sortTeams(column) {
            // Sorting logic can be added here if needed
        }

        function sortPlayers(column) {
            // Sorting logic can be added here if needed
        }

        // Player Game Log Functions
        function openPlayerGameLog(playerName, teamName) {
            // Find all games where this player participated
            const playerGames = [];

            gameHistory.forEach(game => {
                let playerStats = null;
                let isTeam1 = false;

                // Check if player is in team1
                const team1Player = game.team1.players.find(p => p.name === playerName);
                if (team1Player && game.team1.name === teamName) {
                    playerStats = team1Player;
                    isTeam1 = true;
                }

                // Check if player is in team2
                const team2Player = game.team2.players.find(p => p.name === playerName);
                if (team2Player && game.team2.name === teamName) {
                    playerStats = team2Player;
                    isTeam1 = false;
                }

                if (playerStats) {
                    // Calculate totals for this game
                    let totalPoints = 0, totalRebounds = 0, totalAssists = 0, totalSteals = 0, totalBlocks = 0, totalFouls = 0;
                    Object.values(playerStats.quarterStats).forEach(qStats => {
                        totalPoints += qStats.points || 0;
                        totalRebounds += qStats.rebounds || 0;
                        totalAssists += qStats.assists || 0;
                        totalSteals += qStats.steals || 0;
                        totalBlocks += qStats.blocks || 0;
                        totalFouls += qStats.fouls || 0;
                    });

                    // Determine opponent and result
                    const opponent = isTeam1 ? game.team2.name : game.team1.name;
                    const playerTeamScore = isTeam1 ? game.finalScore.team1 : game.finalScore.team2;
                    const opponentScore = isTeam1 ? game.finalScore.team2 : game.finalScore.team1;
                    const result = playerTeamScore > opponentScore ? 'W' : (playerTeamScore < opponentScore ? 'L' : 'T');

                    // Check if player was MVP
                    const wasMVP = game.mvp && game.mvp.name === playerName;

                    playerGames.push({
                        date: game.gameDate,
                        opponent: opponent,
                        result: result,
                        score: `${playerTeamScore}-${opponentScore}`,
                        points: totalPoints,
                        rebounds: totalRebounds,
                        assists: totalAssists,
                        steals: totalSteals,
                        blocks: totalBlocks,
                        fouls: totalFouls,
                        wasMVP: wasMVP
                    });
                }
            });

            if (playerGames.length === 0) {
                alert('No game history found for this player.');
                return;
            }

            // Sort by date (most recent first)
            playerGames.sort((a, b) => new Date(b.date) - new Date(a.date));

            // Calculate career highs
            const careerHighs = {
                points: Math.max(...playerGames.map(g => g.points)),
                rebounds: Math.max(...playerGames.map(g => g.rebounds)),
                assists: Math.max(...playerGames.map(g => g.assists)),
                steals: Math.max(...playerGames.map(g => g.steals)),
                blocks: Math.max(...playerGames.map(g => g.blocks))
            };

            // Calculate season averages
            const seasonAvgs = {
                games: playerGames.length,
                ppg: (playerGames.reduce((sum, g) => sum + g.points, 0) / playerGames.length).toFixed(1),
                rpg: (playerGames.reduce((sum, g) => sum + g.rebounds, 0) / playerGames.length).toFixed(1),
                apg: (playerGames.reduce((sum, g) => sum + g.assists, 0) / playerGames.length).toFixed(1),
                spg: (playerGames.reduce((sum, g) => sum + g.steals, 0) / playerGames.length).toFixed(1),
                bpg: (playerGames.reduce((sum, g) => sum + g.blocks, 0) / playerGames.length).toFixed(1)
            };

            // Calculate recent form (last 5 games)
            const recentGames = playerGames.slice(0, Math.min(5, playerGames.length));
            const recentAvgs = {
                ppg: (recentGames.reduce((sum, g) => sum + g.points, 0) / recentGames.length).toFixed(1),
                rpg: (recentGames.reduce((sum, g) => sum + g.rebounds, 0) / recentGames.length).toFixed(1),
                apg: (recentGames.reduce((sum, g) => sum + g.assists, 0) / recentGames.length).toFixed(1)
            };

            // Render modal
            renderPlayerGameLog(playerName, teamName, playerGames, careerHighs, seasonAvgs, recentAvgs);
        }

        function renderPlayerGameLog(playerName, teamName, playerGames, careerHighs, seasonAvgs, recentAvgs) {
            const modalBody = document.getElementById('playerGameLogBody');
            const teamLogo = TEAM_LOGOS[teamName] || '';
            const logoHTML = teamLogo ? `<img src="${teamLogo}" style="width: 80px; height: 80px; object-fit: contain; margin: 0 auto 15px auto; display: block; border-radius: 8px;" alt="${teamName}">` : '';

            let html = `
                <div class="player-log-header">
                    ${logoHTML}
                    <h2>${playerName}</h2>
                    <div class="player-team">${teamName}</div>
                </div>

                <div class="player-stats-summary">
                    <div class="summary-stat">
                        <div class="summary-stat-label">Games</div>
                        <div class="summary-stat-value">${seasonAvgs.games}</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-label">PPG</div>
                        <div class="summary-stat-value">${seasonAvgs.ppg}</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-label">RPG</div>
                        <div class="summary-stat-value">${seasonAvgs.rpg}</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-label">APG</div>
                        <div class="summary-stat-value">${seasonAvgs.apg}</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-label">SPG</div>
                        <div class="summary-stat-value">${seasonAvgs.spg}</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-label">BPG</div>
                        <div class="summary-stat-value">${seasonAvgs.bpg}</div>
                    </div>
                </div>

                <h3 style="color: #48bb78; margin: 20px 0 10px 0; font-size: 1.3em;">üìä Game-by-Game Performance</h3>
                <table class="game-log-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Opponent</th>
                            <th>Result</th>
                            <th>PTS</th>
                            <th>REB</th>
                            <th>AST</th>
                            <th>STL</th>
                            <th>BLK</th>
                            <th>FLS</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            playerGames.forEach(game => {
                const resultClass = game.result === 'W' ? 'game-result-win' : (game.result === 'L' ? 'game-result-loss' : '');
                const mvpBadge = game.wasMVP ? '<span class="mvp-badge">‚≠ê</span>' : '';

                html += `
                    <tr>
                        <td>${game.date}</td>
                        <td>vs ${game.opponent}</td>
                        <td class="${resultClass}">${game.result} ${game.score}${mvpBadge}</td>
                        <td class="${game.points === careerHighs.points ? 'career-high' : 'stat-highlight'}">${game.points}</td>
                        <td class="${game.rebounds === careerHighs.rebounds ? 'career-high' : ''}">${game.rebounds}</td>
                        <td class="${game.assists === careerHighs.assists ? 'career-high' : ''}">${game.assists}</td>
                        <td class="${game.steals === careerHighs.steals ? 'career-high' : ''}">${game.steals}</td>
                        <td class="${game.blocks === careerHighs.blocks ? 'career-high' : ''}">${game.blocks}</td>
                        <td>${game.fouls}</td>
                    </tr>
                `;
            });

            html += `
                    </tbody>
                </table>

                <h3 style="color: #48bb78; margin: 30px 0 10px 0; font-size: 1.3em;">üèÜ Career Highs</h3>
                <div class="player-stats-summary">
                    <div class="summary-stat">
                        <div class="summary-stat-label">Points</div>
                        <div class="summary-stat-value" style="color: #ffd700;">${careerHighs.points}</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-label">Rebounds</div>
                        <div class="summary-stat-value" style="color: #ffd700;">${careerHighs.rebounds}</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-label">Assists</div>
                        <div class="summary-stat-value" style="color: #ffd700;">${careerHighs.assists}</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-label">Steals</div>
                        <div class="summary-stat-value" style="color: #ffd700;">${careerHighs.steals}</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-label">Blocks</div>
                        <div class="summary-stat-value" style="color: #ffd700;">${careerHighs.blocks}</div>
                    </div>
                </div>

                <h3 style="color: #48bb78; margin: 30px 0 10px 0; font-size: 1.3em;">üî• Recent Form (Last ${Math.min(5, playerGames.length)} Games)</h3>
                <div class="player-stats-summary">
                    <div class="summary-stat">
                        <div class="summary-stat-label">PPG</div>
                        <div class="summary-stat-value">${recentAvgs.ppg}</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-label">RPG</div>
                        <div class="summary-stat-value">${recentAvgs.rpg}</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-label">APG</div>
                        <div class="summary-stat-value">${recentAvgs.apg}</div>
                    </div>
                </div>
            `;

            modalBody.innerHTML = html;
            document.getElementById('playerGameLogModal').classList.add('active');
        }

        function closePlayerGameLog() {
            document.getElementById('playerGameLogModal').classList.remove('active');
        }

        // Close modal when clicking outside
        document.getElementById('gameModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // Close player game log modal when clicking outside
        document.getElementById('playerGameLogModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closePlayerGameLog();
            }
        });
    </script>
</body>
</html>
