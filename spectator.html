<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Game - Spectator View</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            min-height: 100vh;
            padding: 20px;
            color: white;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: #48bb78;
        }

        .live-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: #c53030;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .live-dot {
            width: 10px;
            height: 10px;
            background: white;
            border-radius: 50%;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .game-info {
            text-align: center;
            margin: 20px 0;
            font-size: 1.2em;
            color: #cbd5e0;
        }

        .scoreboard {
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            padding: 40px 20px;
            border-radius: 16px;
            margin: 30px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .quarter-display {
            text-align: center;
            font-size: 2em;
            color: #a0aec0;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .game-timer-display {
            text-align: center;
            font-size: 1.5em;
            color: #48bb78;
            margin-bottom: 30px;
            font-weight: 600;
            font-family: 'Courier New', monospace;
        }

        .game-timer-label {
            font-size: 0.9em;
            color: #a0aec0;
            margin-bottom: 5px;
        }

        .scores-container {
            display: flex;
            justify-content: space-around;
            align-items: center;
            gap: 40px;
            flex-wrap: wrap;
        }

        .team-score {
            flex: 1;
            text-align: center;
            min-width: 250px;
        }

        .team-name {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .team1-name {
            color: #667eea;
        }

        .team2-name {
            color: #f56565;
        }

        .score {
            font-size: 6em;
            font-weight: 900;
            color: #48bb78;
            text-shadow: 0 4px 12px rgba(0,0,0,0.4);
        }

        .vs-text {
            font-size: 3em;
            font-weight: 700;
            color: #718096;
        }

        .team-fouls {
            margin-top: 15px;
            font-size: 1.2em;
            color: #fc8181;
            font-weight: 600;
        }

        .stats-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 30px 0;
        }

        .team-stats {
            background: #2d3748;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.3);
        }

        .team-stats h3 {
            font-size: 1.5em;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        .team2-stats h3 {
            border-bottom-color: #f56565;
        }

        .stats-grid {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 15px;
        }

        .player-stat-row {
            background: #374151;
            padding: 12px 15px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
        }

        .player-stat-name {
            font-size: 1em;
            font-weight: 600;
            color: white;
            min-width: 150px;
        }

        .player-stat-values {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: flex-end;
        }

        .player-stat-item {
            font-size: 0.85em;
            color: #cbd5e0;
            white-space: nowrap;
        }

        .player-stat-item strong {
            color: #48bb78;
            font-size: 1.1em;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: #374151;
            border-radius: 8px;
        }

        .stat-label {
            font-size: 0.9em;
            color: #a0aec0;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .stat-value {
            font-size: 2em;
            font-weight: 700;
            color: white;
        }

        .mvp-section {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            margin: 30px 0;
            box-shadow: 0 8px 24px rgba(243, 156, 18, 0.4);
        }

        .mvp-section h3 {
            font-size: 1.5em;
            margin-bottom: 15px;
            color: #fef5e7;
        }

        .mvp-name {
            font-size: 2.5em;
            font-weight: 900;
            color: white;
            margin-bottom: 20px;
        }

        .mvp-stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .mvp-stat {
            background: rgba(255,255,255,0.2);
            padding: 15px 25px;
            border-radius: 8px;
        }

        .mvp-stat-label {
            font-size: 0.9em;
            color: #fef5e7;
            margin-bottom: 5px;
        }

        .mvp-stat-value {
            font-size: 2em;
            font-weight: 900;
            color: white;
        }

        .loading {
            text-align: center;
            padding: 60px 20px;
            font-size: 1.5em;
            color: #a0aec0;
        }

        .error-message {
            background: #c53030;
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin: 20px 0;
        }

        .connection-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #2d3748;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 0.9em;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .status-connected {
            color: #48bb78;
        }

        .status-disconnected {
            color: #fc8181;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .scores-container {
                flex-direction: column;
                gap: 20px;
            }

            .team-name {
                font-size: 1.8em;
            }

            .score {
                font-size: 4em;
            }

            .vs-text {
                font-size: 2em;
            }

            .stats-section {
                grid-template-columns: 1fr;
            }

            .player-stat-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .player-stat-name {
                min-width: auto;
            }

            .player-stat-values {
                justify-content: flex-start;
                width: 100%;
            }

            .player-stat-item {
                font-size: 0.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèÄ Live Game Tracker</h1>
            <div class="live-indicator">
                <div class="live-dot"></div>
                LIVE
            </div>
        </div>

        <div class="game-info">
            <div><strong>Game:</strong> <span id="gameName">Loading...</span></div>
            <div><strong>Date:</strong> <span id="gameDate">-</span></div>
        </div>

        <div class="loading" id="loading">
            üîÑ Connecting to live game...
        </div>

        <div id="content" style="display: none;">
            <div class="scoreboard">
                <div class="quarter-display" id="quarterDisplay">Quarter 1</div>
                <div class="game-timer-display">
                    <div class="game-timer-label">Game Time</div>
                    <div id="gameTimer">10:00</div>
                </div>
                <div class="scores-container">
                    <div class="team-score">
                        <div class="team-name team1-name" id="team1Name">Team 1</div>
                        <div class="score" id="team1Score">0</div>
                        <div class="team-fouls" id="team1Fouls">Team Fouls: 0</div>
                    </div>
                    <div class="vs-text">VS</div>
                    <div class="team-score">
                        <div class="team-name team2-name" id="team2Name">Team 2</div>
                        <div class="score" id="team2Score">0</div>
                        <div class="team-fouls" id="team2Fouls">Team Fouls: 0</div>
                    </div>
                </div>
            </div>

            <div class="stats-section">
                <div class="team-stats">
                    <h3 id="team1StatsTitle">Team 1 Stats</h3>
                    <div class="stats-grid" id="team1Stats"></div>
                </div>
                <div class="team-stats team2-stats">
                    <h3 id="team2StatsTitle">Team 2 Stats</h3>
                    <div class="stats-grid" id="team2Stats"></div>
                </div>
            </div>

            <div class="mvp-section" id="mvpSection" style="display: none;">
                <h3>üèÜ Best Player of the Game</h3>
                <div class="mvp-name" id="mvpName">-</div>
                <div class="mvp-stats" id="mvpStats"></div>
            </div>
        </div>

        <div class="connection-status">
            <span id="connectionStatus" class="status-connected">‚óè Connected</span>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCRjX0GdMHSNeykGuxclCgSc3XpY04-oEE",
            authDomain: "bella-vista-league-live-score.firebaseapp.com",
            databaseURL: "https://bella-vista-league-live-score-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "bella-vista-league-live-score",
            storageBucket: "bella-vista-league-live-score.firebasestorage.app",
            messagingSenderId: "563016772281",
            appId: "1:563016772281:web:e2c3b5d3a08c2bc9308968"
        };

        // Initialize Firebase
        let database;
        let gameRef;

        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            gameRef = database.ref('liveGame');

            // Listen for live updates
            gameRef.on('value', (snapshot) => {
                const gameData = snapshot.val();
                if (gameData) {
                    updateDisplay(gameData);
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('content').style.display = 'block';
                    updateConnectionStatus(true);
                } else {
                    showError('No active game found. Start tracking from the main page.');
                }
            }, (error) => {
                showError('Connection error: ' + error.message);
                updateConnectionStatus(false);
            });

            // Handle disconnection
            database.ref('.info/connected').on('value', (snapshot) => {
                updateConnectionStatus(snapshot.val() === true);
            });

        } catch (error) {
            showError('Firebase initialization failed. Please configure Firebase settings.');
            console.error(error);
        }

        function updateDisplay(gameData) {
            // Update game info
            document.getElementById('gameName').textContent = gameData.gameName || 'Basketball Game';
            document.getElementById('gameDate').textContent = gameData.gameDate || '-';

            // Update quarter
            const currentQuarter = gameData.currentQuarter || 1;
            document.getElementById('quarterDisplay').textContent =
                currentQuarter === 'total' ? 'FINAL' : `Quarter ${currentQuarter}`;

            // Update game timer
            const formatTime = (seconds) => {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            };
            if (gameData.gameTimer && gameData.gameTimer.currentSeconds !== undefined) {
                document.getElementById('gameTimer').textContent = formatTime(gameData.gameTimer.currentSeconds);
            }

            // Update team names
            document.getElementById('team1Name').textContent = gameData.team1?.name || 'Team 1';
            document.getElementById('team2Name').textContent = gameData.team2?.name || 'Team 2';

            // Calculate and update scores
            const team1Score = calculateTeamScore(gameData.team1);
            const team2Score = calculateTeamScore(gameData.team2);
            document.getElementById('team1Score').textContent = team1Score;
            document.getElementById('team2Score').textContent = team2Score;

            // Update team fouls
            const q = currentQuarter === 'total' ? 1 : currentQuarter;
            document.getElementById('team1Fouls').textContent = `Team Fouls: ${gameData.team1?.teamFouls?.[q] || 0}`;
            document.getElementById('team2Fouls').textContent = `Team Fouls: ${gameData.team2?.teamFouls?.[q] || 0}`;

            // Update team stats
            updateTeamStats('team1', gameData.team1, currentQuarter);
            updateTeamStats('team2', gameData.team2, currentQuarter);

            // Update MVP if exists and on total view
            if (currentQuarter === 'total' && gameData.mvp && gameData.mvp.name) {
                showMVP(gameData.mvp, gameData);
            } else {
                document.getElementById('mvpSection').style.display = 'none';
            }
        }

        function calculateTeamScore(team) {
            if (!team || !team.players) return 0;
            let total = 0;
            team.players.forEach(player => {
                if (player.quarterStats) {
                    Object.values(player.quarterStats).forEach(qStats => {
                        total += qStats.points || 0;
                    });
                }
            });
            return total;
        }

        function updateTeamStats(teamId, team, currentQuarter) {
            if (!team || !team.players) return;

            const statsContainer = document.getElementById(`${teamId}Stats`);
            document.getElementById(`${teamId}StatsTitle`).textContent =
                `${team.name} - Game Total`;

            // Build player stats table - ALWAYS show game totals
            let playersHTML = '';

            team.players.forEach(player => {
                if (player.quarterStats) {
                    let stats = {
                        points: 0,
                        rebounds: 0,
                        assists: 0,
                        steals: 0,
                        blocks: 0,
                        fouls: 0
                    };

                    // Always calculate totals across all quarters
                    Object.values(player.quarterStats).forEach(qStats => {
                        stats.points += qStats.points || 0;
                        stats.rebounds += qStats.rebounds || 0;
                        stats.assists += qStats.assists || 0;
                        stats.steals += qStats.steals || 0;
                        stats.blocks += qStats.blocks || 0;
                        stats.fouls += qStats.fouls || 0;
                    });

                    // Only show players with stats
                    if (stats.points > 0 || stats.rebounds > 0 || stats.assists > 0 ||
                        stats.steals > 0 || stats.blocks > 0 || stats.fouls > 0) {
                        playersHTML += `
                            <div class="player-stat-row">
                                <div class="player-stat-name">${player.name}</div>
                                <div class="player-stat-values">
                                    <span class="player-stat-item"><strong>${stats.points}</strong> PTS</span>
                                    <span class="player-stat-item"><strong>${stats.rebounds}</strong> REB</span>
                                    <span class="player-stat-item"><strong>${stats.assists}</strong> AST</span>
                                    <span class="player-stat-item"><strong>${stats.steals}</strong> STL</span>
                                    <span class="player-stat-item"><strong>${stats.blocks}</strong> BLK</span>
                                    <span class="player-stat-item"><strong>${stats.fouls}</strong> F</span>
                                </div>
                            </div>
                        `;
                    }
                }
            });

            if (playersHTML === '') {
                playersHTML = '<div style="text-align: center; color: #a0aec0; padding: 20px;">No stats yet</div>';
            }

            statsContainer.innerHTML = playersHTML;
        }

        function showMVP(mvp, gameData) {
            const mvpSection = document.getElementById('mvpSection');
            const mvpName = document.getElementById('mvpName');
            const mvpStats = document.getElementById('mvpStats');

            mvpName.textContent = `${mvp.name} (${mvp.team})`;

            // Get MVP stats
            const team = gameData[mvp.teamKey];
            if (team && team.players) {
                const mvpPlayer = team.players.find(p => p.id === mvp.playerId);
                if (mvpPlayer && mvpPlayer.quarterStats) {
                    const stats = {
                        points: 0,
                        rebounds: 0,
                        assists: 0,
                        steals: 0,
                        blocks: 0
                    };

                    Object.values(mvpPlayer.quarterStats).forEach(qStats => {
                        stats.points += qStats.points || 0;
                        stats.rebounds += qStats.rebounds || 0;
                        stats.assists += qStats.assists || 0;
                        stats.steals += qStats.steals || 0;
                        stats.blocks += qStats.blocks || 0;
                    });

                    mvpStats.innerHTML = `
                        <div class="mvp-stat">
                            <div class="mvp-stat-label">PTS</div>
                            <div class="mvp-stat-value">${stats.points}</div>
                        </div>
                        <div class="mvp-stat">
                            <div class="mvp-stat-label">REB</div>
                            <div class="mvp-stat-value">${stats.rebounds}</div>
                        </div>
                        <div class="mvp-stat">
                            <div class="mvp-stat-label">AST</div>
                            <div class="mvp-stat-value">${stats.assists}</div>
                        </div>
                        <div class="mvp-stat">
                            <div class="mvp-stat-label">STL</div>
                            <div class="mvp-stat-value">${stats.steals}</div>
                        </div>
                        <div class="mvp-stat">
                            <div class="mvp-stat-label">BLK</div>
                            <div class="mvp-stat-value">${stats.blocks}</div>
                        </div>
                    `;
                }
            }

            mvpSection.style.display = 'block';
        }

        function showError(message) {
            document.getElementById('loading').innerHTML = `
                <div class="error-message">
                    ‚ö†Ô∏è ${message}
                </div>
            `;
        }

        function updateConnectionStatus(connected) {
            const statusElement = document.getElementById('connectionStatus');
            if (connected) {
                statusElement.className = 'status-connected';
                statusElement.textContent = '‚óè Connected';
            } else {
                statusElement.className = 'status-disconnected';
                statusElement.textContent = '‚óè Disconnected';
            }
        }
    </script>
</body>
</html>
